(self.webpackChunklmd_host=self.webpackChunklmd_host||[]).push([[157],{1157:($,N,A)=>{var m=A(4614),i=A(1267),h=A(1781),T=A(9073),y=A(9015),_=A(1522);function M(s,e){if(1&s){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"a",6),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.goTo("/inici"))}),i.\u0275\u0275elementStart(1,"span",2),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd()()}2&s&&(i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(3,1,"application.breadcrumbs.home")," "))}function I(s,e){1&s&&(i.\u0275\u0275text(0),i.\u0275\u0275pipe(1,"translate")),2&s&&i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(1,1,"application.breadcrumbs.home"),"")}function R(s,e){if(1&s){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"a",6),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext().$implicit,o=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(o.goTo(r.url))}),i.\u0275\u0275elementStart(1,"span",2),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd()()}if(2&s){const t=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(3,1,t.label)," ")}}function P(s,e){if(1&s&&(i.\u0275\u0275text(0),i.\u0275\u0275pipe(1,"translate")),2&s){const t=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(1,1,t.label),"")}}function L(s,e){if(1&s&&(i.\u0275\u0275elementStart(0,"li",0),i.\u0275\u0275template(1,R,4,3,"a",3),i.\u0275\u0275template(2,P,2,3,"ng-template",4),i.\u0275\u0275elementEnd()),2&s){const t=e.last;i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",!t),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",t)}}let q=(()=>{class s{constructor(t,n,r,o){this.router=t,this.route=n,this.translateService=r,this.platformId=o,this.list=[],this.currentPageTitle=""}checkURLIntegration(){return-1!==window.location.href.indexOf("lmd/integration")&&window.history?.state?.section}ngOnInit(){(0,h.isPlatformServer)(this.platformId)||this.router.events.pipe((0,y.filter)(t=>t instanceof T.NavigationEnd)).subscribe(()=>{const t=this.collectRouteData(this.route,""),n=this.router.getCurrentNavigation()?.extras.state;n&&void 0!==n.breadcrumb&&t.push({url:this.router.url,label:n.breadcrumb}),this.checkURLIntegration()&&(t.push({url:null,label:window.history?.state?.section}),this.arraymove(t,1,2)),this.list=t,this.currentPageTitle=this.getPageTitle(this.list),this.setPageTitle(this.currentPageTitle)})}goTo(t){return t?this.router.navigateByUrl(t):window.history.back()}collectRouteData(t,n){const r=t.snapshot.url.map(d=>d.path).join("/"),o=n?`${n}/${r}`:r,a=t.snapshot.data,c=a&&a.breadcrumb?[{url:o,label:a.breadcrumb}]:[];if(t.firstChild){const d=this.collectRouteData(t.firstChild,o);if(c.length>0&&d.length>0){const u=[c[0],d[d.length-1]];return u[0].label===u[1].label?c:u}return c.concat(d)}return c}getPageTitle(t){const n=this.translateService.instant("application.title");let r=t?.length>0?this.list[this.list.length-1].label:"";r=this.translateService.instant(r);const o=t?.length>1?this.list[this.list.length-2].label:"";return o&&(r=this.translateService.instant(o)+" - "+r),`${n} | ${r}`}setPageTitle(t){console.log("set title"),document.title=t}arraymove(t,n,r){var o=t[n];t.splice(n,1),t.splice(r,0,o)}static{this.\u0275fac=function(n){return new(n||s)(i.\u0275\u0275directiveInject(T.Router),i.\u0275\u0275directiveInject(T.ActivatedRoute),i.\u0275\u0275directiveInject(_.TranslateService),i.\u0275\u0275directiveInject(i.PLATFORM_ID))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:s,selectors:[["app-breadcrumb"]],decls:9,vars:7,consts:[[1,"NG__breadcrumb_item"],[1,"NG__breadcrumb__item_link",3,"href"],[1,"NG__breadcrumb__item_link_span","NG__breadcrumb__item_link_span--overflow","cursor-pointer"],["class","NG__breadcrumb__item_link",3,"click",4,"ngIf"],[3,"ngIf"],["class","NG__breadcrumb_item",4,"ngFor","ngForOf"],[1,"NG__breadcrumb__item_link",3,"click"]],template:function(n,r){1&n&&(i.\u0275\u0275elementStart(0,"li",0)(1,"a",1)(2,"span",2),i.\u0275\u0275text(3),i.\u0275\u0275pipe(4,"translate"),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275elementStart(5,"li",0),i.\u0275\u0275template(6,M,4,3,"a",3),i.\u0275\u0275template(7,I,2,3,"ng-template",4),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(8,L,3,2,"li",5)),2&n&&(i.\u0275\u0275advance(1),i.\u0275\u0275property("href","https://ovt.gencat.cat/carpetaciutadana360",i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(4,5,"application.breadcrumbs.init")," "),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",r.list.length),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngIf",!r.list.length),i.\u0275\u0275advance(1),i.\u0275\u0275property("ngForOf",r.list))},dependencies:[h.NgForOf,h.NgIf,_.TranslatePipe],styles:[".cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]})}}return s})();var W=A(7823),H=A(8049);function ae(s,e){if(1&s&&(i.\u0275\u0275element(0,"div",7),i.\u0275\u0275pipe(1,"translate")),2&s){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("innerHtml",i.\u0275\u0275pipeBind1(1,1,t.subTitle),i.\u0275\u0275sanitizeHtml)}}let z=(()=>{class s{constructor(){this.title="",this.description="",this.iconUrl="",this.subTitle="",this.platformId=(0,i.inject)(i.PLATFORM_ID),this.appService=(0,i.inject)(W.d),this.featureHeaderService=(0,i.inject)(H.P)}ngAfterViewInit(){(0,h.isPlatformBrowser)(this.platformId)&&(0,y.merge)(this.featureHeaderService.headerTitleChanges,this.appService.headerChanges).subscribe(n=>{this.title=n?.title||"",this.description=n?.description||"",this.iconUrl=n?.iconUrl||"",this.subTitle=n?.subTitle||""})}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:s,selectors:[["app-feature-header"]],decls:10,vars:11,consts:[[1,"feature-header-container"],[1,"feature-header-container_description"],["class","h5",3,"innerHtml",4,"ngIf"],[1,"h3",3,"innerHtml"],[3,"innerHtml"],[1,"feature-header-container_image"],[1,"feature-header-container_image_content",3,"src","alt"],[1,"h5",3,"innerHtml"]],template:function(n,r){1&n&&(i.\u0275\u0275elementStart(0,"div",0)(1,"div",1),i.\u0275\u0275template(2,ae,2,3,"div",2),i.\u0275\u0275element(3,"h2",3),i.\u0275\u0275pipe(4,"translate"),i.\u0275\u0275element(5,"p",4),i.\u0275\u0275pipe(6,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(7,"div",5),i.\u0275\u0275element(8,"img",6),i.\u0275\u0275pipe(9,"translate"),i.\u0275\u0275elementEnd()()),2&n&&(i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",r.subTitle),i.\u0275\u0275advance(1),i.\u0275\u0275property("innerHtml",i.\u0275\u0275pipeBind1(4,5,r.title),i.\u0275\u0275sanitizeHtml),i.\u0275\u0275advance(2),i.\u0275\u0275property("innerHtml",i.\u0275\u0275pipeBind1(6,7,r.description),i.\u0275\u0275sanitizeHtml),i.\u0275\u0275advance(3),i.\u0275\u0275property("src",r.iconUrl,i.\u0275\u0275sanitizeUrl)("alt",i.\u0275\u0275pipeBind1(9,9,r.title)))},dependencies:[h.NgIf,_.TranslatePipe],styles:[".feature-header-container[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-between;padding:0 1rem 1rem}.feature-header-container_description[_ngcontent-%COMP%]{width:80%}.feature-header-container_image[_ngcontent-%COMP%]{width:20%;display:flex;justify-content:center}@media screen and (max-width: 768px){.feature-header-container_image[_ngcontent-%COMP%]{display:none}}.feature-header-container[_ngcontent-%COMP%]   .h3[_ngcontent-%COMP%]{margin-bottom:.5rem!important;font-family:OpenSans-Bold,sans-serif!important;line-height:1.2!important;font-size:2.5rem;text-align:left!important}.feature-header-container_image_content[_ngcontent-%COMP%]{max-width:100%}"]})}}return s})();var X=A(2174),j=A(5312),Q=A(2490);const se=[{id:"ca_ES",label:"CA"},{id:"es_ES",label:"ES"},{id:"en_GB",label:"EN"},{id:"an_ES",label:"OC"}];let pe=(()=>{class s extends X.NgGencatLangSelectorService{constructor(t,n){super(t,n),this.translate=t,this.cookieService=n,this.LANGUAGE="set-locale"}getLanguages(){return se}loadLangFromCookie(t){let n="ca_ES";const r=this.cookieService.get(t||this.LANGUAGE);let o=window.navigator.language.replace("-","_");o=o.includes("en")?se[2].id:o,o.includes("_")||(o=this.getLanguages().find(c=>c.id.startsWith(o))?.id||o),n=r||o,this.cookieService.set(this.LANGUAGE,n,void 0,"/",j.c.env.COOKIE_DOMAIN);const a=this.getLanguages().find(c=>c.id===n);a&&(this._currentLang=a,this.loadLang(this.currentLang))}setCurrentLang(t){t?.id!==this._currentLang?.id&&(this.cookieService.set(this.LANGUAGE,t.id,void 0,"/",j.c.env.COOKIE_DOMAIN),setTimeout(()=>window.location.reload(),200))}static{this.\u0275fac=function(n){return new(n||s)(i.\u0275\u0275inject(_.TranslateService),i.\u0275\u0275inject(Q.O))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})(),le=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:s,selectors:[["app-not-found"]],decls:2,vars:0,template:function(n,r){1&n&&(i.\u0275\u0275elementStart(0,"p"),i.\u0275\u0275text(1,"not-found works!"),i.\u0275\u0275elementEnd())}})}}return s})();var B=A(6315);const G=[{path:"",canActivate:[B.MsalGuard],loadChildren:()=>A.e(538).then(A.bind(A,5157)).then(s=>s.HomeModule)},{path:"not-found",component:le},{path:"**",component:le}];let Pe=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:s})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[T.RouterModule.forRoot(G,{initialNavigation:"enabledBlocking"}),T.RouterModule]})}}return s})();var C=A(467);function Ne(s,e){1&s&&i.\u0275\u0275element(0,"router-outlet")}let Ae=(()=>{class s{constructor(){this.isServer=!0,this.platformId=(0,i.inject)(i.PLATFORM_ID),this.langService=(0,i.inject)(X.NgGencatLangSelectorService),this.appService=(0,i.inject)(W.d),this.spinnerService=(0,i.inject)(X.NgGencatProgressSpinnerService),this.renderer=(0,i.inject)(i.Renderer2),this.isServer=(0,h.isPlatformServer)(this.platformId)}ngOnInit(){(0,h.isPlatformBrowser)(this.platformId)&&this.langService.loadLangFromCookie()}ngAfterViewInit(){this.langSelector(),this.loadUserInfo().then(),this.optionSelected(),this.catchLoadingChanges(),this.getLogoutEvent(),this.goToCompanyChannelEvent()}loadUserInfo(){var t=this;return(0,C.A)(function*(){(0,h.isPlatformBrowser)(t.platformId)&&t.appService.userChanges.subscribe(n=>{const r=document.querySelector("#apt_username");r&&t.renderer.setProperty(r,"textContent",n?.name);const o=document.querySelector("#apt_item1_username");o&&t.renderer.setProperty(o,"textContent",n?.username)})})()}catchLoadingChanges(){(0,h.isPlatformBrowser)(this.platformId)&&this.appService.showSpinnerChanged.subscribe(t=>{t?this.spinnerService.showSpinnerBlocked():this.spinnerService.hideSpinnerBlocked()})}langSelector(){(0,h.isPlatformBrowser)(this.platformId)&&document.querySelectorAll('a[id^="apt_idioma_"]').forEach(n=>{this.renderer.listen(n,"click",r=>{r.preventDefault();const o=r.target.getAttribute("lang"),a=se.find(c=>c.label===o.toUpperCase());a&&this.langService.setCurrentLang(a)})})}getLogoutEvent(){if((0,h.isPlatformBrowser)(this.platformId)){const t=document.getElementsByClassName("tancar-sesio");this.renderer.listen(t[0],"click",n=>{n.preventDefault(),this.appService.logout$.emit()})}}goToCompanyChannelEvent(){if((0,h.isPlatformBrowser)(this.platformId)){const t=[];t.push(document.getElementById("apt_item2_url")),t.push(document.getElementById("apt_item2_url_mobile")),t.forEach(n=>{this.renderer.listen(n,"click",r=>{r.preventDefault(),window.location.href=j.c.env.COMPANY_CHANNEL_URL})})}}optionSelected(){if(!(0,h.isPlatformBrowser)(this.platformId))return;document.querySelectorAll(".NG-navbar__list.NG-navbar__list--white").forEach(r=>{r.classList.remove("NG-navbar__list--selected"),r.classList.remove("NG-navbar__list--active")});const n=document.getElementById("apt_did");n&&(n.parentElement?.classList.add("NG-navbar__list--selected"),n.parentElement?.classList.add("NG-navbar__list--active"))}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:s,selectors:[["app-root"]],decls:3,vars:4,consts:[[3,"statusMessage"],[4,"ngIf"]],template:function(n,r){1&n&&(i.\u0275\u0275element(0,"ng-gencat-progress-spinner",0),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275template(2,Ne,1,0,"router-outlet",1)),2&n&&(i.\u0275\u0275property("statusMessage",i.\u0275\u0275pipeBind1(1,2,"application.loading")),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",!r.isServer))},dependencies:[h.NgIf,T.RouterOutlet,X.NgGencatProgressSpinnerComponent,_.TranslatePipe],encapsulation:2})}}return s})();var Se=A(6499),Te=A(7229),J=A.t(JSON.parse('{"application":{"title":"APC","breadcrumbs":{"init":"Inici","home":"Dades i documents","EMD":{"detail":"Detall de document","add":"Afegeix un document","edit":"Edita un document"}},"home":{"title":"Dades i documents","description":"Espai on pots consultar i gestionar informaci\xf3 sobre la teva situaci\xf3 personal i familiar, dades de contacte, i documents o certificats oficials.<br>Se centra en un \xfanic espai per gestionar de forma c\xf2moda i segura la informaci\xf3 amb l\u2019Administraci\xf3.","menu":{"lmd":{"title":"Les meves dades","description":"En aquest espai pots consultar <b>dades i documents personals que l\u2019Administraci\xf3 t\xe9 sobre tu</b>. "},"emd":{"title":"Els meus documents","description":"Aquest espai \xe9s <b>el teu espai personal de documents</b>. Accedeix a tots els documents que has afegit des de Les meves dades o que has presentat en oficines de registre."},"lmd-contact":{"title":"La meva informaci\xf3 de contacte","description":"En aquesta secci\xf3 pots consultar i gestionar <b>la teva informaci\xf3 de contacte</b> registrada, que utilitzem per enviar-te <b>avisos, comunicacions importants</b> o les dades del teu <b>idCAT M\xf2bil</b>."}}},"not-found":{"title":"No s\'ha trobat la p\xe0gina","description":"La p\xe0gina no existeix o no est\xe0 disponible","go-back":"Torna a inici"}},"form":{"button":{"show-calendar":"Mostrar el calendari"}}}'),2);class K{constructor(e="i18n",t=".json"){this.prefix=e,this.suffix=t}getTranslation(e){return new y.Observable(t=>{t.next(J),t.complete()})}}var Z=A(8173),l=A(7635);var v=A(3986),E=A(7172);const Ue={createNewGuid:()=>{throw(0,v.SB)(E.R9)},base64Decode:()=>{throw(0,v.SB)(E.R9)},base64Encode:()=>{throw(0,v.SB)(E.R9)},base64UrlEncode:()=>{throw(0,v.SB)(E.R9)},encodeKid:()=>{throw(0,v.SB)(E.R9)},getPublicKeyThumbprint:()=>(0,C.A)(function*(){throw(0,v.SB)(E.R9)})(),removeTokenBindingKey:()=>(0,C.A)(function*(){throw(0,v.SB)(E.R9)})(),clearKeystore:()=>(0,C.A)(function*(){throw(0,v.SB)(E.R9)})(),signJwt:()=>(0,C.A)(function*(){throw(0,v.SB)(E.R9)})(),hashString:()=>(0,C.A)(function*(){throw(0,v.SB)(E.R9)})()},Ge="@azure/msal-common",Be="14.16.1";function _e(s,e){const t=function yt(s){if(!s)throw(0,v.SB)(E.Bh);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(s);if(!t||t.length<4)throw(0,v.SB)(E.gR);return t[2]}(s);try{const n=e(t);return JSON.parse(n)}catch{throw(0,v.SB)(E.gR)}}function st(s,e){if(0===e||Date.now()-3e5>s+e)throw(0,v.SB)(E.Yh)}function Ce(){return Math.round((new Date).getTime()/1e3)}function nt(s,e){const t=Number(s)||0;return Ce()+e>t}function Ye(s){return[Jn(s),Zn(s),er(s),tr(s),nr(s)].join(l.LR.CACHE_KEY_SEPARATOR).toLowerCase()}function ct(s,e,t,n,r){return{credentialType:l.aG.ID_TOKEN,homeAccountId:s,environment:e,clientId:n,secret:t,realm:r}}function lt(s,e,t,n,r,o,a,c,d,u,p,S,w,D,Y){const F={homeAccountId:s,credentialType:l.aG.ACCESS_TOKEN,secret:t,cachedAt:Ce().toString(),expiresOn:a.toString(),extendedExpiresOn:c.toString(),environment:e,clientId:n,realm:r,target:o,tokenType:p||l.IO.BEARER};if(S&&(F.userAssertionHash=S),u&&(F.refreshOn=u.toString()),D&&(F.requestedClaims=D,F.requestedClaimsHash=Y),F.tokenType?.toLowerCase()!==l.IO.BEARER.toLowerCase())switch(F.credentialType=l.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME,F.tokenType){case l.IO.POP:const ue=_e(t,d);if(!ue?.cnf?.kid)throw(0,v.SB)(E.FA);F.keyId=ue.cnf.kid;break;case l.IO.SSH:F.keyId=w}return F}function an(s,e,t,n,r,o,a){const c={credentialType:l.aG.REFRESH_TOKEN,homeAccountId:s,environment:e,clientId:n,secret:t};return o&&(c.userAssertionHash=o),r&&(c.familyId=r),a&&(c.expiresOn=a.toString()),c}function It(s){return s.hasOwnProperty("homeAccountId")&&s.hasOwnProperty("environment")&&s.hasOwnProperty("credentialType")&&s.hasOwnProperty("clientId")&&s.hasOwnProperty("secret")}function sn(s){return!!s&&It(s)&&s.hasOwnProperty("realm")&&s.hasOwnProperty("target")&&(s.credentialType===l.aG.ACCESS_TOKEN||s.credentialType===l.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function cn(s){return!!s&&It(s)&&s.hasOwnProperty("realm")&&s.credentialType===l.aG.ID_TOKEN}function ln(s){return!!s&&It(s)&&s.credentialType===l.aG.REFRESH_TOKEN}function Jn(s){return[s.homeAccountId,s.environment].join(l.LR.CACHE_KEY_SEPARATOR).toLowerCase()}function Zn(s){return[s.credentialType,s.credentialType===l.aG.REFRESH_TOKEN&&s.familyId||s.clientId,s.realm||""].join(l.LR.CACHE_KEY_SEPARATOR).toLowerCase()}function er(s){return(s.target||"").toLowerCase()}function tr(s){return(s.requestedClaimsHash||"").toLowerCase()}function nr(s){return s.tokenType&&s.tokenType.toLowerCase()!==l.IO.BEARER.toLowerCase()?s.tokenType.toLowerCase():""}function dn(){return Ce()+l.u0.REFRESH_TIME_SECONDS}function dt(s,e,t){s.authorization_endpoint=e.authorization_endpoint,s.token_endpoint=e.token_endpoint,s.end_session_endpoint=e.end_session_endpoint,s.issuer=e.issuer,s.endpointsFromNetwork=t,s.jwks_uri=e.jwks_uri}function Et(s,e,t){s.aliases=e.aliases,s.preferred_cache=e.preferred_cache,s.preferred_network=e.preferred_network,s.aliasesFromNetwork=t}function un(s){return s.expiresAt<=Ce()}var te=A(7806),Le=A(2030),ne=A(5424);class re{constructor(e){const t=e?Le.$.trimArrayEntries([...e]):[],n=t?Le.$.removeEmptyStringsFromArray(t):[];this.validateInputScopes(n),this.scopes=new Set,n.forEach(r=>this.scopes.add(r))}static fromString(e){const n=(e||l.YM.EMPTY_STRING).split(" ");return new re(n)}static createSearchScopes(e){const t=new re(e);return t.containsOnlyOIDCScopes()?t.removeScope(l.YM.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}validateInputScopes(e){if(!e||e.length<1)throw(0,te.aD)(ne.zg)}containsScope(e){const t=this.printScopesLowerCase().split(" "),n=new re(t);return!!e&&n.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return l._A.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw(0,v.SB)(E.Wf)}}removeScope(e){if(!e)throw(0,v.SB)(E.f5);this.scopes.delete(e.trim())}removeOIDCScopes(){l._A.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw(0,v.SB)(E.UA);const t=new Set;return e.scopes.forEach(n=>t.add(n.toLowerCase())),this.scopes.forEach(n=>t.add(n.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw(0,v.SB)(E.UA);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),n=e.getScopeCount(),r=this.getScopeCount();return t.size<r+n}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):l.YM.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}}function ut(s,e){if(!s)throw(0,v.SB)(E.fY);try{const t=e(s);return JSON.parse(t)}catch{throw(0,v.SB)(E.lP)}}function ze(s){if(!s)throw(0,v.SB)(E.lP);const e=s.split(l.LR.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?l.YM.EMPTY_STRING:e[1]}}function ht(s,e){return!!s&&!!e&&s===e.split(".")[1]}function vt(s,e,t,n){if(n){const{oid:r,sub:o,tid:a,name:c,tfp:d,acr:u}=n,p=a||d||u||"";return{tenantId:p,localAccountId:r||o||"",name:c,isHomeTenant:ht(p,s)}}return{tenantId:t,localAccountId:e,isHomeTenant:ht(t,s)}}function St(s,e,t,n){let r=s;if(e){const{isHomeTenant:o,...a}=e;r={...s,...a}}if(t){const{isHomeTenant:o,...a}=vt(s.homeAccountId,s.localAccountId,s.tenantId,t);return r={...r,...a,idTokenClaims:t,idToken:n},r}return r}function hn(s){return s&&(s.tid||s.tfp||s.acr)||null}class ce{generateAccountId(){return[this.homeAccountId,this.environment].join(l.LR.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return ce.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){const t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(l.LR.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,n){const r=new ce;let o;r.authorityType=1===t.authorityType?l.Qd.ADFS_ACCOUNT_TYPE:"AAD"===t.protocolMode?l.Qd.MSSTS_ACCOUNT_TYPE:l.Qd.GENERIC_ACCOUNT_TYPE,e.clientInfo&&n&&(o=ut(e.clientInfo,n)),r.clientInfo=e.clientInfo,r.homeAccountId=e.homeAccountId,r.nativeAccountId=e.nativeAccountId;const a=e.environment||t&&t.getPreferredCache();if(!a)throw(0,v.SB)(E.l3);if(r.environment=a,r.realm=o?.utid||hn(e.idTokenClaims)||"",r.localAccountId=o?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"",r.username=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn||(e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null)||"",r.name=e.idTokenClaims?.name||"",r.cloudGraphHostName=e.cloudGraphHostName,r.msGraphHost=e.msGraphHost,e.tenantProfiles)r.tenantProfiles=e.tenantProfiles;else{const u=vt(e.homeAccountId,r.localAccountId,r.realm,e.idTokenClaims);r.tenantProfiles=[u]}return r}static createFromAccountInfo(e,t,n){const r=new ce;return r.authorityType=e.authorityType||l.Qd.GENERIC_ACCOUNT_TYPE,r.homeAccountId=e.homeAccountId,r.localAccountId=e.localAccountId,r.nativeAccountId=e.nativeAccountId,r.realm=e.tenantId,r.environment=e.environment,r.username=e.username,r.name=e.name,r.cloudGraphHostName=t,r.msGraphHost=n,r.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),r}static generateHomeAccountId(e,t,n,r,o){if(1!==t&&2!==t){if(e)try{const a=ut(e,r.base64Decode);if(a.uid&&a.utid)return`${a.uid}.${a.utid}`}catch{}n.warning("No client info in response")}return o?.sub||""}static isAccountEntity(e){return!!e&&e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType")}static accountInfoIsEqual(e,t,n){if(!e||!t)return!1;let r=!0;if(n){const o=e.idTokenClaims||{},a=t.idTokenClaims||{};r=o.iat===a.iat&&o.nonce===a.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&r}}var V=A(1564);const pn={"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},Rt={tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]},mn=new Set;function fn(s,e,t,n){if(n?.trace(`getAliasesFromMetadata called with source: ${t}`),s&&e){const r=gt(e,s);if(r)return n?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),r.aliases;n?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function gt(s,e){for(let t=0;t<s.length;t++){const n=s[t];if(n.aliases.includes(e))return n}return null}Rt.metadata.forEach(s=>{s.aliases.forEach(e=>{mn.add(e)})});const kt="cache_quota_exceeded",wt="cache_error_unknown",Mt={[kt]:"Exceeded cache storage capacity.",[wt]:"Unexpected error occurred when using cache storage."};class $e extends Error{constructor(e,t){const n=t||(Mt[e]?Mt[e]:Mt[wt]);super(`${e}: ${n}`),Object.setPrototypeOf(this,$e.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}}function Cn(s){return s instanceof Error?"QuotaExceededError"===s.name||"NS_ERROR_DOM_QUOTA_REACHED"===s.name||s.message.includes("exceeded the quota")?new $e(kt):new $e(s.name,s.message):new $e(wt)}var oe=A(3461);class qe{constructor(e,t,n,r){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(Ge,Be),this.staticAuthorityOptions=r}getAllAccounts(e,t){return this.buildTenantProfiles(this.getAccountsFilteredBy(t||{},e),e,t)}getAccountInfoFilteredBy(e,t){const n=this.getAllAccounts(t,e);return n.length>1?n.sort(o=>o.idTokenClaims?-1:1)[0]:1===n.length?n[0]:null}getBaseAccountInfo(e,t){const n=this.getAccountsFilteredBy(e,t);return n.length>0?n[0].getAccountInfo():null}buildTenantProfiles(e,t,n){return e.flatMap(r=>this.getTenantProfilesFromAccountEntity(r,t,n?.tenantId,n))}getTenantedAccountInfoByFilter(e,t,n,r,o){let c,a=null;if(o&&!this.tenantProfileMatchesFilter(n,o))return null;const d=this.getIdToken(e,r,t,n.tenantId);return d&&(c=_e(d.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(c,o))?null:(a=St(e,n,c,d?.secret),a)}getTenantProfilesFromAccountEntity(e,t,n,r){const o=e.getAccountInfo();let a=o.tenantProfiles||new Map;const c=this.getTokenKeys();if(n){const u=a.get(n);if(!u)return[];a=new Map([[n,u]])}const d=[];return a.forEach(u=>{const p=this.getTenantedAccountInfoByFilter(o,c,u,t,r);p&&d.push(p)}),d}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||void 0!==t.isHomeTenant&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}saveCacheRecord(e,t,n){var r=this;return(0,C.A)(function*(){if(!e)throw(0,v.SB)(E.n4);try{e.account&&r.setAccount(e.account,t),e.idToken&&!1!==n?.idToken&&r.setIdTokenCredential(e.idToken,t),e.accessToken&&!1!==n?.accessToken&&(yield r.saveAccessToken(e.accessToken,t)),e.refreshToken&&!1!==n?.refreshToken&&r.setRefreshTokenCredential(e.refreshToken,t),e.appMetadata&&r.setAppMetadata(e.appMetadata,t)}catch(o){throw r.commonLogger?.error("CacheManager.saveCacheRecord: failed"),o instanceof oe.lR?o:Cn(o)}})()}saveAccessToken(e,t){var n=this;return(0,C.A)(function*(){const r={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},o=n.getTokenKeys(),a=re.fromString(e.target);o.accessToken.forEach(c=>{if(!n.accessTokenKeyMatchesFilter(c,r,!1))return;const d=n.getAccessTokenCredential(c,t);d&&n.credentialMatchesFilter(d,r)&&re.fromString(d.target).intersectingScopeSets(a)&&n.removeAccessToken(c,t)}),n.setAccessTokenCredential(e,t)})()}getAccountsFilteredBy(e,t){const n=this.getAccountKeys(),r=[];return n.forEach(o=>{if(!this.isAccountKey(o,e.homeAccountId))return;const a=this.getAccount(o,t,this.commonLogger);if(!a||e.homeAccountId&&!this.matchHomeAccountId(a,e.homeAccountId)||e.username&&!this.matchUsername(a.username,e.username)||e.environment&&!this.matchEnvironment(a,e.environment)||e.realm&&!this.matchRealm(a,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(a,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(a,e.authorityType))return;const c={localAccountId:e?.localAccountId,name:e?.name},d=a.tenantProfiles?.filter(u=>this.tenantProfileMatchesFilter(u,c));d&&0===d.length||r.push(a)}),r}isAccountKey(e,t,n){return!(e.split(l.LR.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||n&&!e.toLowerCase().includes(n.toLowerCase()))}isCredentialKey(e){if(e.split(l.LR.CACHE_KEY_SEPARATOR).length<6)return!1;const t=e.toLowerCase();if(-1===t.indexOf(l.aG.ID_TOKEN.toLowerCase())&&-1===t.indexOf(l.aG.ACCESS_TOKEN.toLowerCase())&&-1===t.indexOf(l.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())&&-1===t.indexOf(l.aG.REFRESH_TOKEN.toLowerCase()))return!1;if(t.indexOf(l.aG.REFRESH_TOKEN.toLowerCase())>-1){const r=`${l.aG.REFRESH_TOKEN}${l.LR.CACHE_KEY_SEPARATOR}${l.hB}${l.LR.CACHE_KEY_SEPARATOR}`;if(-1===t.indexOf(`${l.aG.REFRESH_TOKEN}${l.LR.CACHE_KEY_SEPARATOR}${this.clientId}${l.LR.CACHE_KEY_SEPARATOR}`.toLowerCase())&&-1===t.indexOf(r.toLowerCase()))return!1}else if(-1===t.indexOf(this.clientId.toLowerCase()))return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||"string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===l.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===l.IO.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){const t=this.getKeys(),n={};return t.forEach(r=>{if(!this.isAppMetadata(r))return;const o=this.getAppMetadata(r);o&&(e.environment&&!this.matchEnvironment(o,e.environment)||e.clientId&&!this.matchClientId(o,e.clientId)||(n[r]=o))}),n}getAuthorityMetadataByAlias(e){const t=this.getAuthorityMetadataKeys();let n=null;return t.forEach(r=>{if(!this.isAuthorityMetadata(r)||-1===r.indexOf(this.clientId))return;const o=this.getAuthorityMetadata(r);o&&-1!==o.aliases.indexOf(e)&&(n=o)}),n}removeAllAccounts(e){var t=this;return(0,C.A)(function*(){const n=t.getAccountKeys(),r=[];n.forEach(o=>{r.push(t.removeAccount(o,e))}),yield Promise.all(r)})()}removeAccount(e,t){var n=this;return(0,C.A)(function*(){const r=n.getAccount(e,t,n.commonLogger);r&&(yield n.removeAccountContext(r,t),n.removeItem(e,t))})()}removeAccountContext(e,t){var n=this;return(0,C.A)(function*(){const r=n.getTokenKeys(),o=e.generateAccountId();r.idToken.forEach(a=>{0===a.indexOf(o)&&n.removeIdToken(a,t)}),r.accessToken.forEach(a=>{0===a.indexOf(o)&&n.removeAccessToken(a,t)}),r.refreshToken.forEach(a=>{0===a.indexOf(o)&&n.removeRefreshToken(a,t)}),n.getKeys().forEach(a=>{a.includes(o)&&n.removeItem(a,t)})})()}updateOutdatedCachedAccount(e,t,n,r){if(t&&t.isSingleTenant()){this.commonLogger?.verbose("updateOutdatedCachedAccount: Found a single-tenant (outdated) account entity in the cache, migrating to multi-tenant account entity");const o=this.getAccountKeys().filter(p=>p.startsWith(t.homeAccountId)),a=[];o.forEach(p=>{const S=this.getCachedAccountEntity(p,n);S&&a.push(S)});const c=a.find(p=>ht(p.realm,p.homeAccountId))||a[0];c.tenantProfiles=a.map(p=>({tenantId:p.realm,localAccountId:p.localAccountId,name:p.name,isHomeTenant:ht(p.realm,p.homeAccountId)}));const d=qe.toObject(new ce,{...c}),u=d.generateAccountKey();return o.forEach(p=>{p!==u&&this.removeOutdatedAccount(e,n)}),this.setAccount(d,n),r?.verbose("Updated an outdated account entity in the cache"),d}return t}removeAccessToken(e,t){const n=this.getAccessTokenCredential(e,t);if(this.removeItem(e,t),!n||n.credentialType.toLowerCase()!==l.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()||n.tokenType!==l.IO.POP)return;const r=n.keyId;r&&this.cryptoImpl.removeTokenBindingKey(r).catch(()=>{this.commonLogger.error("Binding key could not be removed")})}removeAppMetadata(e){return this.getKeys().forEach(n=>{this.isAppMetadata(n)&&this.removeItem(n,e)}),!0}readAccountFromCache(e,t){const n=ce.generateAccountCacheKey(e);return this.getAccount(n,t,this.commonLogger)}getIdToken(e,t,n,r,o){this.commonLogger.trace("CacheManager - getIdToken called");const c=this.getIdTokensByFilter({homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l.aG.ID_TOKEN,clientId:this.clientId,realm:r},t,n),d=c.size;if(d<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(d>1){let u=c;if(!r){const p=new Map;c.forEach((w,D)=>{w.realm===e.tenantId&&p.set(D,w)});const S=p.size;if(S<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),c.values().next().value;if(1===S)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),p.values().next().value;u=p}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),u.forEach((p,S)=>{this.removeIdToken(S,t)}),o&&t&&o.addFields({multiMatchedID:c.size},t),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),c.values().next().value}getIdTokensByFilter(e,t,n){const r=n&&n.idToken||this.getTokenKeys().idToken,o=new Map;return r.forEach(a=>{if(!this.idTokenKeyMatchesFilter(a,{clientId:this.clientId,...e}))return;const c=this.getIdTokenCredential(a,t);c&&this.credentialMatchesFilter(c,e)&&o.set(a,c)}),o}idTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,n,r,o){this.commonLogger.trace("CacheManager - getAccessToken called");const a=re.createSearchScopes(t.scopes),c=t.authenticationScheme||l.IO.BEARER,d=c&&c.toLowerCase()!==l.IO.BEARER.toLowerCase()?l.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME:l.aG.ACCESS_TOKEN,u={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:d,clientId:this.clientId,realm:r||e.tenantId,target:a,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},p=n&&n.accessToken||this.getTokenKeys().accessToken,S=[];p.forEach(D=>{if(this.accessTokenKeyMatchesFilter(D,u,!0)){const Y=this.getAccessTokenCredential(D,t.correlationId);Y&&this.credentialMatchesFilter(Y,u)&&S.push(Y)}});const w=S.length;return w<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):w>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),S.forEach(D=>{this.removeAccessToken(Ye(D),t.correlationId)}),o&&t.correlationId&&o.addFields({multiMatchedAT:S.length},t.correlationId),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),S[0])}accessTokenKeyMatchesFilter(e,t,n){const r=e.toLowerCase();if(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase())||t.realm&&-1===r.indexOf(t.realm.toLowerCase())||t.requestedClaimsHash&&-1===r.indexOf(t.requestedClaimsHash.toLowerCase()))return!1;if(t.target){const o=t.target.asArray();for(let a=0;a<o.length;a++){if(n&&!r.includes(o[a].toLowerCase()))return!1;if(!n&&r.includes(o[a].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const n=this.getTokenKeys(),r=[];return n.accessToken.forEach(o=>{if(!this.accessTokenKeyMatchesFilter(o,e,!0))return;const a=this.getAccessTokenCredential(o,t);a&&this.credentialMatchesFilter(a,e)&&r.push(a)}),r}getRefreshToken(e,t,n,r,o){this.commonLogger.trace("CacheManager - getRefreshToken called");const c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l.aG.REFRESH_TOKEN,clientId:this.clientId,familyId:t?l.hB:void 0},d=r&&r.refreshToken||this.getTokenKeys().refreshToken,u=[];d.forEach(S=>{if(this.refreshTokenKeyMatchesFilter(S,c)){const w=this.getRefreshTokenCredential(S,n);w&&this.credentialMatchesFilter(w,c)&&u.push(w)}});const p=u.length;return p<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(p>1&&o&&n&&o.addFields({multiMatchedRT:p},n),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),u[0])}refreshTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.familyId&&-1===n.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===n.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e){const n=this.getAppMetadataFilteredBy({environment:e,clientId:this.clientId}),r=Object.keys(n).map(a=>n[a]),o=r.length;if(o<1)return null;if(o>1)throw(0,v.SB)(E.oV);return r[0]}isAppMetadataFOCI(e){const t=this.readAppMetadataFromCache(e);return!(!t||t.familyId!==l.hB)}matchHomeAccountId(e,t){return"string"==typeof e.homeAccountId&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return t.toLowerCase()===e.name?.toLowerCase()}matchUsername(e,t){return!(!e||"string"!=typeof e||t?.toLowerCase()!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){const r=function cr(s,e){let t;const n=s.canonicalAuthority;if(n){const r=new V.H(n).getUrlComponents().HostNameAndPort;t=fn(r,s.cloudDiscoveryMetadata?.metadata,l.E_.CONFIG,e)||fn(r,Rt.metadata,l.E_.HARDCODED_VALUES,e)||s.knownAuthorities}return t||[]}(this.staticAuthorityOptions,this.commonLogger);if(r.includes(t)&&r.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){return e.realm?.toLowerCase()===t.toLowerCase()}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){return!(e.credentialType!==l.aG.ACCESS_TOKEN&&e.credentialType!==l.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&re.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf(l.GU)}isAuthorityMetadata(e){return-1!==e.indexOf(l.u0.CACHE_KEY)}generateAuthorityMetadataCacheKey(e){return`${l.u0.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(const n in t)e[n]=t[n];return e}}class dr extends qe{setAccount(){throw(0,v.SB)(E.R9)}getAccount(){throw(0,v.SB)(E.R9)}getCachedAccountEntity(){throw(0,v.SB)(E.R9)}setIdTokenCredential(){throw(0,v.SB)(E.R9)}getIdTokenCredential(){throw(0,v.SB)(E.R9)}setAccessTokenCredential(){throw(0,v.SB)(E.R9)}getAccessTokenCredential(){throw(0,v.SB)(E.R9)}setRefreshTokenCredential(){throw(0,v.SB)(E.R9)}getRefreshTokenCredential(){throw(0,v.SB)(E.R9)}setAppMetadata(){throw(0,v.SB)(E.R9)}getAppMetadata(){throw(0,v.SB)(E.R9)}setServerTelemetry(){throw(0,v.SB)(E.R9)}getServerTelemetry(){throw(0,v.SB)(E.R9)}setAuthorityMetadata(){throw(0,v.SB)(E.R9)}getAuthorityMetadata(){throw(0,v.SB)(E.R9)}getAuthorityMetadataKeys(){throw(0,v.SB)(E.R9)}setThrottlingCache(){throw(0,v.SB)(E.R9)}getThrottlingCache(){throw(0,v.SB)(E.R9)}removeItem(){throw(0,v.SB)(E.R9)}getKeys(){throw(0,v.SB)(E.R9)}getAccountKeys(){throw(0,v.SB)(E.R9)}getTokenKeys(){throw(0,v.SB)(E.R9)}updateCredentialCacheKey(){throw(0,v.SB)(E.R9)}removeOutdatedAccount(){throw(0,v.SB)(E.R9)}}const An={tokenRenewalOffsetSeconds:l.F0,preventCorsPreflight:!1},ur={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Z.$.Info,correlationId:l.YM.EMPTY_STRING},hr={claimsBasedCachingEnabled:!1},gr={sendGetRequestAsync:()=>(0,C.A)(function*(){throw(0,v.SB)(E.R9)})(),sendPostRequestAsync:()=>(0,C.A)(function*(){throw(0,v.SB)(E.R9)})()},pr={sku:l.YM.SKU,version:Be,cpu:l.YM.EMPTY_STRING,os:l.YM.EMPTY_STRING},mr={clientSecret:l.YM.EMPTY_STRING,clientAssertion:void 0},fr={azureCloudInstance:"none",tenant:`${l.YM.DEFAULT_COMMON_TENANT}`},Cr={application:{appName:"",appVersion:""}};function Tr(s){return{clientCapabilities:[],azureCloudOptions:fr,skipAuthorityMetadataCache:!1,instanceAware:!1,...s}}function bt(s){return"OIDC"===s.authOptions.authority.options.protocolMode}const _r={sendGetRequestAsync:()=>Promise.reject((0,v.SB)(E.R9)),sendPostRequestAsync:()=>Promise.reject((0,v.SB)(E.R9))};var f=A(4561);class Tn{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}}class yr{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:f.hU.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new Tn}}startPerformanceMeasurement(){return new Tn}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}var g=A(7554),Ir=A(9511);class pt extends oe.lR{constructor(e,t,n){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,pt.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=n}}function _n(s,e,t){return new pt(s,e,t)}var O=A(6810),b=A(6588);class Er{sendGetRequestAsync(e,t){return(0,C.A)(function*(){let n,r={},o=0;const a=yn(t);try{n=yield fetch(e,{method:g.CC.GET,headers:a})}catch{throw(0,O.bD)(window.navigator.onLine?b.Zw:b.l7)}r=In(n.headers);try{return o=n.status,{headers:r,body:yield n.json(),status:o}}catch{throw _n((0,O.bD)(b.db),o,r)}})()}sendPostRequestAsync(e,t){return(0,C.A)(function*(){const n=t&&t.body||"",r=yn(t);let o,a=0,c={};try{o=yield fetch(e,{method:g.CC.POST,headers:r,body:n})}catch{throw(0,O.bD)(window.navigator.onLine?b.zv:b.l7)}c=In(o.headers);try{return a=o.status,{headers:c,body:yield o.json(),status:a}}catch{throw _n((0,O.bD)(b.db),a,c)}})()}}function yn(s){try{const e=new Headers;return s&&s.headers?(Object.entries(s.headers).forEach(([n,r])=>{e.append(n,r)}),e):e}catch{throw(0,O.bD)(b.Tw)}}function In(s){try{const e={};return s.forEach((t,n)=>{e[n]=t}),e}catch{throw(0,O.bD)(b.wI)}}var ee=A(1474);const Ot=1e4,Xe="3.30.0";class Pt{static loggerCallback(e,t){switch(e){case Z.$.Error:return void console.error(t);case Z.$.Info:return void console.info(t);case Z.$.Verbose:return void console.debug(t);case Z.$.Warning:return void console.warn(t);default:return void console.log(t)}}constructor(e){let t;this.browserEnvironment=typeof window<"u",this.config=function kr({auth:s,cache:e,system:t,telemetry:n},r){const o={clientId:l.YM.EMPTY_STRING,authority:`${l.YM.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:l.YM.EMPTY_STRING,authorityMetadata:l.YM.EMPTY_STRING,redirectUri:typeof window<"u"?(0,ee.Uu)():"",postLogoutRedirectUri:l.YM.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:"AAD",OIDCOptions:{serverResponseType:l.zL.FRAGMENT,defaultScopes:[l.YM.OPENID_SCOPE,l.YM.PROFILE_SCOPE,l.YM.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:"none",tenant:l.YM.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1},a={cacheLocation:g.Al.SessionStorage,temporaryCacheLocation:g.Al.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!(!e||e.cacheLocation!==g.Al.LocalStorage),claimsBasedCachingEnabled:!1},c={loggerCallback:()=>{},logLevel:Z.$.Info,piiLoggingEnabled:!1},u={...{...An,loggerOptions:c,networkClient:r?new Er:_r,navigationClient:new Ir.c,loadFrameTimeout:0,windowHashTimeout:t?.loadFrameTimeout||6e4,iframeHashTimeout:t?.loadFrameTimeout||Ot,navigateFrameWait:0,redirectNavigationTimeout:3e4,asyncPopups:!1,allowRedirectInIframe:!1,allowNativeBroker:!1,nativeBrokerHandshakeTimeout:t?.nativeBrokerHandshakeTimeout||2e3,pollIntervalMilliseconds:g.Q1.DEFAULT_POLL_INTERVAL_MS},...t,loggerOptions:t?.loggerOptions||c},p={application:{appName:l.YM.EMPTY_STRING,appVersion:l.YM.EMPTY_STRING},client:new yr};if("OIDC"!==s?.protocolMode&&s?.OIDCOptions&&new Z.V(u.loggerOptions).warning(JSON.stringify((0,te.aD)(ne.bg))),s?.protocolMode&&"AAD"!==s.protocolMode&&u?.allowNativeBroker)throw(0,te.aD)(ne.J6);return{auth:{...o,...s,OIDCOptions:{...o.OIDCOptions,...s?.OIDCOptions}},cache:{...a,...e},system:u,telemetry:{...p,...n}}}(e,this.browserEnvironment);try{t=window[g.Al.SessionStorage]}catch{}const n=t?.getItem(g.L$),r=t?.getItem(g.P3)?.toLowerCase(),o="true"===r||"false"!==r&&void 0,a={...this.config.system.loggerOptions},c=n&&Object.keys(Z.$).includes(n)?Z.$[n]:void 0;c&&(a.loggerCallback=Pt.loggerCallback,a.logLevel=c),void 0!==o&&(a.piiLoggingEnabled=o),this.logger=new Z.V(a,"@azure/msal-browser",Xe),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}let En=(()=>{class s extends Pt{getModuleName(){return s.MODULE_NAME}getId(){return s.ID}initialize(){var t=this;return(0,C.A)(function*(){return t.available=typeof window<"u",t.available})()}}return s.MODULE_NAME="",s.ID="StandardOperatingContext",s})();const vn="missing_kid_error",Sn="missing_alg_error",Mr={[vn]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Sn]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."};class Nt extends oe.lR{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,Nt.prototype)}}function Rn(s){return new Nt(s,Mr[s])}class Dt{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Rn(vn);if(!e.alg)throw Rn(Sn);const t=new Dt({typ:e.typ||l.Lz.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}var De=A(6195);function ke(s){return(new TextDecoder).decode(function br(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw(0,O.bD)(b._t)}const t=atob(e);return Uint8Array.from(t,n=>n.codePointAt(0)||0)}(s))}var ie=A(1510);class Or{constructor(){this.dbName=g.$u,this.version=g.G8,this.tableName=g.WJ,this.dbOpen=!1}open(){var e=this;return(0,C.A)(function*(){return new Promise((t,n)=>{const r=window.indexedDB.open(e.dbName,e.version);r.addEventListener("upgradeneeded",o=>{o.target.result.createObjectStore(e.tableName)}),r.addEventListener("success",o=>{e.db=o.target.result,e.dbOpen=!0,t()}),r.addEventListener("error",()=>n((0,O.bD)(b.MG)))})})()}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}validateDbIsOpen(){var e=this;return(0,C.A)(function*(){if(!e.dbOpen)return e.open()})()}getItem(e){var t=this;return(0,C.A)(function*(){return yield t.validateDbIsOpen(),new Promise((n,r)=>{if(!t.db)return r((0,O.bD)(b.rn));const c=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).get(e);c.addEventListener("success",d=>{const u=d;t.closeConnection(),n(u.target.result)}),c.addEventListener("error",d=>{t.closeConnection(),r(d)})})})()}setItem(e,t){var n=this;return(0,C.A)(function*(){return yield n.validateDbIsOpen(),new Promise((r,o)=>{if(!n.db)return o((0,O.bD)(b.rn));const d=n.db.transaction([n.tableName],"readwrite").objectStore(n.tableName).put(t,e);d.addEventListener("success",()=>{n.closeConnection(),r()}),d.addEventListener("error",u=>{n.closeConnection(),o(u)})})})()}removeItem(e){var t=this;return(0,C.A)(function*(){return yield t.validateDbIsOpen(),new Promise((n,r)=>{if(!t.db)return r((0,O.bD)(b.rn));const c=t.db.transaction([t.tableName],"readwrite").objectStore(t.tableName).delete(e);c.addEventListener("success",()=>{t.closeConnection(),n()}),c.addEventListener("error",d=>{t.closeConnection(),r(d)})})})()}getKeys(){var e=this;return(0,C.A)(function*(){return yield e.validateDbIsOpen(),new Promise((t,n)=>{if(!e.db)return n((0,O.bD)(b.rn));const a=e.db.transaction([e.tableName],"readonly").objectStore(e.tableName).getAllKeys();a.addEventListener("success",c=>{const d=c;e.closeConnection(),t(d.target.result)}),a.addEventListener("error",c=>{e.closeConnection(),n(c)})})})()}containsKey(e){var t=this;return(0,C.A)(function*(){return yield t.validateDbIsOpen(),new Promise((n,r)=>{if(!t.db)return r((0,O.bD)(b.rn));const c=t.db.transaction([t.tableName],"readonly").objectStore(t.tableName).count(e);c.addEventListener("success",d=>{const u=d;t.closeConnection(),n(1===u.target.result)}),c.addEventListener("error",d=>{t.closeConnection(),r(d)})})})()}deleteDatabase(){var e=this;return(0,C.A)(function*(){return e.db&&e.dbOpen&&e.closeConnection(),new Promise((t,n)=>{const r=window.indexedDB.deleteDatabase(g.$u),o=setTimeout(()=>n(!1),200);r.addEventListener("success",()=>(clearTimeout(o),t(!0))),r.addEventListener("blocked",()=>(clearTimeout(o),t(!0))),r.addEventListener("error",()=>(clearTimeout(o),n(!1)))})})()}}class Ut{constructor(){this.cache=new Map}getItem(e){return this.cache.get(e)||null}setItem(e,t){this.cache.set(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}}class Pr{constructor(e){this.inMemoryCache=new Ut,this.indexedDBCache=new Or,this.logger=e}handleDatabaseAccessError(e){if(!(e instanceof O.jT&&e.errorCode===b.MG))throw e;this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.")}getItem(e){var t=this;return(0,C.A)(function*(){const n=t.inMemoryCache.getItem(e);if(!n)try{return t.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),yield t.indexedDBCache.getItem(e)}catch(r){t.handleDatabaseAccessError(r)}return n})()}setItem(e,t){var n=this;return(0,C.A)(function*(){n.inMemoryCache.setItem(e,t);try{yield n.indexedDBCache.setItem(e,t)}catch(r){n.handleDatabaseAccessError(r)}})()}removeItem(e){var t=this;return(0,C.A)(function*(){t.inMemoryCache.removeItem(e);try{yield t.indexedDBCache.removeItem(e)}catch(n){t.handleDatabaseAccessError(n)}})()}getKeys(){var e=this;return(0,C.A)(function*(){const t=e.inMemoryCache.getKeys();if(0===t.length)try{return e.logger.verbose("In-memory cache is empty, now querying persistent storage."),yield e.indexedDBCache.getKeys()}catch(n){e.handleDatabaseAccessError(n)}return t})()}containsKey(e){var t=this;return(0,C.A)(function*(){const n=t.inMemoryCache.containsKey(e);if(!n)try{return t.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),yield t.indexedDBCache.containsKey(e)}catch(r){t.handleDatabaseAccessError(r)}return n})()}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}clearPersistent(){var e=this;return(0,C.A)(function*(){try{e.logger.verbose("Deleting persistent keystore");const t=yield e.indexedDBCache.deleteDatabase();return t&&e.logger.verbose("Persistent keystore deleted"),t}catch(t){return e.handleDatabaseAccessError(t),!1}})()}}let Nr=(()=>{class s{constructor(t,n,r){this.logger=t,(0,ie.RW)(r??!1),this.cache=new Pr(this.logger),this.performanceClient=n}createNewGuid(){return(0,ie.Oy)()}base64Encode(t){return(0,De.KA)(t)}base64Decode(t){return ke(t)}base64UrlEncode(t){return(0,De.u4)(t)}encodeKid(t){return this.base64UrlEncode(JSON.stringify({kid:t}))}getPublicKeyThumbprint(t){var n=this;return(0,C.A)(function*(){const r=n.performanceClient?.startMeasurement(f.MX.CryptoOptsGetPublicKeyThumbprint,t.correlationId),o=yield(0,ie.TZ)(s.EXTRACTABLE,s.POP_KEY_USAGES),a=yield(0,ie.RI)(o.publicKey),d=kn({e:a.e,kty:a.kty,n:a.n}),u=yield n.hashString(d),p=yield(0,ie.RI)(o.privateKey),S=yield(0,ie.W6)(p,!1,["sign"]);return yield n.cache.setItem(u,{privateKey:S,publicKey:o.publicKey,requestMethod:t.resourceRequestMethod,requestUri:t.resourceRequestUri}),r&&r.end({success:!0}),u})()}removeTokenBindingKey(t){var n=this;return(0,C.A)(function*(){return yield n.cache.removeItem(t),!(yield n.cache.containsKey(t))})()}clearKeystore(){var t=this;return(0,C.A)(function*(){t.cache.clearInMemory();try{return yield t.cache.clearPersistent(),!0}catch(n){return n instanceof Error?t.logger.error(`Clearing keystore failed with error: ${n.message}`):t.logger.error("Clearing keystore failed with unknown error"),!1}})()}signJwt(t,n,r,o){var a=this;return(0,C.A)(function*(){const c=a.performanceClient?.startMeasurement(f.MX.CryptoOptsSignJwt,o),d=yield a.cache.getItem(n);if(!d)throw(0,O.bD)(b.e0);const u=yield(0,ie.RI)(d.publicKey),p=kn(u),S=(0,De.u4)(JSON.stringify({kid:n})),w=Dt.getShrHeaderString({...r?.header,alg:u.alg,kid:S}),D=(0,De.u4)(w);t.cnf={jwk:JSON.parse(p)};const F=`${D}.${(0,De.u4)(JSON.stringify(t))}`,ve=(new TextEncoder).encode(F),fe=yield(0,ie._S)(d.privateKey,ve),at=`${F}.${(0,De.dB)(new Uint8Array(fe))}`;return c&&c.end({success:!0}),at})()}hashString(t){return(0,C.A)(function*(){return(0,ie.YZ)(t)})()}}return s.POP_KEY_USAGES=["sign","verify"],s.EXTRACTABLE=!0,s})();function kn(s){return JSON.stringify(s,Object.keys(s).sort())}const xe=(s,e,t,n,r)=>(...o)=>{t.trace(`Executing function ${e}`);const a=n?.startMeasurement(e,r);if(r){const c=e+"CallCount";n?.incrementFields({[c]:1},r)}try{const c=s(...o);return a?.end({success:!0}),t.trace(`Returning result from ${e}`),c}catch(c){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw a?.end({success:!1},c),c}},k=(s,e,t,n,r)=>(...o)=>{t.trace(`Executing function ${e}`);const a=n?.startMeasurement(e,r);if(r){const c=e+"CallCount";n?.incrementFields({[c]:1},r)}return n?.setPreQueueTime(e,r),s(...o).then(c=>(t.trace(`Returning result from ${e}`),a?.end({success:!0}),c)).catch(c=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(c))}catch{t.trace("Unable to print error message.")}throw a?.end({success:!1},c),c})};let Hr=(()=>{class s{constructor(t,n,r,o){this.networkInterface=t,this.logger=n,this.performanceClient=r,this.correlationId=o}detectRegion(t,n){var r=this;return(0,C.A)(function*(){r.performanceClient?.addQueueMeasurement(f.MX.RegionDiscoveryDetectRegion,r.correlationId);let o=t;if(o)n.region_source=l.jZ.ENVIRONMENT_VARIABLE;else{const a=s.IMDS_OPTIONS;try{const c=yield k(r.getRegionFromIMDS.bind(r),f.MX.RegionDiscoveryGetRegionFromIMDS,r.logger,r.performanceClient,r.correlationId)(l.YM.IMDS_VERSION,a);if(c.status===l.Kk.httpSuccess&&(o=c.body,n.region_source=l.jZ.IMDS),c.status===l.Kk.httpBadRequest){const d=yield k(r.getCurrentVersion.bind(r),f.MX.RegionDiscoveryGetCurrentVersion,r.logger,r.performanceClient,r.correlationId)(a);if(!d)return n.region_source=l.jZ.FAILED_AUTO_DETECTION,null;const u=yield k(r.getRegionFromIMDS.bind(r),f.MX.RegionDiscoveryGetRegionFromIMDS,r.logger,r.performanceClient,r.correlationId)(d,a);u.status===l.Kk.httpSuccess&&(o=u.body,n.region_source=l.jZ.IMDS)}}catch{return n.region_source=l.jZ.FAILED_AUTO_DETECTION,null}}return o||(n.region_source=l.jZ.FAILED_AUTO_DETECTION),o||null})()}getRegionFromIMDS(t,n){var r=this;return(0,C.A)(function*(){return r.performanceClient?.addQueueMeasurement(f.MX.RegionDiscoveryGetRegionFromIMDS,r.correlationId),r.networkInterface.sendGetRequestAsync(`${l.YM.IMDS_ENDPOINT}?api-version=${t}&format=text`,n,l.YM.IMDS_TIMEOUT)})()}getCurrentVersion(t){var n=this;return(0,C.A)(function*(){n.performanceClient?.addQueueMeasurement(f.MX.RegionDiscoveryGetCurrentVersion,n.correlationId);try{const r=yield n.networkInterface.sendGetRequestAsync(`${l.YM.IMDS_ENDPOINT}?format=json`,t);return r.status===l.Kk.httpBadRequest&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}})()}}return s.IMDS_OPTIONS={headers:{Metadata:"true"}},s})();class ge{constructor(e,t,n,r,o,a,c,d){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=r,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=c,this.correlationId=a,this.managedIdentity=d||!1,this.regionDiscovery=new Hr(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(l.YM.CIAM_AUTH_URL))return 3;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case l.YM.ADFS:return 1;case l.YM.DSTS:return 2}return 0}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new V.H(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw(0,v.SB)(E.s1)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw(0,v.SB)(E.s1)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw(0,v.SB)(E.s1)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw(0,v.SB)(E.yX);return this.replacePath(this.metadata.end_session_endpoint)}throw(0,v.SB)(E.s1)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw(0,v.SB)(E.s1)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw(0,v.SB)(E.s1)}canReplaceTenant(e){return 1===e.PathSegments.length&&!ge.reservedTenantDomains.has(e.PathSegments[0])&&0===this.getAuthorityType(e)&&"AAD"===this.protocolMode}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const r=new V.H(this.metadata.canonical_authority).getUrlComponents(),o=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((c,d)=>{let u=o[d];if(0===d&&this.canReplaceTenant(r)){const p=new V.H(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];u!==p&&(this.logger.verbose(`Replacing tenant domain name ${u} with id ${p}`),u=p)}c!==u&&(t=t.replace(`/${u}/`,`/${c}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||1===this.authorityType||"AAD"!==this.protocolMode&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}resolveEndpointsAsync(){var e=this;return(0,C.A)(function*(){e.performanceClient?.addQueueMeasurement(f.MX.AuthorityResolveEndpointsAsync,e.correlationId);const t=e.getCurrentMetadataEntity(),n=yield k(e.updateCloudDiscoveryMetadata.bind(e),f.MX.AuthorityUpdateCloudDiscoveryMetadata,e.logger,e.performanceClient,e.correlationId)(t);e.canonicalAuthority=e.canonicalAuthority.replace(e.hostnameAndPort,t.preferred_network);const r=yield k(e.updateEndpointMetadata.bind(e),f.MX.AuthorityUpdateEndpointMetadata,e.logger,e.performanceClient,e.correlationId)(t);e.updateCachedMetadata(t,n,{source:r}),e.performanceClient?.addFields({cloudDiscoverySource:n,authorityEndpointSource:r},e.correlationId)})()}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:dn(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==l.E_.CACHE&&n?.source!==l.E_.CACHE&&(e.expiresAt=dn(),e.canonical_authority=this.canonicalAuthority);const r=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(r,e),this.metadata=e}updateEndpointMetadata(e){var t=this;return(0,C.A)(function*(){t.performanceClient?.addQueueMeasurement(f.MX.AuthorityUpdateEndpointMetadata,t.correlationId);const n=t.updateEndpointMetadataFromLocalSources(e);if(n){if(n.source===l.E_.HARDCODED_VALUES&&t.authorityOptions.azureRegionConfiguration?.azureRegion&&n.metadata){const o=yield k(t.updateMetadataWithRegionalInformation.bind(t),f.MX.AuthorityUpdateMetadataWithRegionalInformation,t.logger,t.performanceClient,t.correlationId)(n.metadata);dt(e,o,!1),e.canonical_authority=t.canonicalAuthority}return n.source}let r=yield k(t.getEndpointMetadataFromNetwork.bind(t),f.MX.AuthorityGetEndpointMetadataFromNetwork,t.logger,t.performanceClient,t.correlationId)();if(r)return t.authorityOptions.azureRegionConfiguration?.azureRegion&&(r=yield k(t.updateMetadataWithRegionalInformation.bind(t),f.MX.AuthorityUpdateMetadataWithRegionalInformation,t.logger,t.performanceClient,t.correlationId)(r)),dt(e,r,!0),l.E_.NETWORK;throw(0,v.SB)(E.Ej,t.defaultOpenIdConfigurationEndpoint)})()}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),dt(e,t,!1),{source:l.E_.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{const r=this.getEndpointMetadataFromHardcodedValues();if(r)return dt(e,r,!1),{source:l.E_.HARDCODED_VALUES,metadata:r};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}const n=un(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("Found endpoint metadata in the cache."),{source:l.E_.CACHE}):(n&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new V.H(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw(0,te.aD)(ne.uk)}return null}getEndpointMetadataFromNetwork(){var e=this;return(0,C.A)(function*(){e.performanceClient?.addQueueMeasurement(f.MX.AuthorityGetEndpointMetadataFromNetwork,e.correlationId);const t={},n=e.defaultOpenIdConfigurationEndpoint;e.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${n}`);try{const r=yield e.networkInterface.sendGetRequestAsync(n,t);return function Dr(s){return s.hasOwnProperty("authorization_endpoint")&&s.hasOwnProperty("token_endpoint")&&s.hasOwnProperty("issuer")&&s.hasOwnProperty("jwks_uri")}(r.body)?r.body:(e.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(r){return e.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${r}`),null}})()}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in pn?pn[this.hostnameAndPort]:null}updateMetadataWithRegionalInformation(e){var t=this;return(0,C.A)(function*(){t.performanceClient?.addQueueMeasurement(f.MX.AuthorityUpdateMetadataWithRegionalInformation,t.correlationId);const n=t.authorityOptions.azureRegionConfiguration?.azureRegion;if(n){if(n!==l.YM.AZURE_REGION_AUTO_DISCOVER_FLAG)return t.regionDiscoveryMetadata.region_outcome=l._2.CONFIGURED_NO_AUTO_DETECTION,t.regionDiscoveryMetadata.region_used=n,ge.replaceWithRegionalInformation(e,n);const r=yield k(t.regionDiscovery.detectRegion.bind(t.regionDiscovery),f.MX.RegionDiscoveryDetectRegion,t.logger,t.performanceClient,t.correlationId)(t.authorityOptions.azureRegionConfiguration?.environmentRegion,t.regionDiscoveryMetadata);if(r)return t.regionDiscoveryMetadata.region_outcome=l._2.AUTO_DETECTION_REQUESTED_SUCCESSFUL,t.regionDiscoveryMetadata.region_used=r,ge.replaceWithRegionalInformation(e,r);t.regionDiscoveryMetadata.region_outcome=l._2.AUTO_DETECTION_REQUESTED_FAILED}return e})()}updateCloudDiscoveryMetadata(e){var t=this;return(0,C.A)(function*(){t.performanceClient?.addQueueMeasurement(f.MX.AuthorityUpdateCloudDiscoveryMetadata,t.correlationId);const n=t.updateCloudDiscoveryMetadataFromLocalSources(e);if(n)return n;const r=yield k(t.getCloudDiscoveryMetadataFromNetwork.bind(t),f.MX.AuthorityGetCloudDiscoveryMetadataFromNetwork,t.logger,t.performanceClient,t.correlationId)();if(r)return Et(e,r,!0),l.E_.NETWORK;throw(0,te.aD)(ne.E0)})()}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||l.YM.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||l.YM.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||l.YM.NOT_APPLICABLE}`);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),Et(e,t,!1),l.E_.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{const r=function lr(s){return gt(Rt.metadata,s)}(this.hostnameAndPort);if(r)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),Et(e,r,!1),l.E_.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}const n=un(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!n?(this.logger.verbose("Found cloud discovery metadata in the cache."),l.E_.CACHE):(n&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(3===this.authorityType)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),ge.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");const t=gt(JSON.parse(this.authorityOptions.cloudDiscoveryMetadata).metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),(0,te.aD)(ne.a_)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),ge.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}getCloudDiscoveryMetadataFromNetwork(){var e=this;return(0,C.A)(function*(){e.performanceClient?.addQueueMeasurement(f.MX.AuthorityGetCloudDiscoveryMetadataFromNetwork,e.correlationId);const t=`${l.YM.AAD_INSTANCE_DISCOVERY_ENDPT}${e.canonicalAuthority}oauth2/v2.0/authorize`,n={};let r=null;try{const o=yield e.networkInterface.sendGetRequestAsync(t,n);let a,c;if(function Ur(s){return s.hasOwnProperty("tenant_discovery_endpoint")&&s.hasOwnProperty("metadata")}(o.body))a=o.body,c=a.metadata,e.logger.verbosePii(`tenant_discovery_endpoint is: ${a.tenant_discovery_endpoint}`);else{if(!function Lr(s){return s.hasOwnProperty("error")&&s.hasOwnProperty("error_description")}(o.body))return e.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;if(e.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),a=o.body,a.error===l.YM.INVALID_INSTANCE)return e.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;e.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${a.error}`),e.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${a.error_description}`),e.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),c=[]}e.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=gt(c,e.hostnameAndPort)}catch(o){return e.logger.error(o instanceof oe.lR?`There was a network error while attempting to get the cloud discovery instance metadata.\nError: ${o.errorCode}\nError Description: ${o.errorMessage}`:`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.\nError: ${o.name}\nError Description: ${o.message}`),null}return r||(e.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),e.logger.verbose("Creating custom Authority for custom domain scenario."),r=ge.createCloudDiscoveryMetadataFromHost(e.hostnameAndPort)),r})()}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&V.H.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;return t&&"none"!==t.azureCloudInstance&&(n=`${t.azureCloudInstance}/${t.tenant?t.tenant:l.YM.DEFAULT_COMMON_TENANT}/`),n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return l.YM.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw(0,v.SB)(E.s1)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return mn.has(e)}static isPublicCloudAuthority(e){return l.YM.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){const r=new V.H(e);r.validateAsUri();const o=r.getUrlComponents();let a=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(a=`${t}.${l.YM.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);const c=V.H.constructAuthorityUriFromObject({...r.getUrlComponents(),HostNameAndPort:a}).urlString;return n?`${c}?${n}`:c}static replaceWithRegionalInformation(e,t){const n={...e};return n.authorization_endpoint=ge.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=ge.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=ge.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const r=new V.H(e).getUrlComponents();return 0===r.PathSegments.length&&r.HostNameAndPort.endsWith(l.YM.CIAM_AUTH_URL)&&(t=`${t}${r.HostNameAndPort.split(".")[0]}${l.YM.AAD_TENANT_DOMAIN_SUFFIX}`),t}}function wn(s){return s.endsWith(l.YM.FORWARD_SLASH)?s:`${s}${l.YM.FORWARD_SLASH}`}ge.reservedTenantDomains=new Set(["{tenant}","{tenantid}",l.v2.COMMON,l.v2.CONSUMERS,l.v2.ORGANIZATIONS]);const je="no_tokens_found",mt="native_account_unavailable",Lt="refresh_token_expired",We="bad_token",Mn=["interaction_required","consent_required","login_required",We],Yr=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],ft={[je]:"No refresh token found in the cache. Please sign-in.",[mt]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[Lt]:"Refresh token has expired.",[We]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."};class Ie extends oe.lR{constructor(e,t,n,r,o,a,c,d){super(e,t,n),Object.setPrototypeOf(this,Ie.prototype),this.timestamp=r||l.YM.EMPTY_STRING,this.traceId=o||l.YM.EMPTY_STRING,this.correlationId=a||l.YM.EMPTY_STRING,this.claims=c||l.YM.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=d}}function bn(s,e,t){const n=!!s&&Mn.indexOf(s)>-1,r=!!t&&Yr.indexOf(t)>-1,o=!!e&&Mn.some(a=>e.indexOf(a)>-1);return n||o||r}function Ht(s){return new Ie(s,ft[s])}class Ee{static setRequestState(e,t,n){const r=Ee.generateLibraryState(e,n);return t?`${r}${l.YM.RESOURCE_DELIM}${t}`:r}static generateLibraryState(e,t){if(!e)throw(0,v.SB)(E.oL);const n={id:e.createNewGuid()};t&&(n.meta=t);const r=JSON.stringify(n);return e.base64Encode(r)}static parseRequestState(e,t){if(!e)throw(0,v.SB)(E.oL);if(!t)throw(0,v.SB)(E.f$);try{const n=t.split(l.YM.RESOURCE_DELIM),r=n[0],o=n.length>1?n.slice(1).join(l.YM.RESOURCE_DELIM):l.YM.EMPTY_STRING,a=e.base64Decode(r),c=JSON.parse(a);return{userRequestState:o||l.YM.EMPTY_STRING,libraryState:c}}catch{throw(0,v.SB)(E.f$)}}}var On=A(4064),Pn=A(3578);class zr{constructor(){if(!window.localStorage)throw(0,On.jz)(Pn.xz)}getItem(e){return window.localStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}removeItem(e){window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}}class $r{constructor(){if(!window.sessionStorage)throw(0,On.jz)(Pn.xz)}getItem(e){return window.sessionStorage.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}}function Nn(s,e){if(!e)return null;try{return Ee.parseRequestState(s,e).libraryState.meta}catch{throw(0,v.SB)(E.f$)}}class Xr{getItem(e){const t=`${encodeURIComponent(e)}`,n=document.cookie.split(";");for(let r=0;r<n.length;r++){const o=n[r],[a,...c]=decodeURIComponent(o).trim().split("="),d=c.join("=");if(a===t)return d}return""}setItem(e,t,n,r=!0){let o=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=Lax;`;if(n){o+=`expires=${function jr(s){return new Date((new Date).getTime()+864e5*s).toUTCString()}(n)};`}r&&(o+="Secure;"),document.cookie=o}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(n=>{const r=decodeURIComponent(n).trim().split("=");t.push(r[0])}),t}containsKey(e){return this.getKeys().includes(e)}}class Bt extends qe{constructor(e,t,n,r,o,a){super(e,n,r,o),this.cacheConfig=t,this.logger=r,this.internalStorage=new Ut,this.browserStorage=this.setupBrowserStorage(this.cacheConfig.cacheLocation),this.temporaryCacheStorage=this.setupBrowserStorage(this.cacheConfig.temporaryCacheLocation),this.cookieStorage=new Xr,t.cacheMigrationEnabled&&(this.migrateCacheEntries(),this.createKeyMaps()),this.performanceClient=a}setupBrowserStorage(e){try{switch(e){case g.Al.LocalStorage:return new zr;case g.Al.SessionStorage:return new $r}}catch(t){this.logger.error(t)}return this.cacheConfig.cacheLocation=g.Al.MemoryStorage,new Ut}migrateCacheEntries(){const e=this.browserStorage.getItem(g.dh.VERSION);e&&this.logger.info(`MSAL.js was last initialized with version ${e}`),e!==Xe&&this.browserStorage.setItem(g.dh.VERSION,Xe);const n=`${l.YM.CACHE_PREFIX}.${l.Gd.CLIENT_INFO}`,r=`${l.YM.CACHE_PREFIX}.${l.Gd.ERROR}`,o=`${l.YM.CACHE_PREFIX}.${l.Gd.ERROR_DESC}`,p=[this.browserStorage.getItem(`${l.YM.CACHE_PREFIX}.${l.Gd.ID_TOKEN}`),this.browserStorage.getItem(n),this.browserStorage.getItem(r),this.browserStorage.getItem(o)];[l.Gd.ID_TOKEN,l.Gd.CLIENT_INFO,l.Gd.ERROR,l.Gd.ERROR_DESC].forEach((w,D)=>{const Y=p[D];Y&&this.setTemporaryCache(w,Y,!0)})}createKeyMaps(){this.logger.trace("BrowserCacheManager - createKeyMaps called.");const e=this.cryptoImpl.createNewGuid(),t=this.getItem(g.dh.ACCOUNT_KEYS),n=this.getItem(`${g.dh.TOKEN_KEYS}.${this.clientId}`);t&&n?this.logger.verbose("BrowserCacheManager:createKeyMaps - account and token key maps already exist, skipping migration."):this.browserStorage.getKeys().forEach(o=>{if(this.isCredentialKey(o)){const a=this.getItem(o);if(a){const c=this.validateAndParseJson(a);if(c&&c.hasOwnProperty("credentialType"))switch(c.credentialType){case l.aG.ID_TOKEN:if(cn(c)){this.logger.trace("BrowserCacheManager:createKeyMaps - idToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - idToken with key: ${o} found, saving key to token key map`);const u=this.updateCredentialCacheKey(o,c,e);return void this.addTokenKey(u,l.aG.ID_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching idToken schema with value containing idToken credentialType field but value failed IdTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed idToken validation on key: ${o}`);break;case l.aG.ACCESS_TOKEN:case l.aG.ACCESS_TOKEN_WITH_AUTH_SCHEME:if(sn(c)){this.logger.trace("BrowserCacheManager:createKeyMaps - accessToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - accessToken with key: ${o} found, saving key to token key map`);const u=this.updateCredentialCacheKey(o,c,e);return void this.addTokenKey(u,l.aG.ACCESS_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching accessToken schema with value containing accessToken credentialType field but value failed AccessTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed accessToken validation on key: ${o}`);break;case l.aG.REFRESH_TOKEN:if(ln(c)){this.logger.trace("BrowserCacheManager:createKeyMaps - refreshToken found, saving key to token key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - refreshToken with key: ${o} found, saving key to token key map`);const u=this.updateCredentialCacheKey(o,c,e);return void this.addTokenKey(u,l.aG.REFRESH_TOKEN,e)}this.logger.trace("BrowserCacheManager:createKeyMaps - key found matching refreshToken schema with value containing refreshToken credentialType field but value failed RefreshTokenEntity validation, skipping."),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - failed refreshToken validation on key: ${o}`)}}}if(this.isAccountKey(o)){const a=this.getItem(o);if(a){const c=this.validateAndParseJson(a);c&&ce.isAccountEntity(c)&&(this.logger.trace("BrowserCacheManager:createKeyMaps - account found, saving key to account key map"),this.logger.tracePii(`BrowserCacheManager:createKeyMaps - account with key: ${o} found, saving key to account key map`),this.addAccountKeyToMap(o,e))}}})}validateAndParseJson(e){try{const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch{return null}}getItem(e){return this.browserStorage.getItem(e)}setItem(e,t,n){let r=[];for(let a=0;a<=20;a++)try{this.browserStorage.setItem(e,t),a>0&&this.removeAccessTokenKeys(r.slice(0,a),n);break}catch(c){const d=Cn(c);if(!(d.errorCode===kt&&a<20))throw d;if(r.length||(r=e===`${g.dh.TOKEN_KEYS}.${this.clientId}`?JSON.parse(t).accessToken:this.getTokenKeys().accessToken),r.length<=a)throw d;this.removeAccessToken(r[a],n,!1)}}getAccount(e,t,n){this.logger.trace("BrowserCacheManager.getAccount called");const r=this.getCachedAccountEntity(e,t);return this.updateOutdatedCachedAccount(e,r,t,n)}getCachedAccountEntity(e,t){const n=this.getItem(e);if(!n)return this.removeAccountKeyFromMap(e,t),null;const r=this.validateAndParseJson(n);return r&&ce.isAccountEntity(r)?qe.toObject(new ce,r):null}setAccount(e,t){this.logger.trace("BrowserCacheManager.setAccount called");const n=e.generateAccountKey();e.lastUpdatedAt=Date.now().toString(),this.setItem(n,JSON.stringify(e),t),this.addAccountKeyToMap(n,t)}getAccountKeys(){this.logger.trace("BrowserCacheManager.getAccountKeys called");const e=this.getItem(g.dh.ACCOUNT_KEYS);return e?JSON.parse(e):(this.logger.verbose("BrowserCacheManager.getAccountKeys - No account keys found"),[])}addAccountKeyToMap(e,t){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);const n=this.getAccountKeys();-1===n.indexOf(e)?(n.push(e),this.setItem(g.dh.ACCOUNT_KEYS,JSON.stringify(n),t),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added")):this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map")}removeAccountKeyFromMap(e,t){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);const n=this.getAccountKeys(),r=n.indexOf(e);if(r>-1){if(n.splice(r,1),0===n.length)return void this.removeItem(g.dh.ACCOUNT_KEYS);this.setItem(g.dh.ACCOUNT_KEYS,JSON.stringify(n),t),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")}else this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e,t){var n=()=>super.removeAccount,r=this;return(0,C.A)(function*(){n().call(r,e,t),r.removeAccountKeyFromMap(e,t)})()}removeOutdatedAccount(e,t){this.removeItem(e),this.removeAccountKeyFromMap(e,t)}removeIdToken(e,t){super.removeIdToken(e,t),this.removeTokenKey(e,l.aG.ID_TOKEN,t)}removeAccessToken(e,t,n=!0){super.removeAccessToken(e,t),this.performanceClient?.incrementFields({accessTokensRemoved:1},t),n&&this.removeTokenKey(e,l.aG.ACCESS_TOKEN,t)}removeAccessTokenKeys(e,t){this.logger.trace("removeAccessTokenKey called");const n=this.getTokenKeys();let r=0;if(e.forEach(o=>{const a=n.accessToken.indexOf(o);a>-1&&(n.accessToken.splice(a,1),r++)}),r>0)return this.logger.info(`removed ${r} accessToken keys from tokenKeys map`),void this.setTokenKeys(n,t)}removeRefreshToken(e,t){super.removeRefreshToken(e,t),this.removeTokenKey(e,l.aG.REFRESH_TOKEN,t)}getTokenKeys(){this.logger.trace("BrowserCacheManager.getTokenKeys called");const e=this.getItem(`${g.dh.TOKEN_KEYS}.${this.clientId}`);if(e){const t=this.validateAndParseJson(e);if(t&&t.hasOwnProperty("idToken")&&t.hasOwnProperty("accessToken")&&t.hasOwnProperty("refreshToken"))return t;this.logger.error("BrowserCacheManager.getTokenKeys - Token keys found but in an unknown format. Returning empty key map.")}else this.logger.verbose("BrowserCacheManager.getTokenKeys - No token keys found");return{idToken:[],accessToken:[],refreshToken:[]}}setTokenKeys(e,t){0!==e.idToken.length||0!==e.accessToken.length||0!==e.refreshToken.length?this.setItem(`${g.dh.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(e),t):this.removeItem(`${g.dh.TOKEN_KEYS}.${this.clientId}`)}addTokenKey(e,t,n){this.logger.trace("BrowserCacheManager addTokenKey called");const r=this.getTokenKeys();switch(t){case l.aG.ID_TOKEN:-1===r.idToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case l.aG.ACCESS_TOKEN:const o=r.accessToken.indexOf(e);-1!==o&&r.accessToken.splice(o,1),this.logger.trace(`access token ${-1===o?"added to":"updated in"} map`),r.accessToken.push(e);break;case l.aG.REFRESH_TOKEN:-1===r.refreshToken.indexOf(e)&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),(0,v.SB)(E.Zj)}this.setTokenKeys(r,n)}removeTokenKey(e,t,n,r=this.getTokenKeys()){switch(this.logger.trace("BrowserCacheManager removeTokenKey called"),t){case l.aG.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);const o=r.idToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case l.aG.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);const a=r.accessToken.indexOf(e);a>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(a,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case l.aG.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);const c=r.refreshToken.indexOf(e);c>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(c,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),(0,v.SB)(E.Zj)}this.setTokenKeys(r,n)}getIdTokenCredential(e,t){const n=this.getItem(e);if(!n)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeIdToken(e,t),null;const r=this.validateAndParseJson(n);return r&&cn(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),null)}setIdTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");const n=Ye(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(n,JSON.stringify(e),t),this.addTokenKey(n,l.aG.ID_TOKEN,t)}getAccessTokenCredential(e,t){const n=this.getItem(e);if(!n)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,l.aG.ACCESS_TOKEN,t),null;const r=this.validateAndParseJson(n);return r&&sn(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),null)}setAccessTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");const n=Ye(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(n,JSON.stringify(e),t),this.addTokenKey(n,l.aG.ACCESS_TOKEN,t)}getRefreshTokenCredential(e,t){const n=this.getItem(e);if(!n)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,l.aG.REFRESH_TOKEN,t),null;const r=this.validateAndParseJson(n);return r&&ln(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),null)}setRefreshTokenCredential(e,t){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");const n=Ye(e);e.lastUpdatedAt=Date.now().toString(),this.setItem(n,JSON.stringify(e),t),this.addTokenKey(n,l.aG.REFRESH_TOKEN,t)}getAppMetadata(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&function ar(s,e){return!!e&&0===s.indexOf(l.GU)&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment")}(e,n)?(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),n):(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null)}setAppMetadata(e,t){this.logger.trace("BrowserCacheManager.setAppMetadata called");const n=function ir({environment:s,clientId:e}){return[l.GU,s,e].join(l.LR.CACHE_KEY_SEPARATOR).toLowerCase()}(e);this.setItem(n,JSON.stringify(e),t)}getServerTelemetry(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&function rr(s,e){const t=0===s.indexOf(l.gT.CACHE_KEY);let n=!0;return e&&(n=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&n}(e,n)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),n):(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null)}setServerTelemetry(e,t,n){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.setItem(e,JSON.stringify(t),n)}getAuthorityMetadata(e){const t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&function sr(s,e){return!!e&&0===s.indexOf(l.u0.CACHE_KEY)&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri")}(e,n)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(g.H3.WRAPPER_SKU,e),this.internalStorage.setItem(g.H3.WRAPPER_VER,t)}getWrapperMetadata(){return[this.internalStorage.getItem(g.H3.WRAPPER_SKU)||l.YM.EMPTY_STRING,this.internalStorage.getItem(g.H3.WRAPPER_VER)||l.YM.EMPTY_STRING]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(l.Gd.ACTIVE_ACCOUNT_FILTERS),n=this.getItem(t);if(!n){this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters cache schema found, looking for legacy schema");const o=this.generateCacheKey(l.Gd.ACTIVE_ACCOUNT),a=this.getItem(o);if(!a)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null;const c=this.getAccountInfoFilteredBy({localAccountId:a},e);return c?(this.logger.trace("BrowserCacheManager.getActiveAccount: Legacy active account cache schema found"),this.logger.trace("BrowserCacheManager.getActiveAccount: Adding active account filters cache schema"),this.setActiveAccount(c,e),c):null}const r=this.validateAndParseJson(n);return r?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId,tenantId:r.tenantId},e)):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e,t){const n=this.generateCacheKey(l.Gd.ACTIVE_ACCOUNT_FILTERS),r=this.generateCacheKey(l.Gd.ACTIVE_ACCOUNT);if(e){this.logger.verbose("setActiveAccount: Active account set");const o={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId,lastUpdatedAt:Date.now().toString()};this.setItem(n,JSON.stringify(o),t),this.setItem(r,e.localAccountId,t)}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(n),this.browserStorage.removeItem(r)}getThrottlingCache(e){const t=this.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;const n=this.validateAndParseJson(t);return n&&function or(s,e){let t=!1;s&&(t=0===s.indexOf(l.Xw.THROTTLING_PREFIX));let n=!0;return e&&(n=e.hasOwnProperty("throttleTime")),t&&n}(e,n)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),n):(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null)}setThrottlingCache(e,t,n){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.setItem(e,JSON.stringify(t),n)}getTemporaryCache(e,t){const n=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){const o=this.cookieStorage.getItem(n);if(o)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),o}const r=this.temporaryCacheStorage.getItem(n);if(!r){if(this.cacheConfig.cacheLocation===g.Al.LocalStorage){const o=this.browserStorage.getItem(n);if(o)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),o}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),r}setTemporaryCache(e,t,n){const r=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(r,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(r,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(e){var t=this;return(0,C.A)(function*(){yield t.removeAllAccounts(e),t.removeAppMetadata(e),t.temporaryCacheStorage.getKeys().forEach(n=>{(-1!==n.indexOf(l.YM.CACHE_PREFIX)||-1!==n.indexOf(t.clientId))&&t.removeTemporaryItem(n)}),t.browserStorage.getKeys().forEach(n=>{(-1!==n.indexOf(l.YM.CACHE_PREFIX)||-1!==n.indexOf(t.clientId))&&t.browserStorage.removeItem(n)}),t.internalStorage.clear()})()}clearTokensAndKeysWithClaims(e,t){var n=this;return(0,C.A)(function*(){e.addQueueMeasurement(f.MX.ClearTokensAndKeysWithClaims,t);const r=n.getTokenKeys();let o=0;r.accessToken.forEach(a=>{const c=n.getAccessTokenCredential(a,t);c?.requestedClaimsHash&&a.includes(c.requestedClaimsHash.toLowerCase())&&(n.removeAccessToken(a,t),o++)}),o>0&&n.logger.warning(`${o} access tokens with claims in the cache keys have been removed from the cache.`)})()}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):Le.$.startsWith(e,l.YM.CACHE_PREFIX)||Le.$.startsWith(e,l.Gd.ADAL_ID_TOKEN)?e:`${l.YM.CACHE_PREFIX}.${this.clientId}.${e}`}generateAuthorityKey(e){const{libraryState:{id:t}}=Ee.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${g._p.AUTHORITY}.${t}`)}generateNonceKey(e){const{libraryState:{id:t}}=Ee.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${g._p.NONCE_IDTOKEN}.${t}`)}generateStateKey(e){const{libraryState:{id:t}}=Ee.parseRequestState(this.cryptoImpl,e);return this.generateCacheKey(`${g._p.REQUEST_STATE}.${t}`)}getCachedAuthority(e){const t=this.generateStateKey(e),n=this.getTemporaryCache(t);if(!n)return null;const r=this.generateAuthorityKey(n);return this.getTemporaryCache(r)}updateCacheEntries(e,t,n,r,o){this.logger.trace("BrowserCacheManager.updateCacheEntries called");const a=this.generateStateKey(e);this.setTemporaryCache(a,e,!1);const c=this.generateNonceKey(e);this.setTemporaryCache(c,t,!1);const d=this.generateAuthorityKey(e);this.setTemporaryCache(d,n,!1),o?this.setTemporaryCache(g._p.CCS_CREDENTIAL,JSON.stringify({credential:o.homeAccountId,type:"home_account_id"}),!0):r&&this.setTemporaryCache(g._p.CCS_CREDENTIAL,JSON.stringify({credential:r,type:"UPN"}),!0)}resetRequestCache(e){this.logger.trace("BrowserCacheManager.resetRequestCache called"),e&&(this.temporaryCacheStorage.getKeys().forEach(t=>{-1!==t.indexOf(e)&&this.removeTemporaryItem(t)}),this.removeTemporaryItem(this.generateStateKey(e)),this.removeTemporaryItem(this.generateNonceKey(e)),this.removeTemporaryItem(this.generateAuthorityKey(e))),this.removeTemporaryItem(this.generateCacheKey(g._p.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(g._p.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(g._p.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(g._p.CORRELATION_ID)),this.removeTemporaryItem(this.generateCacheKey(g._p.CCS_CREDENTIAL)),this.removeTemporaryItem(this.generateCacheKey(g._p.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cleanRequestByState(e){if(this.logger.trace("BrowserCacheManager.cleanRequestByState called"),e){const t=this.generateStateKey(e),n=this.temporaryCacheStorage.getItem(t);this.logger.infoPii(`BrowserCacheManager.cleanRequestByState: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n||l.YM.EMPTY_STRING)}}cleanRequestByInteractionType(e){this.logger.trace("BrowserCacheManager.cleanRequestByInteractionType called"),this.temporaryCacheStorage.getKeys().forEach(t=>{if(-1===t.indexOf(g._p.REQUEST_STATE))return;const n=this.temporaryCacheStorage.getItem(t);if(!n)return;const r=Nn(this.cryptoImpl,n);r&&r.interactionType===e&&(this.logger.infoPii(`BrowserCacheManager.cleanRequestByInteractionType: Removing temporary cache items for state: ${n}`),this.resetRequestCache(n))}),this.setInteractionInProgress(!1)}cacheCodeRequest(e){this.logger.trace("BrowserCacheManager.cacheCodeRequest called");const t=(0,De.KA)(JSON.stringify(e));this.setTemporaryCache(g._p.REQUEST_PARAMS,t,!0)}getCachedRequest(e){this.logger.trace("BrowserCacheManager.getCachedRequest called");const t=this.getTemporaryCache(g._p.REQUEST_PARAMS,!0);if(!t)throw(0,O.bD)(b.y6);let n;try{n=JSON.parse(ke(t))}catch(r){throw this.logger.errorPii(`Attempted to parse: ${t}`),this.logger.error(`Parsing cached token request threw with error: ${r}`),(0,O.bD)(b.ot)}if(this.removeTemporaryItem(this.generateCacheKey(g._p.REQUEST_PARAMS)),!n.authority){const r=this.generateAuthorityKey(e),o=this.getTemporaryCache(r);if(!o)throw(0,O.bD)(b.Ne);n.authority=o}return n}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");const e=this.getTemporaryCache(g._p.NATIVE_REQUEST,!0);return e?this.validateAndParseJson(e)||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null):(this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress();return e?t===this.clientId:!!t}getInteractionInProgress(){return this.getTemporaryCache(`${l.YM.CACHE_PREFIX}.${g._p.INTERACTION_STATUS_KEY}`,!1)}setInteractionInProgress(e){const t=`${l.YM.CACHE_PREFIX}.${g._p.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw(0,O.bD)(b.b);this.setTemporaryCache(t,this.clientId,!1)}else!e&&this.getInteractionInProgress()===this.clientId&&this.removeTemporaryItem(t)}getLegacyLoginHint(){const e=this.getTemporaryCache(l.Gd.ADAL_ID_TOKEN);e&&(this.browserStorage.removeItem(l.Gd.ADAL_ID_TOKEN),this.logger.verbose("Cached ADAL id token retrieved."));const t=this.getTemporaryCache(l.Gd.ID_TOKEN,!0);t&&(this.browserStorage.removeItem(this.generateCacheKey(l.Gd.ID_TOKEN)),this.logger.verbose("Cached MSAL.js v1 id token retrieved"));const n=t||e;if(n){const r=_e(n,ke);if(r.preferred_username)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 preferred_username as loginHint"),r.preferred_username;if(r.upn)return this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, setting ADAL/MSAL v1 upn as loginHint"),r.upn;this.logger.verbose("No SSO params used and ADAL/MSAL v1 token retrieved, however, no account hint claim found. Enable preferred_username or upn id token claim to get SSO.")}return null}updateCredentialCacheKey(e,t,n){const r=Ye(t);if(e!==r){const o=this.getItem(e);if(o)return this.browserStorage.removeItem(e),this.setItem(r,o,n),this.logger.verbose(`Updated an outdated ${t.credentialType} cache key`),r;this.logger.error(`Attempted to update an outdated ${t.credentialType} cache key but no item matching the outdated key was found in storage`)}return e}hydrateCache(e,t){var n=this;return(0,C.A)(function*(){const r=ct(e.account?.homeAccountId,e.account?.environment,e.idToken,n.clientId,e.tenantId);let o;t.claims&&(o=yield n.cryptoImpl.hashString(t.claims));const a=lt(e.account?.homeAccountId,e.account.environment,e.accessToken,n.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?e.expiresOn.getTime()/1e3:0,e.extExpiresOn?e.extExpiresOn.getTime()/1e3:0,ke,void 0,e.tokenType,void 0,t.sshKid,t.claims,o);return n.saveCacheRecord({idToken:r,accessToken:a},e.correlationId)})()}saveCacheRecord(e,t,n){var r=()=>super.saveCacheRecord,o=this;return(0,C.A)(function*(){try{yield r().call(o,e,t,n)}catch(a){if(a instanceof $e&&o.performanceClient&&t)try{const c=o.getTokenKeys();o.performanceClient.addFields({cacheRtCount:c.refreshToken.length,cacheIdCount:c.idToken.length,cacheAtCount:c.accessToken.length},t)}catch{}throw a}})()}}var U=A(3212);class ro{constructor(e){this.eventCallbacks=new Map,this.logger=e||new Z.V({})}addEventCallback(e,t,n){if(typeof window<"u"){const r=n||(0,ee.gj)();return this.eventCallbacks.has(r)?(this.logger.error(`Event callback with id: ${r} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(r,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${r}`),r)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,n,r){if(typeof window<"u"){const o={eventType:e,interactionType:t||null,payload:n||null,error:r||null,timestamp:Date.now()};this.eventCallbacks.forEach(([a,c],d)=>{(0===c.length||c.includes(e))&&(this.logger.verbose(`Emitting event to callback ${d}: ${e}`),a.apply(null,[o]))})}}}class He extends oe.lR{constructor(e,t,n,r,o){super(e,t,n),this.name="ServerError",this.errorNo=r,this.status=o,Object.setPrototypeOf(this,He.prototype)}}class we{static generateThrottlingStorageKey(e){return`${l.Xw.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t,n){const r=we.generateThrottlingStorageKey(t),o=e.getThrottlingCache(r);if(o){if(o.throttleTime<Date.now())return void e.removeItem(r,n);throw new He(o.errorCodes?.join(" ")||l.YM.EMPTY_STRING,o.errorMessage,o.subError)}}static postProcess(e,t,n,r){if(we.checkResponseStatus(n)||we.checkResponseForRetryAfter(n)){const o={throttleTime:we.calculateThrottleTime(parseInt(n.headers[l.OK.RETRY_AFTER])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(we.generateThrottlingStorageKey(t),o,r)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(l.OK.RETRY_AFTER)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(1e3*Math.min(n+(t||l.Xw.DEFAULT_THROTTLE_TIME_SECONDS),n+l.Xw.DEFAULT_MAX_THROTTLE_TIME_SECONDS))}static removeThrottle(e,t,n,r){const a=this.generateThrottlingStorageKey({clientId:t,authority:n.authority,scopes:n.scopes,homeAccountIdentifier:r,claims:n.claims,authenticationScheme:n.authenticationScheme,resourceRequestMethod:n.resourceRequestMethod,resourceRequestUri:n.resourceRequestUri,shrClaims:n.shrClaims,sshKid:n.sshKid});e.removeItem(a,n.correlationId)}}const Ke="client_id",Dn="redirect_uri",Un="response_type",Ln="token_type",Hn="req_cnf",Bn="return_spa_code",xt="brk_client_id",Kt="brk_redirect_uri";class Ve{static validateRedirectUri(e){if(!e)throw(0,te.aD)(ne.gO)}static validatePrompt(e){const t=[];for(const n in l._M)t.push(l._M[n]);if(t.indexOf(e)<0)throw(0,te.aD)(ne.Pc)}static validateClaims(e){try{JSON.parse(e)}catch{throw(0,te.aD)(ne.bj)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw(0,te.aD)(ne.qz);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([l.iF.PLAIN,l.iF.S256].indexOf(e)<0)throw(0,te.aD)(ne.b0)}}class rt{constructor(e,t){this.parameters=new Map,this.performanceClient=t,this.correlationId=e}addResponseTypeCode(){this.parameters.set(Un,encodeURIComponent(l.YM.CODE_RESPONSE_TYPE))}addResponseTypeForTokenAndIdToken(){this.parameters.set(Un,encodeURIComponent(`${l.YM.TOKEN_RESPONSE_TYPE} ${l.YM.ID_TOKEN_RESPONSE_TYPE}`))}addResponseMode(e){this.parameters.set("response_mode",encodeURIComponent(e||l.p.QUERY))}addNativeBroker(){this.parameters.set("nativebroker",encodeURIComponent("1"))}addScopes(e,t=!0,n=l.aZ){t&&!n.includes("openid")&&!e.includes("openid")&&n.push("openid");const r=t?[...e||[],...n]:e||[],o=new re(r);this.parameters.set("scope",encodeURIComponent(o.printScopes()))}addClientId(e){this.parameters.set(Ke,encodeURIComponent(e))}addRedirectUri(e){Ve.validateRedirectUri(e),this.parameters.set(Dn,encodeURIComponent(e))}addPostLogoutRedirectUri(e){Ve.validateRedirectUri(e),this.parameters.set("post_logout_redirect_uri",encodeURIComponent(e))}addIdTokenHint(e){this.parameters.set("id_token_hint",encodeURIComponent(e))}addDomainHint(e){this.parameters.set("domain_hint",encodeURIComponent(e))}addLoginHint(e){this.parameters.set("login_hint",encodeURIComponent(e))}addCcsUpn(e){this.parameters.set(l.OK.CCS_HEADER,encodeURIComponent(`UPN:${e}`))}addCcsOid(e){this.parameters.set(l.OK.CCS_HEADER,encodeURIComponent(`Oid:${e.uid}@${e.utid}`))}addSid(e){this.parameters.set("sid",encodeURIComponent(e))}addClaims(e,t){const n=this.addClientCapabilitiesToClaims(e,t);Ve.validateClaims(n),this.parameters.set("claims",encodeURIComponent(n))}addCorrelationId(e){this.parameters.set("client-request-id",encodeURIComponent(e))}addLibraryInfo(e){this.parameters.set("x-client-SKU",e.sku),this.parameters.set("x-client-VER",e.version),e.os&&this.parameters.set("x-client-OS",e.os),e.cpu&&this.parameters.set("x-client-CPU",e.cpu)}addApplicationTelemetry(e){e?.appName&&this.parameters.set("x-app-name",e.appName),e?.appVersion&&this.parameters.set("x-app-ver",e.appVersion)}addPrompt(e){Ve.validatePrompt(e),this.parameters.set("prompt",encodeURIComponent(e))}addState(e){e&&this.parameters.set("state",encodeURIComponent(e))}addNonce(e){this.parameters.set("nonce",encodeURIComponent(e))}addCodeChallengeParams(e,t){if(Ve.validateCodeChallengeParams(e,t),!e||!t)throw(0,te.aD)(ne.qz);this.parameters.set("code_challenge",encodeURIComponent(e)),this.parameters.set("code_challenge_method",encodeURIComponent(t))}addAuthorizationCode(e){this.parameters.set("code",encodeURIComponent(e))}addDeviceCode(e){this.parameters.set("device_code",encodeURIComponent(e))}addRefreshToken(e){this.parameters.set("refresh_token",encodeURIComponent(e))}addCodeVerifier(e){this.parameters.set("code_verifier",encodeURIComponent(e))}addClientSecret(e){this.parameters.set("client_secret",encodeURIComponent(e))}addClientAssertion(e){e&&this.parameters.set("client_assertion",encodeURIComponent(e))}addClientAssertionType(e){e&&this.parameters.set("client_assertion_type",encodeURIComponent(e))}addOboAssertion(e){this.parameters.set("assertion",encodeURIComponent(e))}addRequestTokenUse(e){this.parameters.set("requested_token_use",encodeURIComponent(e))}addGrantType(e){this.parameters.set("grant_type",encodeURIComponent(e))}addClientInfo(){this.parameters.set(l.JR,"1")}addExtraQueryParameters(e){Object.entries(e).forEach(([t,n])=>{!this.parameters.has(t)&&n&&this.parameters.set(t,n)})}addClientCapabilitiesToClaims(e,t){let n;if(e)try{n=JSON.parse(e)}catch{throw(0,te.aD)(ne.bj)}else n={};return t&&t.length>0&&(n.hasOwnProperty(l.Fq.ACCESS_TOKEN)||(n[l.Fq.ACCESS_TOKEN]={}),n[l.Fq.ACCESS_TOKEN][l.Fq.XMS_CC]={values:t}),JSON.stringify(n)}addUsername(e){this.parameters.set(l.Tq.username,encodeURIComponent(e))}addPassword(e){this.parameters.set(l.Tq.password,encodeURIComponent(e))}addPopToken(e){e&&(this.parameters.set(Ln,l.IO.POP),this.parameters.set(Hn,encodeURIComponent(e)))}addSshJwk(e){e&&(this.parameters.set(Ln,l.IO.SSH),this.parameters.set(Hn,encodeURIComponent(e)))}addServerTelemetry(e){this.parameters.set("x-client-current-telemetry",e.generateCurrentRequestHeaderValue()),this.parameters.set("x-client-last-telemetry",e.generateLastRequestHeaderValue())}addThrottling(){this.parameters.set("x-ms-lib-capability",l.Xw.X_MS_LIB_CAPABILITY_VALUE)}addLogoutHint(e){this.parameters.set("logout_hint",encodeURIComponent(e))}addBrokerParameters(e){const t={};t[xt]=e.brokerClientId,t[Kt]=e.brokerRedirectUri,this.addExtraQueryParameters(t)}createQueryString(){const e=new Array;return this.parameters.forEach((t,n)=>{e.push(`${n}=${t}`)}),function Fo(s,e,t){if(!e)return;const n=s.get(Ke);n&&s.has(xt)&&t?.addFields({embeddedClientId:n,embeddedRedirectUri:s.get(Dn)},e)}(this.parameters,this.correlationId,this.performanceClient),e.join("&")}}function xn(s,e,t,n,r,o,a){return Ft.apply(this,arguments)}function Ft(){return(Ft=(0,C.A)(function*(s,e,t,n,r,o,a){a?.addQueueMeasurement(f.MX.AuthorityFactoryCreateDiscoveredInstance,o);const c=ge.transformCIAMAuthority(wn(s)),d=new ge(c,e,t,n,r,o,a);try{return yield k(d.resolveEndpointsAsync.bind(d),f.MX.AuthorityResolveEndpointsAsync,r,a,o)(),d}catch{throw(0,v.SB)(E.s1)}})).apply(this,arguments)}class Gt{constructor(e,t){this.config=function Ar({authOptions:s,systemOptions:e,loggerOptions:t,cacheOptions:n,storageInterface:r,networkInterface:o,cryptoInterface:a,clientCredentials:c,libraryInfo:d,telemetry:u,serverTelemetryManager:p,persistencePlugin:S,serializableCache:w}){const D={...ur,...t};return{authOptions:Tr(s),systemOptions:{...An,...e},loggerOptions:D,cacheOptions:{...hr,...n},storageInterface:r||new dr(s.clientId,Ue,new Z.V(D)),networkInterface:o||gr,cryptoInterface:a||Ue,clientCredentials:c||mr,libraryInfo:{...pr,...d},telemetry:{...Cr,...u},serverTelemetryManager:p||null,persistencePlugin:S||null,serializableCache:w||null}}(e),this.logger=new Z.V(this.config.loggerOptions,Ge,Be),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){const t={};if(t[l.OK.CONTENT_TYPE]=l.YM.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case"home_account_id":try{const n=ze(e.credential);t[l.OK.CCS_HEADER]=`Oid:${n.uid}@${n.utid}`}catch(n){this.logger.verbose("Could not parse home account ID for CCS Header: "+n)}break;case"UPN":t[l.OK.CCS_HEADER]=`UPN: ${e.credential}`}return t}executePostToTokenEndpoint(e,t,n,r,o,a){var c=this;return(0,C.A)(function*(){a&&c.performanceClient?.addQueueMeasurement(a,o);const d=yield c.sendPostRequest(r,e,{body:t,headers:n},o);return c.config.serverTelemetryManager&&d.status<500&&429!==d.status&&c.config.serverTelemetryManager.clearTelemetryCache(),d})()}sendPostRequest(e,t,n,r){var o=this;return(0,C.A)(function*(){let a;we.preProcess(o.cacheManager,e,r);try{a=yield k(o.networkClient.sendPostRequestAsync.bind(o.networkClient),f.MX.NetworkClientSendPostRequestAsync,o.logger,o.performanceClient,r)(t,n);const c=a.headers||{};o.performanceClient?.addFields({refreshTokenSize:a.body.refresh_token?.length||0,httpVerToken:c[l.OK.X_MS_HTTP_VERSION]||"",requestId:c[l.OK.X_MS_REQUEST_ID]||""},r)}catch(c){if(c instanceof pt){const d=c.responseHeaders;throw d&&o.performanceClient?.addFields({httpVerToken:d[l.OK.X_MS_HTTP_VERSION]||"",requestId:d[l.OK.X_MS_REQUEST_ID]||"",contentTypeHeader:d[l.OK.CONTENT_TYPE]||void 0,contentLengthHeader:d[l.OK.CONTENT_LENGTH]||void 0,httpStatus:c.httpStatus},r),c.error}throw c instanceof oe.lR?c:(0,v.SB)(E.x6)}return we.postProcess(o.cacheManager,e,a,r),a})()}updateAuthority(e,t){var n=this;return(0,C.A)(function*(){n.performanceClient?.addQueueMeasurement(f.MX.UpdateTokenEndpointAuthority,t);const r=`https://${e}/${n.authority.tenant}/`,o=yield xn(r,n.networkClient,n.cacheManager,n.authority.options,n.logger,t,n.performanceClient);n.authority=o})()}createTokenQueryParameters(e){const t=new rt(e.correlationId,this.performanceClient);return e.embeddedClientId&&t.addBrokerParameters({brokerClientId:this.config.authOptions.clientId,brokerRedirectUri:this.config.authOptions.redirectUri}),e.tokenQueryParameters&&t.addExtraQueryParameters(e.tokenQueryParameters),t.addCorrelationId(e.correlationId),t.createQueryString()}}class Qe{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}generateCnf(e,t){var n=this;return(0,C.A)(function*(){n.performanceClient?.addQueueMeasurement(f.MX.PopTokenGenerateCnf,e.correlationId);const r=yield k(n.generateKid.bind(n),f.MX.PopTokenGenerateCnf,t,n.performanceClient,e.correlationId)(e),o=n.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:o}})()}generateKid(e){var t=this;return(0,C.A)(function*(){return t.performanceClient?.addQueueMeasurement(f.MX.PopTokenGenerateKid,e.correlationId),{kid:yield t.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}})()}signPopToken(e,t,n){var r=this;return(0,C.A)(function*(){return r.signPayload(e,t,n)})()}signPayload(e,t,n,r){var o=this;return(0,C.A)(function*(){const{resourceRequestMethod:a,resourceRequestUri:c,shrClaims:d,shrNonce:u,shrOptions:p}=n,w=(c?new V.H(c):void 0)?.getUrlComponents();return o.cryptoUtils.signJwt({at:e,ts:Ce(),m:a?.toUpperCase(),u:w?.HostNameAndPort,nonce:u||o.cryptoUtils.createNewGuid(),p:w?.AbsolutePath,q:w?.QueryString?[[],w.QueryString]:void 0,client_claims:d||void 0,...r},t,p,n.correlationId)})()}}class Yo{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}class Fe{constructor(e,t,n,r,o,a,c){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=r,this.serializableCache=o,this.persistencePlugin=a,this.performanceClient=c}validateServerAuthorizationCodeResponse(e,t){if(!e.state||!t)throw(0,v.SB)(E.tQ,e.state?"Cached State":"Server State");let n,r;try{n=decodeURIComponent(e.state)}catch{throw(0,v.SB)(E.f$,e.state)}try{r=decodeURIComponent(t)}catch{throw(0,v.SB)(E.f$,e.state)}if(n!==r)throw(0,v.SB)(E.Cl);if(e.error||e.error_description||e.suberror){const o=function zo(s){const t=s.error_uri?.lastIndexOf("code=");return t&&t>=0?s.error_uri?.substring(t+5):void 0}(e);throw bn(e.error,e.error_description,e.suberror)?new Ie(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",o):new He(e.error||"",e.error_description,e.suberror,o)}}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){const n=`Error(s): ${e.error_codes||l.YM.NOT_AVAILABLE} - Timestamp: ${e.timestamp||l.YM.NOT_AVAILABLE} - Description: ${e.error_description||l.YM.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||l.YM.NOT_AVAILABLE} - Trace ID: ${e.trace_id||l.YM.NOT_AVAILABLE}`,r=e.error_codes?.length?e.error_codes[0]:void 0,o=new He(e.error,n,e.suberror,r,e.status);if(t&&e.status&&e.status>=l.t3.SERVER_ERROR_RANGE_START&&e.status<=l.t3.SERVER_ERROR_RANGE_END)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.\n${o}`);if(t&&e.status&&e.status>=l.t3.CLIENT_ERROR_RANGE_START&&e.status<=l.t3.CLIENT_ERROR_RANGE_END)return void this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.\n${o}`);throw bn(e.error,e.error_description,e.suberror)?new Ie(e.error,e.error_description,e.suberror,e.timestamp||l.YM.EMPTY_STRING,e.trace_id||l.YM.EMPTY_STRING,e.correlation_id||l.YM.EMPTY_STRING,e.claims||l.YM.EMPTY_STRING,r):o}}handleServerTokenResponse(e,t,n,r,o,a,c,d,u){var p=this;return(0,C.A)(function*(){let S,w;if(p.performanceClient?.addQueueMeasurement(f.MX.HandleServerTokenResponse,e.correlation_id),e.id_token){if(S=_e(e.id_token||l.YM.EMPTY_STRING,p.cryptoObj.base64Decode),o&&o.nonce&&S.nonce!==o.nonce)throw(0,v.SB)(E.aQ);if(r.maxAge||0===r.maxAge){const F=S.auth_time;if(!F)throw(0,v.SB)(E.n3);st(F,r.maxAge)}}p.homeAccountIdentifier=ce.generateHomeAccountId(e.client_info||l.YM.EMPTY_STRING,t.authorityType,p.logger,p.cryptoObj,S),o&&o.state&&(w=Ee.parseRequestState(p.cryptoObj,o.state)),e.key_id=e.key_id||r.sshKid||void 0;const D=p.generateCacheRecord(e,t,n,r,S,a,o);let Y;try{if(p.persistencePlugin&&p.serializableCache&&(p.logger.verbose("Persistence enabled, calling beforeCacheAccess"),Y=new Yo(p.serializableCache,!0),yield p.persistencePlugin.beforeCacheAccess(Y)),c&&!d&&D.account){const F=D.account.generateAccountKey();if(!p.cacheStorage.getAccount(F,r.correlationId,p.logger))return p.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),yield Fe.generateAuthenticationResult(p.cryptoObj,t,D,!1,r,S,w,void 0,u)}yield p.cacheStorage.saveCacheRecord(D,r.correlationId,r.storeInCache)}finally{p.persistencePlugin&&p.serializableCache&&Y&&(p.logger.verbose("Persistence enabled, calling afterCacheAccess"),yield p.persistencePlugin.afterCacheAccess(Y))}return Fe.generateAuthenticationResult(p.cryptoObj,t,D,!1,r,S,w,e,u)})()}generateCacheRecord(e,t,n,r,o,a,c){const d=t.getPreferredCache();if(!d)throw(0,v.SB)(E.l3);const u=hn(o);let p,S;e.id_token&&o&&(p=ct(this.homeAccountIdentifier,d,e.id_token,this.clientId,u||""),S=Yt(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,r.correlationId,o,e.client_info,d,u,c,void 0,this.logger));let w=null;if(e.access_token){const F=e.scope?re.fromString(e.scope):new re(r.scopes||[]),ue=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,ve=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,fe=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,tt=n+ue,at=tt+ve,_t=fe&&fe>0?n+fe:void 0;w=lt(this.homeAccountIdentifier,d,e.access_token,this.clientId,u||t.tenant||"",F.printScopes(),tt,at,this.cryptoObj.base64Decode,_t,e.token_type,a,e.key_id,r.claims,r.requestedClaimsHash)}let D=null;if(e.refresh_token){let F;e.refresh_token_expires_in&&(F=n+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in)),D=an(this.homeAccountIdentifier,d,e.refresh_token,this.clientId,e.foci,a,F)}let Y=null;return e.foci&&(Y={clientId:this.clientId,environment:d,familyId:e.foci}),{account:S,idToken:p,accessToken:w,refreshToken:D,appMetadata:Y}}static generateAuthenticationResult(e,t,n,r,o,a,c,d,u){return(0,C.A)(function*(){let D,Y,p=l.YM.EMPTY_STRING,S=[],w=null,F=l.YM.EMPTY_STRING;if(n.accessToken){if(n.accessToken.tokenType!==l.IO.POP||o.popKid)p=n.accessToken.secret;else{const tt=new Qe(e),{secret:at,keyId:_t}=n.accessToken;if(!_t)throw(0,v.SB)(E.fo);p=yield tt.signPopToken(at,_t,o)}S=re.fromString(n.accessToken.target).asArray(),w=new Date(1e3*Number(n.accessToken.expiresOn)),D=new Date(1e3*Number(n.accessToken.extendedExpiresOn)),n.accessToken.refreshOn&&(Y=new Date(1e3*Number(n.accessToken.refreshOn)))}n.appMetadata&&(F=n.appMetadata.familyId===l.hB?l.hB:"");const ue=a?.oid||a?.sub||"",ve=a?.tid||"";d?.spa_accountid&&n.account&&(n.account.nativeAccountId=d?.spa_accountid);const fe=n.account?St(n.account.getAccountInfo(),void 0,a,n.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:ue,tenantId:ve,scopes:S,account:fe,idToken:n?.idToken?.secret||"",idTokenClaims:a||{},accessToken:p,fromCache:r,expiresOn:w,extExpiresOn:D,refreshOn:Y,correlationId:o.correlationId,requestId:u||l.YM.EMPTY_STRING,familyId:F,tokenType:n.accessToken?.tokenType||l.YM.EMPTY_STRING,state:c?c.userRequestState:l.YM.EMPTY_STRING,cloudGraphHostName:n.account?.cloudGraphHostName||l.YM.EMPTY_STRING,msGraphHost:n.account?.msGraphHost||l.YM.EMPTY_STRING,code:d?.spa_code,fromNativeBroker:!1}})()}}function Yt(s,e,t,n,r,o,a,c,d,u,p,S){S?.verbose("setCachedAccount called");const D=s.getAccountKeys().find(fe=>fe.startsWith(t));let Y=null;D&&(Y=s.getAccount(D,r,S));const F=Y||ce.createAccount({homeAccountId:t,idTokenClaims:o,clientInfo:a,environment:c,cloudGraphHostName:u?.cloud_graph_host_name,msGraphHost:u?.msgraph_host,nativeAccountId:p},e,n),ue=F.tenantProfiles||[],ve=d||F.realm;if(ve&&!ue.find(fe=>fe.tenantId===ve)){const fe=vt(t,F.localAccountId,ve,o);ue.push(fe)}return F.tenantProfiles=ue,F}function Kn(s,e,t){return zt.apply(this,arguments)}function zt(){return(zt=(0,C.A)(function*(s,e,t){return"string"==typeof s?s:s({clientId:e,tokenEndpoint:t})})).apply(this,arguments)}class Fn extends Gt{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}getAuthCodeUrl(e){var t=this;return(0,C.A)(function*(){t.performanceClient?.addQueueMeasurement(f.MX.GetAuthCodeUrl,e.correlationId);const n=yield k(t.createAuthCodeUrlQueryString.bind(t),f.MX.AuthClientCreateQueryString,t.logger,t.performanceClient,e.correlationId)(e);return V.H.appendQueryString(t.authority.authorizationEndpoint,n)})()}acquireToken(e,t){var n=this;return(0,C.A)(function*(){if(n.performanceClient?.addQueueMeasurement(f.MX.AuthClientAcquireToken,e.correlationId),!e.code)throw(0,v.SB)(E.$P);const r=Ce(),o=yield k(n.executeTokenRequest.bind(n),f.MX.AuthClientExecuteTokenRequest,n.logger,n.performanceClient,e.correlationId)(n.authority,e),a=o.headers?.[l.OK.X_MS_REQUEST_ID],c=new Fe(n.config.authOptions.clientId,n.cacheManager,n.cryptoUtils,n.logger,n.config.serializableCache,n.config.persistencePlugin,n.performanceClient);return c.validateTokenResponse(o.body),k(c.handleServerTokenResponse.bind(c),f.MX.HandleServerTokenResponse,n.logger,n.performanceClient,e.correlationId)(o.body,n.authority,r,e,t,void 0,void 0,void 0,a)})()}handleFragmentResponse(e,t){if(new Fe(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,null,null).validateServerAuthorizationCodeResponse(e,t),!e.code)throw(0,v.SB)(E.Re);return e}getLogoutUri(e){if(!e)throw(0,te.aD)(ne.pi);const t=this.createLogoutUrlQueryString(e);return V.H.appendQueryString(this.authority.endSessionEndpoint,t)}executeTokenRequest(e,t){var n=this;return(0,C.A)(function*(){n.performanceClient?.addQueueMeasurement(f.MX.AuthClientExecuteTokenRequest,t.correlationId);const r=n.createTokenQueryParameters(t),o=V.H.appendQueryString(e.tokenEndpoint,r),a=yield k(n.createTokenRequestBody.bind(n),f.MX.AuthClientCreateTokenRequestBody,n.logger,n.performanceClient,t.correlationId)(t);let c;if(t.clientInfo)try{const p=ut(t.clientInfo,n.cryptoUtils.base64Decode);c={credential:`${p.uid}${l.LR.CLIENT_INFO_SEPARATOR}${p.utid}`,type:"home_account_id"}}catch(p){n.logger.verbose("Could not parse client info for CCS Header: "+p)}const d=n.createTokenRequestHeaders(c||t.ccsCredential),u={clientId:t.tokenBodyParameters?.clientId||n.config.authOptions.clientId,authority:e.canonicalAuthority,scopes:t.scopes,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid};return k(n.executePostToTokenEndpoint.bind(n),f.MX.AuthorizationCodeClientExecutePostToTokenEndpoint,n.logger,n.performanceClient,t.correlationId)(o,a,d,u,t.correlationId,f.MX.AuthorizationCodeClientExecutePostToTokenEndpoint)})()}createTokenRequestBody(e){var t=this;return(0,C.A)(function*(){t.performanceClient?.addQueueMeasurement(f.MX.AuthClientCreateTokenRequestBody,e.correlationId);const n=new rt(e.correlationId,t.performanceClient);if(n.addClientId(e.embeddedClientId||e.tokenBodyParameters?.[Ke]||t.config.authOptions.clientId),t.includeRedirectUri?n.addRedirectUri(e.redirectUri):Ve.validateRedirectUri(e.redirectUri),n.addScopes(e.scopes,!0,t.oidcDefaultScopes),n.addAuthorizationCode(e.code),n.addLibraryInfo(t.config.libraryInfo),n.addApplicationTelemetry(t.config.telemetry.application),n.addThrottling(),t.serverTelemetryManager&&!bt(t.config)&&n.addServerTelemetry(t.serverTelemetryManager),e.codeVerifier&&n.addCodeVerifier(e.codeVerifier),t.config.clientCredentials.clientSecret&&n.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){const o=t.config.clientCredentials.clientAssertion;n.addClientAssertion(yield Kn(o.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),n.addClientAssertionType(o.assertionType)}if(n.addGrantType(l.$x.AUTHORIZATION_CODE_GRANT),n.addClientInfo(),e.authenticationScheme===l.IO.POP){const o=new Qe(t.cryptoUtils,t.performanceClient);let a;a=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield k(o.generateCnf.bind(o),f.MX.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,n.addPopToken(a)}else if(e.authenticationScheme===l.IO.SSH){if(!e.sshJwk)throw(0,te.aD)(ne.LX);n.addSshJwk(e.sshJwk)}let r;if((!Le.$.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&n.addClaims(e.claims,t.config.authOptions.clientCapabilities),e.clientInfo)try{const o=ut(e.clientInfo,t.cryptoUtils.base64Decode);r={credential:`${o.uid}${l.LR.CLIENT_INFO_SEPARATOR}${o.utid}`,type:"home_account_id"}}catch(o){t.logger.verbose("Could not parse client info for CCS Header: "+o)}else r=e.ccsCredential;if(t.config.systemOptions.preventCorsPreflight&&r)switch(r.type){case"home_account_id":try{const o=ze(r.credential);n.addCcsOid(o)}catch(o){t.logger.verbose("Could not parse home account ID for CCS Header: "+o)}break;case"UPN":n.addCcsUpn(r.credential)}return e.embeddedClientId&&n.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),e.tokenBodyParameters&&n.addExtraQueryParameters(e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[Bn])&&n.addExtraQueryParameters({[Bn]:"1"}),n.createQueryString()})()}createAuthCodeUrlQueryString(e){var t=this;return(0,C.A)(function*(){const n=e.correlationId||t.config.cryptoInterface.createNewGuid();t.performanceClient?.addQueueMeasurement(f.MX.AuthClientCreateQueryString,n);const r=new rt(n,t.performanceClient);r.addClientId(e.embeddedClientId||e.extraQueryParameters?.[Ke]||t.config.authOptions.clientId);const o=[...e.scopes||[],...e.extraScopesToConsent||[]];if(r.addScopes(o,!0,t.oidcDefaultScopes),r.addRedirectUri(e.redirectUri),r.addCorrelationId(n),r.addResponseMode(e.responseMode),r.addResponseTypeCode(),r.addLibraryInfo(t.config.libraryInfo),bt(t.config)||r.addApplicationTelemetry(t.config.telemetry.application),r.addClientInfo(),e.codeChallenge&&e.codeChallengeMethod&&r.addCodeChallengeParams(e.codeChallenge,e.codeChallengeMethod),e.prompt&&r.addPrompt(e.prompt),e.domainHint&&r.addDomainHint(e.domainHint),e.prompt!==l._M.SELECT_ACCOUNT)if(e.sid&&e.prompt===l._M.NONE)t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),r.addSid(e.sid);else if(e.account){const a=t.extractAccountSid(e.account);let c=t.extractLoginHint(e.account);if(c&&e.domainHint&&(t.logger.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),c=null),c){t.logger.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),r.addLoginHint(c);try{const d=ze(e.account.homeAccountId);r.addCcsOid(d)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(a&&e.prompt===l._M.NONE){t.logger.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),r.addSid(a);try{const d=ze(e.account.homeAccountId);r.addCcsOid(d)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),r.addLoginHint(e.loginHint),r.addCcsUpn(e.loginHint);else if(e.account.username){t.logger.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),r.addLoginHint(e.account.username);try{const d=ze(e.account.homeAccountId);r.addCcsOid(d)}catch{t.logger.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.logger.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),r.addLoginHint(e.loginHint),r.addCcsUpn(e.loginHint));else t.logger.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");if(e.nonce&&r.addNonce(e.nonce),e.state&&r.addState(e.state),(e.claims||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&r.addClaims(e.claims,t.config.authOptions.clientCapabilities),e.embeddedClientId&&r.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),t.addExtraQueryParams(e,r),e.nativeBroker&&(r.addNativeBroker(),e.authenticationScheme===l.IO.POP)){const a=new Qe(t.cryptoUtils);let c;c=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield k(a.generateCnf.bind(a),f.MX.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,r.addPopToken(c)}return r.createQueryString()})()}createLogoutUrlQueryString(e){const t=new rt(e.correlationId,this.performanceClient);return e.postLogoutRedirectUri&&t.addPostLogoutRedirectUri(e.postLogoutRedirectUri),e.correlationId&&t.addCorrelationId(e.correlationId),e.idTokenHint&&t.addIdTokenHint(e.idTokenHint),e.state&&t.addState(e.state),e.logoutHint&&t.addLogoutHint(e.logoutHint),this.addExtraQueryParams(e,t),t.createQueryString()}addExtraQueryParams(e,t){!(e.extraQueryParameters&&e.extraQueryParameters.hasOwnProperty("instance_aware"))&&this.config.authOptions.instanceAware&&(e.extraQueryParameters=e.extraQueryParameters||{},e.extraQueryParameters.instance_aware="true"),e.extraQueryParameters&&t.addExtraQueryParameters(e.extraQueryParameters)}extractAccountSid(e){return e.idTokenClaims?.sid||null}extractLoginHint(e){return e.idTokenClaims?.login_hint||null}}class ot{constructor(e,t){this.cacheOutcome=l.Rv.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||l.YM.EMPTY_STRING,this.wrapperVer=e.wrapperVer||l.YM.EMPTY_STRING,this.telemetryCacheKey=l.gT.CACHE_KEY+l.LR.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${l.gT.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();n?.length&&t.push(`broker_error=${n}`);const r=t.join(l.gT.VALUE_SEPARATOR),a=[e,this.getRegionDiscoveryFields()].join(l.gT.VALUE_SEPARATOR);return[l.gT.SCHEMA_VERSION,a,r].join(l.gT.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=ot.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(l.gT.VALUE_SEPARATOR),r=e.errors.slice(0,t).join(l.gT.VALUE_SEPARATOR),o=e.errors.length,c=[o,t<o?l.gT.OVERFLOW_TRUE:l.gT.OVERFLOW_FALSE].join(l.gT.VALUE_SEPARATOR);return[l.gT.SCHEMA_VERSION,e.cacheHits,n,r,c].join(l.gT.CATEGORY_SEPARATOR)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=l.gT.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?t.errors.push(e instanceof oe.lR?e.subError?e.subError:e.errorCode?e.errorCode:e.toString():e.toString()):t.errors.push(l.gT.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){const e=this.getLastRequests(),t=ot.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const r={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r,this.correlationId)}}static maxErrorsToSend(e){let t,n=0,r=0;const o=e.errors.length;for(t=0;t<o;t++){const c=e.failedRequests[2*t+1]||l.YM.EMPTY_STRING,d=e.errors[t]||l.YM.EMPTY_STRING;if(r+=(e.failedRequests[2*t]||l.YM.EMPTY_STRING).toString().length+c.toString().length+d.length+3,!(r<l.gT.MAX_LAST_HEADER_BYTES))break;n+=1}return n}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||l.YM.EMPTY_STRING),e.push(this.regionSource||l.YM.EMPTY_STRING),e.push(this.regionOutcome||l.YM.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return function $o(s){const{skus:e,libraryName:t,libraryVersion:n,extensionName:r,extensionVersion:o}=s,a=new Map([[0,[t,n]],[2,[r,o]]]);let c=[];if(e?.length){if(c=e.split(","),c.length<4)return e}else c=Array.from({length:4},()=>"|");return a.forEach((d,u)=>{2===d.length&&d[0]?.length&&d[1]?.length&&function qo(s){const{skuArr:e,index:t,skuName:n,skuVersion:r}=s;t>=e.length||(e[t]=[n,r].join("|"))}({skuArr:c,index:u,skuName:d[0],skuVersion:d[1]})}),c.join(",")}(e)}}class zn{constructor(e,t,n,r,o,a,c,d,u){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=a,this.nativeMessageHandler=d,this.correlationId=u||(0,ie.Oy)(),this.logger=r.clone(g.Q1.MSAL_SKU,Xe,this.correlationId),this.performanceClient=c}clearCacheOnLogout(e){var t=this;return(0,C.A)(function*(){if(e){ce.accountInfoIsEqual(e,t.browserStorage.getActiveAccount(t.correlationId),!1)&&(t.logger.verbose("Setting active account to null"),t.browserStorage.setActiveAccount(null,t.correlationId));try{yield t.browserStorage.removeAccount(ce.generateAccountCacheKey(e),t.correlationId),t.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{t.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{t.logger.verbose("No account provided in logout request, clearing all cache items.",t.correlationId),yield t.browserStorage.clear(t.correlationId),yield t.browserCrypto.clearKeystore()}catch{t.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}})()}getRedirectUri(e){return this.logger.verbose("getRedirectUri called"),V.H.getAbsoluteUrl(e||this.config.auth.redirectUri,(0,ee.Uu)())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");const n={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new ot(n,this.browserStorage)}getDiscoveredAuthority(e){var t=this;return(0,C.A)(function*(){const{account:n}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;t.performanceClient.addQueueMeasurement(f.MX.StandardInteractionClientGetDiscoveredAuthority,t.correlationId);const o={protocolMode:t.config.auth.protocolMode,OIDCOptions:t.config.auth.OIDCOptions,knownAuthorities:t.config.auth.knownAuthorities,cloudDiscoveryMetadata:t.config.auth.cloudDiscoveryMetadata,authorityMetadata:t.config.auth.authorityMetadata,skipAuthorityMetadataCache:t.config.auth.skipAuthorityMetadataCache},a=e.requestAuthority||t.config.auth.authority,d=n&&(r?.length?"true"===r:t.config.auth.instanceAware)?t.config.auth.authority.replace(V.H.getDomainFromUrl(a),n.environment):a,u=ge.generateAuthority(d,e.requestAzureCloudOptions||t.config.auth.azureCloudOptions),p=yield k(xn,f.MX.AuthorityFactoryCreateDiscoveredInstance,t.logger,t.performanceClient,t.correlationId)(u,t.config.system.networkClient,t.browserStorage,o,t.logger,t.correlationId,t.performanceClient);if(n&&!p.isAlias(n.environment))throw(0,te.aD)(ne.K3);return p})()}}const Xo=32;function jo(s,e,t){return $t.apply(this,arguments)}function $t(){return($t=(0,C.A)(function*(s,e,t){s.addQueueMeasurement(f.MX.GeneratePkceCodes,t);const n=xe(Wo,f.MX.GenerateCodeVerifier,e,s,t)(s,e,t);return{verifier:n,challenge:yield k(Vo,f.MX.GenerateCodeChallengeFromVerifier,e,s,t)(n,s,e,t)}})).apply(this,arguments)}function Wo(s,e,t){try{const n=new Uint8Array(Xo);return xe(ie.UY,f.MX.GetRandomValues,e,s,t)(n),(0,De.dB)(n)}catch{throw(0,O.bD)(b.p5)}}function Vo(s,e,t,n){return qt.apply(this,arguments)}function qt(){return(qt=(0,C.A)(function*(s,e,t,n){e.addQueueMeasurement(f.MX.GenerateCodeChallengeFromVerifier,n);try{const r=yield k(ie.sI,f.MX.Sha256Digest,t,e,n)(s,e,n);return(0,De.dB)(new Uint8Array(r))}catch{throw(0,O.bD)(b.p5)}})).apply(this,arguments)}function Xt(s,e,t,n){return jt.apply(this,arguments)}function jt(){return(jt=(0,C.A)(function*(s,e,t,n){t.addQueueMeasurement(f.MX.InitializeBaseRequest,s.correlationId);const r=s.authority||e.auth.authority,o=[...s&&s.scopes||[]],a={...s,correlationId:s.correlationId,authority:r,scopes:o};if(a.authenticationScheme){if(a.authenticationScheme===l.IO.SSH){if(!s.sshJwk)throw(0,te.aD)(ne.LX);if(!s.sshKid)throw(0,te.aD)(ne.rB)}n.verbose(`Authentication Scheme set to "${a.authenticationScheme}" as configured in Auth request`)}else a.authenticationScheme=l.IO.BEARER,n.verbose('Authentication Scheme wasn\'t explicitly set in request, defaulting to "Bearer" request');return e.cache.claimsBasedCachingEnabled&&s.claims&&!Le.$.isEmptyObj(s.claims)&&(a.requestedClaimsHash=yield(0,ie.YZ)(s.claims)),a})).apply(this,arguments)}function Qo(s,e,t,n,r){return Wt.apply(this,arguments)}function Wt(){return(Wt=(0,C.A)(function*(s,e,t,n,r){n.addQueueMeasurement(f.MX.InitializeSilentRequest,s.correlationId);const o=yield k(Xt,f.MX.InitializeBaseRequest,r,n,s.correlationId)(s,t,n,r);return{...s,...o,account:e,forceRefresh:s.forceRefresh||!1}})).apply(this,arguments)}class Je extends zn{initializeAuthorizationCodeRequest(e){var t=this;return(0,C.A)(function*(){t.performanceClient.addQueueMeasurement(f.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,t.correlationId);const n=yield k(jo,f.MX.GeneratePkceCodes,t.logger,t.performanceClient,t.correlationId)(t.performanceClient,t.logger,t.correlationId),r={...e,redirectUri:e.redirectUri,code:l.YM.EMPTY_STRING,codeVerifier:n.verifier};return e.codeChallenge=n.challenge,e.codeChallengeMethod=l.YM.S256_CODE_CHALLENGE_METHOD,r})()}initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);const t={correlationId:this.correlationId||(0,ie.Oy)(),...e};if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=n)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return e&&null===e.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=V.H.getAbsoluteUrl(e.postLogoutRedirectUri,(0,ee.Uu)())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=V.H.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,(0,ee.Uu)())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=V.H.getAbsoluteUrl((0,ee.Uu)(),(0,ee.Uu)())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}createAuthCodeClient(e){var t=this;return(0,C.A)(function*(){t.performanceClient.addQueueMeasurement(f.MX.StandardInteractionClientCreateAuthCodeClient,t.correlationId);const n=yield k(t.getClientConfiguration.bind(t),f.MX.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,t.correlationId)(e);return new Fn(n,t.performanceClient)})()}getClientConfiguration(e){var t=this;return(0,C.A)(function*(){const{serverTelemetryManager:n,requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:a,account:c}=e;t.performanceClient.addQueueMeasurement(f.MX.StandardInteractionClientGetClientConfiguration,t.correlationId);const d=yield k(t.getDiscoveredAuthority.bind(t),f.MX.StandardInteractionClientGetDiscoveredAuthority,t.logger,t.performanceClient,t.correlationId)({requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:a,account:c}),u=t.config.system.loggerOptions;return{authOptions:{clientId:t.config.auth.clientId,authority:d,clientCapabilities:t.config.auth.clientCapabilities,redirectUri:t.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:t.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:u.loggerCallback,piiLoggingEnabled:u.piiLoggingEnabled,logLevel:u.logLevel,correlationId:t.correlationId},cacheOptions:{claimsBasedCachingEnabled:t.config.cache.claimsBasedCachingEnabled},cryptoInterface:t.browserCrypto,networkInterface:t.networkClient,storageInterface:t.browserStorage,serverTelemetryManager:n,libraryInfo:{sku:g.Q1.MSAL_SKU,version:Xe,cpu:l.YM.EMPTY_STRING,os:l.YM.EMPTY_STRING},telemetry:t.config.telemetry}})()}initializeAuthorizationRequest(e,t){var n=this;return(0,C.A)(function*(){n.performanceClient.addQueueMeasurement(f.MX.StandardInteractionClientInitializeAuthorizationRequest,n.correlationId);const r=n.getRedirectUri(e.redirectUri),a=Ee.setRequestState(n.browserCrypto,e&&e.state||l.YM.EMPTY_STRING,{interactionType:t}),d={...yield k(Xt,f.MX.InitializeBaseRequest,n.logger,n.performanceClient,n.correlationId)({...e,correlationId:n.correlationId},n.config,n.performanceClient,n.logger),redirectUri:r,state:a,nonce:e.nonce||(0,ie.Oy)(),responseMode:n.config.auth.OIDCOptions.serverResponseType};if(e.loginHint||e.sid)return d;const u=e.account||n.browserStorage.getActiveAccount(n.correlationId);if(u&&(n.logger.verbose("Setting validated request account",n.correlationId),n.logger.verbosePii(`Setting validated request account: ${u.homeAccountId}`,n.correlationId),d.account=u),!d.loginHint&&!u){const p=n.browserStorage.getLegacyLoginHint();p&&(d.loginHint=p)}return d})()}}var $n=A(6213);const qn="user_switch",ai={[qn]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."};class Me extends oe.lR{constructor(e,t,n){super(e,t),Object.setPrototypeOf(this,Me.prototype),this.name="NativeAuthError",this.ext=n}}function Ze(s){return!!(s.ext&&s.ext.status&&("PERSISTENT_ERROR"===s.ext.status||"DISABLED"===s.ext.status)||s.ext&&s.ext.error&&-2147186943===s.ext.error)||"ContentError"===s.errorCode}function Vt(s,e,t){if(t&&t.status)switch(t.status){case"ACCOUNT_UNAVAILABLE":return Ht(mt);case"USER_INTERACTION_REQUIRED":return new Ie(s,e);case"USER_CANCEL":return(0,O.bD)(b.fN);case"NO_NETWORK":return(0,O.bD)(b.l7)}return new Me(s,ai[s]||e,t)}class Qt extends Gt{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return(0,C.A)(function*(){t.performanceClient?.addQueueMeasurement(f.MX.RefreshTokenClientAcquireToken,e.correlationId);const n=Ce(),r=yield k(t.executeTokenRequest.bind(t),f.MX.RefreshTokenClientExecuteTokenRequest,t.logger,t.performanceClient,e.correlationId)(e,t.authority),o=r.headers?.[l.OK.X_MS_REQUEST_ID],a=new Fe(t.config.authOptions.clientId,t.cacheManager,t.cryptoUtils,t.logger,t.config.serializableCache,t.config.persistencePlugin);return a.validateTokenResponse(r.body),k(a.handleServerTokenResponse.bind(a),f.MX.HandleServerTokenResponse,t.logger,t.performanceClient,e.correlationId)(r.body,t.authority,n,e,void 0,void 0,!0,e.forceCache,o)})()}acquireTokenByRefreshToken(e){var t=this;return(0,C.A)(function*(){if(!e)throw(0,te.aD)(ne.Ub);if(t.performanceClient?.addQueueMeasurement(f.MX.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw(0,v.SB)(E.C2);if(t.cacheManager.isAppMetadataFOCI(e.account.environment))try{return yield k(t.acquireTokenWithCachedRefreshToken.bind(t),f.MX.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!0)}catch(r){if(r instanceof Ie&&r.errorCode===je||r instanceof He&&r.errorCode===l.I.INVALID_GRANT_ERROR&&r.subError===l.I.CLIENT_MISMATCH_ERROR)return k(t.acquireTokenWithCachedRefreshToken.bind(t),f.MX.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!1);throw r}return k(t.acquireTokenWithCachedRefreshToken.bind(t),f.MX.RefreshTokenClientAcquireTokenWithCachedRefreshToken,t.logger,t.performanceClient,e.correlationId)(e,!1)})()}acquireTokenWithCachedRefreshToken(e,t){var n=this;return(0,C.A)(function*(){n.performanceClient?.addQueueMeasurement(f.MX.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);const r=xe(n.cacheManager.getRefreshToken.bind(n.cacheManager),f.MX.CacheManagerGetRefreshToken,n.logger,n.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0,n.performanceClient);if(!r)throw Ht(je);if(r.expiresOn&&nt(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||300))throw Ht(Lt);const o={...e,refreshToken:r.secret,authenticationScheme:e.authenticationScheme||l.IO.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:"home_account_id"}};try{return yield k(n.acquireToken.bind(n),f.MX.RefreshTokenClientAcquireToken,n.logger,n.performanceClient,e.correlationId)(o)}catch(a){if(a instanceof Ie&&a.subError===We){n.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");const c=Ye(r);n.cacheManager.removeRefreshToken(c,e.correlationId)}throw a}})()}executeTokenRequest(e,t){var n=this;return(0,C.A)(function*(){n.performanceClient?.addQueueMeasurement(f.MX.RefreshTokenClientExecuteTokenRequest,e.correlationId);const r=n.createTokenQueryParameters(e),o=V.H.appendQueryString(t.tokenEndpoint,r),a=yield k(n.createTokenRequestBody.bind(n),f.MX.RefreshTokenClientCreateTokenRequestBody,n.logger,n.performanceClient,e.correlationId)(e),c=n.createTokenRequestHeaders(e.ccsCredential),d={clientId:e.tokenBodyParameters?.clientId||n.config.authOptions.clientId,authority:t.canonicalAuthority,scopes:e.scopes,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid};return k(n.executePostToTokenEndpoint.bind(n),f.MX.RefreshTokenClientExecutePostToTokenEndpoint,n.logger,n.performanceClient,e.correlationId)(o,a,c,d,e.correlationId,f.MX.RefreshTokenClientExecutePostToTokenEndpoint)})()}createTokenRequestBody(e){var t=this;return(0,C.A)(function*(){t.performanceClient?.addQueueMeasurement(f.MX.RefreshTokenClientCreateTokenRequestBody,e.correlationId);const r=new rt(e.correlationId,t.performanceClient);if(r.addClientId(e.embeddedClientId||e.tokenBodyParameters?.[Ke]||t.config.authOptions.clientId),e.redirectUri&&r.addRedirectUri(e.redirectUri),r.addScopes(e.scopes,!0,t.config.authOptions.authority.options.OIDCOptions?.defaultScopes),r.addGrantType(l.$x.REFRESH_TOKEN_GRANT),r.addClientInfo(),r.addLibraryInfo(t.config.libraryInfo),r.addApplicationTelemetry(t.config.telemetry.application),r.addThrottling(),t.serverTelemetryManager&&!bt(t.config)&&r.addServerTelemetry(t.serverTelemetryManager),r.addRefreshToken(e.refreshToken),t.config.clientCredentials.clientSecret&&r.addClientSecret(t.config.clientCredentials.clientSecret),t.config.clientCredentials.clientAssertion){const o=t.config.clientCredentials.clientAssertion;r.addClientAssertion(yield Kn(o.assertion,t.config.authOptions.clientId,e.resourceRequestUri)),r.addClientAssertionType(o.assertionType)}if(e.authenticationScheme===l.IO.POP){const o=new Qe(t.cryptoUtils,t.performanceClient);let a;a=e.popKid?t.cryptoUtils.encodeKid(e.popKid):(yield k(o.generateCnf.bind(o),f.MX.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(e,t.logger)).reqCnfString,r.addPopToken(a)}else if(e.authenticationScheme===l.IO.SSH){if(!e.sshJwk)throw(0,te.aD)(ne.LX);r.addSshJwk(e.sshJwk)}if((!Le.$.isEmptyObj(e.claims)||t.config.authOptions.clientCapabilities&&t.config.authOptions.clientCapabilities.length>0)&&r.addClaims(e.claims,t.config.authOptions.clientCapabilities),t.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case"home_account_id":try{const o=ze(e.ccsCredential.credential);r.addCcsOid(o)}catch(o){t.logger.verbose("Could not parse home account ID for CCS Header: "+o)}break;case"UPN":r.addCcsUpn(e.ccsCredential.credential)}return e.embeddedClientId&&r.addBrokerParameters({brokerClientId:t.config.authOptions.clientId,brokerRedirectUri:t.config.authOptions.redirectUri}),e.tokenBodyParameters&&r.addExtraQueryParameters(e.tokenBodyParameters),r.createQueryString()})()}}class ci extends Gt{constructor(e,t){super(e,t)}acquireToken(e){var t=this;return(0,C.A)(function*(){try{const[n,r]=yield t.acquireCachedToken({...e,scopes:e.scopes?.length?e.scopes:[...l.aZ]});return r===l.Rv.PROACTIVELY_REFRESHED&&(t.logger.info("SilentFlowClient:acquireCachedToken - Cached access token's refreshOn property has been exceeded'. It's not expired, but must be refreshed."),new Qt(t.config,t.performanceClient).acquireTokenByRefreshToken(e).catch(()=>{})),n}catch(n){if(n instanceof v.eB&&n.errorCode===E.wb)return new Qt(t.config,t.performanceClient).acquireTokenByRefreshToken(e);throw n}})()}acquireCachedToken(e){var t=this;return(0,C.A)(function*(){t.performanceClient?.addQueueMeasurement(f.MX.SilentFlowClientAcquireCachedToken,e.correlationId);let n=l.Rv.NOT_APPLICABLE;if(e.forceRefresh||!t.config.cacheOptions.claimsBasedCachingEnabled&&!Le.$.isEmptyObj(e.claims))throw t.setCacheOutcome(l.Rv.FORCE_REFRESH_OR_CLAIMS,e.correlationId),(0,v.SB)(E.wb);if(!e.account)throw(0,v.SB)(E.C2);const r=e.account.tenantId||function Br(s){const n=new V.H(s).getUrlComponents().PathSegments.slice(-1)[0]?.toLowerCase();switch(n){case l.v2.COMMON:case l.v2.ORGANIZATIONS:case l.v2.CONSUMERS:return;default:return n}}(e.authority),o=t.cacheManager.getTokenKeys(),a=t.cacheManager.getAccessToken(e.account,e,o,r,t.performanceClient);if(!a)throw t.setCacheOutcome(l.Rv.NO_CACHED_ACCESS_TOKEN,e.correlationId),(0,v.SB)(E.wb);if(function Qn(s){return Number(s)>Ce()}(a.cachedAt)||nt(a.expiresOn,t.config.systemOptions.tokenRenewalOffsetSeconds))throw t.setCacheOutcome(l.Rv.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),(0,v.SB)(E.wb);a.refreshOn&&nt(a.refreshOn,0)&&(n=l.Rv.PROACTIVELY_REFRESHED);const c=e.authority||t.authority.getPreferredCache(),d={account:t.cacheManager.readAccountFromCache(e.account,e.correlationId),accessToken:a,idToken:t.cacheManager.getIdToken(e.account,e.correlationId,o,r,t.performanceClient),refreshToken:null,appMetadata:t.cacheManager.readAppMetadataFromCache(c)};return t.setCacheOutcome(n,e.correlationId),t.config.serverTelemetryManager&&t.config.serverTelemetryManager.incrementCacheHits(),[yield k(t.generateResultFromCacheRecord.bind(t),f.MX.SilentFlowClientGenerateResultFromCacheRecord,t.logger,t.performanceClient,e.correlationId)(d,e),n]})()}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==l.Rv.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}generateResultFromCacheRecord(e,t){var n=this;return(0,C.A)(function*(){let r;if(n.performanceClient?.addQueueMeasurement(f.MX.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId),e.idToken&&(r=_e(e.idToken.secret,n.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){const o=r?.auth_time;if(!o)throw(0,v.SB)(E.n3);st(o,t.maxAge)}return Fe.generateAuthenticationResult(n.cryptoUtils,n.authority,e,!0,t,r)})()}}class Xn extends Je{acquireToken(e){var t=this;return(0,C.A)(function*(){t.performanceClient.addQueueMeasurement(f.MX.SilentCacheClientAcquireToken,e.correlationId);const n=t.initializeServerTelemetryManager(g.sA.acquireTokenSilent_silentFlow),r=yield k(t.getClientConfiguration.bind(t),f.MX.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:n,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),o=new ci(r,t.performanceClient);t.logger.verbose("Silent auth client created");try{const c=(yield k(o.acquireCachedToken.bind(o),f.MX.SilentFlowClientAcquireCachedToken,t.logger,t.performanceClient,e.correlationId)(e))[0];return t.performanceClient.addFields({fromCache:!0},e.correlationId),c}catch(a){throw a instanceof O.jT&&a.errorCode===b.e0&&t.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),a}})()}logout(e){this.logger.verbose("logoutRedirect called");const t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t?.account)}}class et extends zn{constructor(e,t,n,r,o,a,c,d,u,p,S,w){super(e,t,n,r,o,a,d,u,w),this.apiId=c,this.accountId=p,this.nativeMessageHandler=u,this.nativeStorageManager=S,this.silentCacheClient=new Xn(e,this.nativeStorageManager,n,r,o,a,d,u,w),this.serverTelemetryManager=this.initializeServerTelemetryManager(this.apiId);const D=this.nativeMessageHandler.getExtensionId()===g.JD.PREFERRED_EXTENSION_ID?"chrome":this.nativeMessageHandler.getExtensionId()?.length?"unknown":void 0;this.skus=ot.makeExtraSkuString({libraryName:g.Q1.MSAL_SKU,libraryVersion:Xe,extensionName:D,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,"x-client-xtra-sku":this.skus}}acquireToken(e){var t=this;return(0,C.A)(function*(){t.performanceClient.addQueueMeasurement(f.MX.NativeInteractionClientAcquireToken,e.correlationId),t.logger.trace("NativeInteractionClient - acquireToken called.");const n=t.performanceClient.startMeasurement(f.MX.NativeInteractionClientAcquireToken,e.correlationId),r=Ce();try{const o=yield t.initializeNativeRequest(e);try{const p=yield t.acquireTokensFromCache(t.accountId,o);return n.end({success:!0,isNativeBroker:!1,fromCache:!0}),p}catch{t.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}const{...a}=o,c={method:g.Ct.GetToken,request:a},d=yield t.nativeMessageHandler.sendMessage(c),u=t.validateNativeResponse(d);return yield t.handleNativeResponse(u,o,r).then(p=>(n.end({success:!0,isNativeBroker:!0,requestId:p.requestId}),t.serverTelemetryManager.clearNativeBrokerErrorCode(),p)).catch(p=>{throw n.end({success:!1,errorCode:p.errorCode,subErrorCode:p.subError,isNativeBroker:!0}),p})}catch(o){throw o instanceof Me&&t.serverTelemetryManager.setNativeBrokerErrorCode(o.errorCode),o}})()}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:re.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}acquireTokensFromCache(e,t){var n=this;return(0,C.A)(function*(){if(!e)throw n.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),(0,v.SB)(E.rk);const r=n.browserStorage.getBaseAccountInfo({nativeAccountId:e},t.correlationId);if(!r)throw(0,v.SB)(E.rk);try{const o=n.createSilentCacheRequest(t,r),a=yield n.silentCacheClient.acquireToken(o),c={...r,idTokenClaims:a?.idTokenClaims,idToken:a?.idToken};return{...a,account:c}}catch(o){throw o}})()}acquireTokenRedirect(e,t){var n=this;return(0,C.A)(function*(){n.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");const{...r}=e;delete r.onRedirectNavigate;const o=yield n.initializeNativeRequest(r),a={method:g.Ct.GetToken,request:o};try{const u=yield n.nativeMessageHandler.sendMessage(a);n.validateNativeResponse(u)}catch(u){if(u instanceof Me&&(n.serverTelemetryManager.setNativeBrokerErrorCode(u.errorCode),Ze(u)))throw u}n.browserStorage.setTemporaryCache(g._p.NATIVE_REQUEST,JSON.stringify(o),!0);const c={apiId:g.sA.acquireTokenRedirect,timeout:n.config.system.redirectNavigationTimeout,noHistory:!1},d=n.config.auth.navigateToLoginRequestUrl?window.location.href:n.getRedirectUri(e.redirectUri);t.end({success:!0}),yield n.navigationClient.navigateExternal(d,c)})()}handleRedirectPromise(e,t){var n=this;return(0,C.A)(function*(){if(n.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!n.browserStorage.isInteractionInProgress(!0))return n.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const r=n.browserStorage.getCachedNativeRequest();if(!r)return n.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:o,...a}=r;o&&n.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),n.browserStorage.removeItem(n.browserStorage.generateCacheKey(g._p.NATIVE_REQUEST));const c={method:g.Ct.GetToken,request:a},d=Ce();try{n.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");const u=yield n.nativeMessageHandler.sendMessage(c);n.validateNativeResponse(u);const p=n.handleNativeResponse(u,a,d);n.browserStorage.setInteractionInProgress(!1);const S=yield p;return n.serverTelemetryManager.clearNativeBrokerErrorCode(),S}catch(u){throw n.browserStorage.setInteractionInProgress(!1),u}})()}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}handleNativeResponse(e,t,n){var r=this;return(0,C.A)(function*(){r.logger.trace("NativeInteractionClient - handleNativeResponse called.");const o=_e(e.id_token,ke),a=r.createHomeAccountIdentifier(e,o),c=r.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},r.correlationId)?.homeAccountId;if(a!==c&&e.account.id!==t.accountId)throw Vt(qn);const d=yield r.getDiscoveredAuthority({requestAuthority:t.authority}),u=Yt(r.browserStorage,d,a,ke,r.correlationId,o,e.client_info,void 0,o.tid,void 0,e.account.id,r.logger),p=yield r.generateAuthenticationResult(e,t,o,u,d.canonicalAuthority,n);return r.cacheAccount(u),r.cacheNativeTokens(e,t,a,o,e.access_token,p.tenantId,n),p})()}createHomeAccountIdentifier(e,t){return ce.generateHomeAccountId(e.client_info||l.YM.EMPTY_STRING,0,this.logger,this.browserCrypto,t)}generateScopes(e,t){return re.fromString(e.scope?e.scope:t.scope)}generatePopAccessToken(e,t){var n=this;return(0,C.A)(function*(){if(t.tokenType===l.IO.POP&&t.signPopToken){if(e.shr)return n.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;const r=new Qe(n.browserCrypto),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw(0,v.SB)(E.fo);return r.signPopToken(e.access_token,t.keyId,o)}return e.access_token})()}generateAuthenticationResult(e,t,n,r,o,a){var c=this;return(0,C.A)(function*(){const d=c.addTelemetryFromNativeResponse(e),u=re.fromString(e.scope?e.scope:t.scope),p=e.account.properties||{},S=p.UID||n.oid||n.sub||l.YM.EMPTY_STRING,w=p.TenantId||n.tid||l.YM.EMPTY_STRING,D=St(r.getAccountInfo(),void 0,n,e.id_token);D.nativeAccountId!==e.account.id&&(D.nativeAccountId=e.account.id);const Y=yield c.generatePopAccessToken(e,t),F=t.tokenType===l.IO.POP?l.IO.POP:l.IO.BEARER;return{authority:o,uniqueId:S,tenantId:w,scopes:u.asArray(),account:D,idToken:e.id_token,idTokenClaims:n,accessToken:Y,fromCache:!!d&&c.isResponseFromCache(d),expiresOn:new Date(1e3*Number(a+e.expires_in)),tokenType:F,correlationId:c.correlationId,state:e.state,fromNativeBroker:!0}})()}cacheAccount(e){this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e,this.correlationId).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})}cacheNativeTokens(e,t,n,r,o,a,c){const d=ct(n,t.authority,e.id_token||"",t.clientId,r.tid||""),p=c+(t.tokenType===l.IO.POP?l.YM.SHR_NONCE_VALIDITY:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),S=this.generateScopes(e,t),w=lt(n,t.authority,o,t.clientId,r.tid||a,S.printScopes(),p,0,ke,void 0,t.tokenType,void 0,t.keyId);this.nativeStorageManager.saveCacheRecord({idToken:d,accessToken:w},t.correlationId,t.storeInCache)}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw(0,oe.pz)($n.W,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}initializeNativeRequest(e){var t=this;return(0,C.A)(function*(){t.logger.trace("NativeInteractionClient - initializeNativeRequest called");const n=e.authority||t.config.auth.authority;e.account&&(yield t.getDiscoveredAuthority({requestAuthority:n,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}));const r=new V.H(n);r.validateAsUri();const{scopes:o,...a}=e,c=new re(o||[]);c.appendScopes(l.aZ);const u={...a,accountId:t.accountId,clientId:t.config.auth.clientId,authority:r.urlString,scope:c.printScopes(),redirectUri:t.getRedirectUri(e.redirectUri),prompt:(()=>{switch(t.apiId){case g.sA.ssoSilent:case g.sA.acquireTokenSilent_silentFlow:return t.logger.trace("initializeNativeRequest: silent request sets prompt to none"),l._M.NONE}if(e.prompt)switch(e.prompt){case l._M.NONE:case l._M.CONSENT:case l._M.LOGIN:return t.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw t.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),(0,O.bD)(b.nF)}else t.logger.trace("initializeNativeRequest: prompt was not provided")})(),correlationId:t.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraQueryParameters,...e.tokenQueryParameters},extendedExpiryToken:!1,keyId:e.popKid};if(u.signPopToken&&e.popKid)throw(0,O.bD)(b.bT);if(t.handleExtraBrokerParams(u),u.extraParameters=u.extraParameters||{},u.extraParameters.telemetry=g.JD.MATS_TELEMETRY,e.authenticationScheme===l.IO.POP){const p={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},S=new Qe(t.browserCrypto);let w;if(u.keyId)w=t.browserCrypto.base64UrlEncode(JSON.stringify({kid:u.keyId})),u.signPopToken=!1;else{const D=yield k(S.generateCnf.bind(S),f.MX.PopTokenGenerateCnf,t.logger,t.performanceClient,e.correlationId)(p,t.logger);w=D.reqCnfString,u.keyId=D.kid,u.signPopToken=!0}u.reqCnf=w}return t.addRequestSKUs(u),u})()}handleExtraBrokerParams(e){const t=e.extraParameters&&e.extraParameters.hasOwnProperty(xt)&&e.extraParameters.hasOwnProperty(Kt)&&e.extraParameters.hasOwnProperty(Ke);if(!e.embeddedClientId&&!t)return;let n="";const r=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,n=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[Kt],n=e.extraParameters[Ke]),e.extraParameters={child_client_id:n,child_redirect_uri:r},this.performanceClient?.addFields({embeddedClientId:n,embeddedRedirectUri:r},e.correlationId)}}class be{constructor(e,t,n,r){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=r,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(f.MX.NativeMessageHandlerHandshake)}sendMessage(e){var t=this;return(0,C.A)(function*(){t.logger.trace("NativeMessageHandler - sendMessage called.");const n={channel:g.JD.CHANNEL_ID,extensionId:t.extensionId,responseId:(0,ie.Oy)(),body:e};return t.logger.trace("NativeMessageHandler - Sending request to browser extension"),t.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(n)}`),t.messageChannel.port1.postMessage(n),new Promise((r,o)=>{t.resolvers.set(n.responseId,{resolve:r,reject:o})})})()}static createProvider(e,t,n){return(0,C.A)(function*(){e.trace("NativeMessageHandler - createProvider called.");try{const r=new be(e,t,n,g.JD.PREFERRED_EXTENSION_ID);return yield r.sendHandshakeRequest(),r}catch{const o=new be(e,t,n);return yield o.sendHandshakeRequest(),o}})()}sendHandshakeRequest(){var e=this;return(0,C.A)(function*(){e.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",e.windowListener,!1);const t={channel:g.JD.CHANNEL_ID,extensionId:e.extensionId,responseId:(0,ie.Oy)(),body:{method:g.Ct.HandshakeRequest}};return e.handshakeEvent.add({extensionId:e.extensionId,extensionHandshakeTimeoutMs:e.handshakeTimeoutMs}),e.messageChannel.port1.onmessage=n=>{e.onChannelMessage(n)},window.postMessage(t,window.origin,[e.messageChannel.port2]),new Promise((n,r)=>{e.handshakeResolvers.set(t.responseId,{resolve:n,reject:r}),e.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",e.windowListener,!1),e.messageChannel.port1.close(),e.messageChannel.port2.close(),e.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r((0,O.bD)(b.y3)),e.handshakeResolvers.delete(t.responseId)},e.handshakeTimeoutMs)})})()}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;const t=e.data;if(t.channel&&t.channel===g.JD.CHANNEL_ID&&(!t.extensionId||t.extensionId===this.extensionId)&&t.body.method===g.Ct.HandshakeRequest){const n=this.handshakeResolvers.get(t.responseId);if(!n)return void this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),n.reject((0,O.bD)(b.cq))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");const t=e.data,n=this.resolvers.get(t.responseId),r=this.handshakeResolvers.get(t.responseId);try{const o=t.body.method;if(o===g.Ct.Response){if(!n)return;const a=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(a)}`),"Success"!==a.status)n.reject(Vt(a.code,a.description,a.ext));else{if(!a.result)throw(0,oe.pz)($n.W,"Event does not contain result.");a.result.code&&a.result.description?n.reject(Vt(a.result.code,a.result.description,a.result.ext)):n.resolve(a.result)}this.resolvers.delete(t.responseId)}else if(o===g.Ct.HandshakeResponse){if(!r)return void this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),r.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(o){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${o}`),this.logger.errorPii(`Unable to parse ${e}`),n?n.reject(o):r&&r.reject(o)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isNativeAvailable(e,t,n,r){if(t.trace("isNativeAvailable called"),!e.system.allowNativeBroker)return t.trace("isNativeAvailable: allowNativeBroker is not enabled, returning false"),!1;if(!n)return t.trace("isNativeAvailable: WAM extension provider is not initialized, returning false"),!1;if(r)switch(r){case l.IO.BEARER:case l.IO.POP:return t.trace("isNativeAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isNativeAvailable: authenticationScheme is not supported, returning false"),!1}return!0}}class Jt{constructor(e,t,n,r,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=o}handleCodeResponse(e,t){var n=this;return(0,C.A)(function*(){let r;n.performanceClient.addQueueMeasurement(f.MX.HandleCodeResponse,t.correlationId);try{r=n.authModule.handleFragmentResponse(e,t.state)}catch(o){throw o instanceof He&&o.subError===b.fN?(0,O.bD)(b.fN):o}return k(n.handleCodeResponseFromServer.bind(n),f.MX.HandleCodeResponseFromServer,n.logger,n.performanceClient,t.correlationId)(r,t)})()}handleCodeResponseFromServer(e,t){var n=this;return(0,C.A)(function*(r,o,a=!0){if(n.performanceClient.addQueueMeasurement(f.MX.HandleCodeResponseFromServer,o.correlationId),n.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),n.authCodeRequest.code=r.code,r.cloud_instance_host_name&&(yield k(n.authModule.updateAuthority.bind(n.authModule),f.MX.UpdateTokenEndpointAuthority,n.logger,n.performanceClient,o.correlationId)(r.cloud_instance_host_name,o.correlationId)),a&&(r.nonce=o.nonce||void 0),r.state=o.state,r.client_info)n.authCodeRequest.clientInfo=r.client_info;else{const d=n.createCcsCredentials(o);d&&(n.authCodeRequest.ccsCredential=d)}return yield k(n.authModule.acquireToken.bind(n.authModule),f.MX.AuthClientAcquireToken,n.logger,n.performanceClient,o.correlationId)(n.authCodeRequest,r)}).apply(this,arguments)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:"home_account_id"}:e.loginHint?{credential:e.loginHint,type:"UPN"}:null}}var Ct=A(2718);function jn(s,e,t){const n=Ct.n(s);if(!n)throw Ct.S(s)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${s}`),(0,O.bD)(b.Lm)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),(0,O.bD)(b.wv));return n}class di extends Je{constructor(e,t,n,r,o,a,c,d,u,p){super(e,t,n,r,o,a,c,u,p),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=d}acquireToken(e){try{const n={popupName:this.generatePopupName(e.scopes||l.aZ,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,n)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),n.popup=this.openSizedPopup("about:blank",n),this.acquireTokenPopupAsync(e,n))}catch(t){return Promise.reject(t)}}logout(e){try{this.logger.verbose("logoutPopup called");const t=this.initializeLogoutRequest(e),n={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},r=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,n,r,o)):(this.logger.verbose("asyncPopup set to false, opening popup"),n.popup=this.openSizedPopup("about:blank",n),this.logoutPopupAsync(t,n,r,o))}catch(t){return Promise.reject(t)}}acquireTokenPopupAsync(e,t){var n=this;return(0,C.A)(function*(){n.logger.verbose("acquireTokenPopupAsync called");const r=n.initializeServerTelemetryManager(g.sA.acquireTokenPopup),o=yield k(n.initializeAuthorizationRequest.bind(n),f.MX.StandardInteractionClientInitializeAuthorizationRequest,n.logger,n.performanceClient,n.correlationId)(e,g.X8.Popup);(0,ee.kZ)(o.authority);try{const a=yield k(n.initializeAuthorizationCodeRequest.bind(n),f.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,n.logger,n.performanceClient,n.correlationId)(o),c=yield k(n.createAuthCodeClient.bind(n),f.MX.StandardInteractionClientCreateAuthCodeClient,n.logger,n.performanceClient,n.correlationId)({serverTelemetryManager:r,requestAuthority:o.authority,requestAzureCloudOptions:o.azureCloudOptions,requestExtraQueryParameters:o.extraQueryParameters,account:o.account}),d=be.isNativeAvailable(n.config,n.logger,n.nativeMessageHandler,e.authenticationScheme);let u;d&&(u=n.performanceClient.startMeasurement(f.MX.FetchAccountIdWithNativeBroker,e.correlationId));const p=yield c.getAuthCodeUrl({...o,nativeBroker:d}),S=new Jt(c,n.browserStorage,a,n.logger,n.performanceClient),w=n.initiateAuthRequest(p,t);n.eventHandler.emitEvent(U.B.POPUP_OPENED,g.X8.Popup,{popupWindow:w},null);const D=yield n.monitorPopupForHash(w,t.popupWindowParent),Y=xe(jn,f.MX.DeserializeResponse,n.logger,n.performanceClient,n.correlationId)(D,n.config.auth.OIDCOptions.serverResponseType,n.logger);if(we.removeThrottle(n.browserStorage,n.config.auth.clientId,a),Y.accountId){if(n.logger.verbose("Account id found in hash, calling WAM for token"),u&&u.end({success:!0,isNativeBroker:!0}),!n.nativeMessageHandler)throw(0,O.bD)(b.XC);const ue=new et(n.config,n.browserStorage,n.browserCrypto,n.logger,n.eventHandler,n.navigationClient,g.sA.acquireTokenPopup,n.performanceClient,n.nativeMessageHandler,Y.accountId,n.nativeStorage,o.correlationId),{userRequestState:ve}=Ee.parseRequestState(n.browserCrypto,o.state);return yield ue.acquireToken({...o,state:ve,prompt:void 0})}return yield S.handleCodeResponse(Y,o)}catch(a){throw t.popup?.close(),a instanceof oe.lR&&(a.setCorrelationId(n.correlationId),r.cacheFailedRequest(a)),a}})()}logoutPopupAsync(e,t,n,r){var o=this;return(0,C.A)(function*(){o.logger.verbose("logoutPopupAsync called"),o.eventHandler.emitEvent(U.B.LOGOUT_START,g.X8.Popup,e);const a=o.initializeServerTelemetryManager(g.sA.logoutPopup);try{yield o.clearCacheOnLogout(e.account);const d=(yield k(o.createAuthCodeClient.bind(o),f.MX.StandardInteractionClientCreateAuthCodeClient,o.logger,o.performanceClient,o.correlationId)({serverTelemetryManager:a,requestAuthority:n,account:e.account||void 0})).getLogoutUri(e);o.eventHandler.emitEvent(U.B.LOGOUT_SUCCESS,g.X8.Popup,e);const u=o.openPopup(d,t);if(o.eventHandler.emitEvent(U.B.POPUP_OPENED,g.X8.Popup,{popupWindow:u},null),yield o.monitorPopupForHash(u,t.popupWindowParent).catch(()=>{}),r){const p={apiId:g.sA.logoutPopup,timeout:o.config.system.redirectNavigationTimeout,noHistory:!1},S=V.H.getAbsoluteUrl(r,(0,ee.Uu)());o.logger.verbose("Redirecting main window to url specified in the request"),o.logger.verbosePii(`Redirecting main window to: ${S}`),yield o.navigationClient.navigateInternal(S,p)}else o.logger.verbose("No main window navigation requested")}catch(c){throw t.popup?.close(),c instanceof oe.lR&&(c.setCorrelationId(o.correlationId),a.cacheFailedRequest(c)),o.browserStorage.setInteractionInProgress(!1),o.eventHandler.emitEvent(U.B.LOGOUT_FAILURE,g.X8.Popup,null,c),o.eventHandler.emitEvent(U.B.LOGOUT_END,g.X8.Popup),c}o.eventHandler.emitEvent(U.B.LOGOUT_END,g.X8.Popup)})()}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),(0,O.bD)(b.B2)}monitorPopupForHash(e,t){return new Promise((n,r)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");const o=setInterval(()=>{if(e.closed)return this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(o),void r((0,O.bD)(b.fN));let a="";try{a=e.location.href}catch{}if(!a||"about:blank"===a)return;clearInterval(o);let c="";e&&(c=this.config.auth.OIDCOptions.serverResponseType===l.zL.QUERY?e.location.search:e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),n(c)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),n.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),n=this.openSizedPopup(e,t)),!n)throw(0,O.bD)(b.MP);return n.focus&&n.focus(),this.currentWindow=n,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),n}catch(n){throw this.logger.error("error opening popup "+n.message),this.browserStorage.setInteractionInProgress(!1),(0,O.bD)(b.hs)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:n,popupWindowParent:r}){const o=r.screenLeft?r.screenLeft:r.screenX,a=r.screenTop?r.screenTop:r.screenY,c=r.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,d=r.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let u=n.popupSize?.width,p=n.popupSize?.height,S=n.popupPosition?.top,w=n.popupPosition?.left;return(!u||u<0||u>c)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),u=g.Q1.POPUP_WIDTH),(!p||p<0||p>d)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),p=g.Q1.POPUP_HEIGHT),(!S||S<0||S>d)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),S=Math.max(0,d/2-g.Q1.POPUP_HEIGHT/2+a)),(!w||w<0||w>c)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),w=Math.max(0,c/2-g.Q1.POPUP_WIDTH/2+o)),r.open(e,t,`width=${u}, height=${p}, top=${S}, left=${w}, scrollbars=yes`)}unloadWindow(e){this.browserStorage.cleanRequestByInteractionType(g.X8.Popup),this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow),this.browserStorage.setInteractionInProgress(!1)}generatePopupName(e,t){return`${g.Q1.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){return`${g.Q1.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.account&&e.account.homeAccountId}.${this.correlationId}`}}class Wn{constructor(e,t,n,r,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=o}initiateAuthRequest(e,t){var n=this;return(0,C.A)(function*(){if(n.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){t.redirectStartPage&&(n.logger.verbose("RedirectHandler.initiateAuthRequest: redirectStartPage set, caching start page"),n.browserStorage.setTemporaryCache(g._p.ORIGIN_URI,t.redirectStartPage,!0)),n.browserStorage.setTemporaryCache(g._p.CORRELATION_ID,n.authCodeRequest.correlationId,!0),n.browserStorage.cacheCodeRequest(n.authCodeRequest),n.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);const r={apiId:g.sA.acquireTokenRedirect,timeout:t.redirectTimeout,noHistory:!1};return"function"==typeof t.onRedirectNavigate?(n.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),!1!==t.onRedirectNavigate(e)?(n.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),void(yield t.navigationClient.navigateExternal(e,r))):void n.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation")):(n.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),void(yield t.navigationClient.navigateExternal(e,r)))}throw n.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),(0,O.bD)(b.B2)})()}handleCodeResponse(e,t){var n=this;return(0,C.A)(function*(){n.logger.verbose("RedirectHandler.handleCodeResponse called"),n.browserStorage.setInteractionInProgress(!1);const r=n.browserStorage.generateStateKey(t),o=n.browserStorage.getTemporaryCache(r);if(!o)throw(0,v.SB)(E.tQ,"Cached State");let a;try{a=n.authModule.handleFragmentResponse(e,o)}catch(p){throw p instanceof He&&p.subError===b.fN?(0,O.bD)(b.fN):p}const c=n.browserStorage.generateNonceKey(o),d=n.browserStorage.getTemporaryCache(c);if(n.authCodeRequest.code=a.code,a.cloud_instance_host_name&&(yield k(n.authModule.updateAuthority.bind(n.authModule),f.MX.UpdateTokenEndpointAuthority,n.logger,n.performanceClient,n.authCodeRequest.correlationId)(a.cloud_instance_host_name,n.authCodeRequest.correlationId)),a.nonce=d||void 0,a.state=o,a.client_info)n.authCodeRequest.clientInfo=a.client_info;else{const p=n.checkCcsCredentials();p&&(n.authCodeRequest.ccsCredential=p)}const u=yield n.authModule.acquireToken(n.authCodeRequest,a);return n.browserStorage.cleanRequestByState(t),u})()}checkCcsCredentials(){const e=this.browserStorage.getTemporaryCache(g._p.CCS_CREDENTIAL,!0);if(e)try{return JSON.parse(e)}catch{this.authModule.logger.error("Cache credential could not be parsed"),this.authModule.logger.errorPii(`Cache credential could not be parsed: ${e}`)}return null}}class hi extends Je{constructor(e,t,n,r,o,a,c,d,u,p){super(e,t,n,r,o,a,c,u,p),this.nativeStorage=d}acquireToken(e){var t=this;return(0,C.A)(function*(){const n=yield k(t.initializeAuthorizationRequest.bind(t),f.MX.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,t.correlationId)(e,g.X8.Redirect);t.browserStorage.updateCacheEntries(n.state,n.nonce,n.authority,n.loginHint||"",n.account||null);const r=t.initializeServerTelemetryManager(g.sA.acquireTokenRedirect),o=a=>{a.persisted&&(t.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),t.browserStorage.cleanRequestByState(n.state),t.eventHandler.emitEvent(U.B.RESTORE_FROM_BFCACHE,g.X8.Redirect))};try{const a=yield k(t.initializeAuthorizationCodeRequest.bind(t),f.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,t.logger,t.performanceClient,t.correlationId)(n),c=yield k(t.createAuthCodeClient.bind(t),f.MX.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:r,requestAuthority:n.authority,requestAzureCloudOptions:n.azureCloudOptions,requestExtraQueryParameters:n.extraQueryParameters,account:n.account}),d=new Wn(c,t.browserStorage,a,t.logger,t.performanceClient),u=yield c.getAuthCodeUrl({...n,nativeBroker:be.isNativeAvailable(t.config,t.logger,t.nativeMessageHandler,e.authenticationScheme)}),p=t.getRedirectStartPage(e.redirectStartPage);return t.logger.verbosePii(`Redirect start page: ${p}`),window.addEventListener("pageshow",o),yield d.initiateAuthRequest(u,{navigationClient:t.navigationClient,redirectTimeout:t.config.system.redirectNavigationTimeout,redirectStartPage:p,onRedirectNavigate:e.onRedirectNavigate||t.config.auth.onRedirectNavigate})}catch(a){throw a instanceof oe.lR&&(a.setCorrelationId(t.correlationId),r.cacheFailedRequest(a)),window.removeEventListener("pageshow",o),t.browserStorage.cleanRequestByState(n.state),a}})()}handleRedirectPromise(){var e=this;return(0,C.A)(function*(t="",n){const r=e.initializeServerTelemetryManager(g.sA.handleRedirectPromise);try{if(!e.browserStorage.isInteractionInProgress(!0))return e.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;const[o,a]=e.getRedirectResponse(t||"");if(!o)return e.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),e.browserStorage.cleanRequestByInteractionType(g.X8.Redirect),"back_forward"!==function ui(){if(typeof window>"u"||typeof window.performance>"u"||"function"!=typeof window.performance.getEntriesByType)return;const s=window.performance.getEntriesByType("navigation");return(s.length?s[0]:void 0)?.type}()?n.event.errorCode="no_server_response":e.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;const c=e.browserStorage.getTemporaryCache(g._p.ORIGIN_URI,!0)||l.YM.EMPTY_STRING;if(V.H.removeHashFromUrl(c)===V.H.removeHashFromUrl(window.location.href)&&e.config.auth.navigateToLoginRequestUrl)return e.logger.verbose("Current page is loginRequestUrl, handling response"),c.indexOf("#")>-1&&(0,ee.nQ)(c),yield e.handleResponse(o,r);if(!e.config.auth.navigateToLoginRequestUrl)return e.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),yield e.handleResponse(o,r);if(!(0,ee.GZ)()||e.config.system.allowRedirectInIframe){e.browserStorage.setTemporaryCache(g._p.URL_HASH,a,!0);const p={apiId:g.sA.handleRedirectPromise,timeout:e.config.system.redirectNavigationTimeout,noHistory:!0};let S=!0;if(c&&"null"!==c)e.logger.verbose(`Navigating to loginRequestUrl: ${c}`),S=yield e.navigationClient.navigateInternal(c,p);else{const w=(0,ee.VX)();e.browserStorage.setTemporaryCache(g._p.ORIGIN_URI,w,!0),e.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),S=yield e.navigationClient.navigateInternal(w,p)}if(!S)return yield e.handleResponse(o,r)}return null}catch(o){throw o instanceof oe.lR&&(o.setCorrelationId(e.correlationId),r.cacheFailedRequest(o)),e.browserStorage.cleanRequestByInteractionType(g.X8.Redirect),o}}).apply(this,arguments)}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(t=this.config.auth.OIDCOptions.serverResponseType===l.zL.QUERY?window.location.search:window.location.hash);let n=Ct.n(t);if(n){try{!function li(s,e,t){if(!s.state)throw(0,O.bD)(b.c$);const n=Nn(e,s.state);if(!n)throw(0,O.bD)(b.fA);if(n.interactionType!==t)throw(0,O.bD)(b.oe)}(n,this.browserCrypto,g.X8.Redirect)}catch(o){return o instanceof oe.lR&&this.logger.error(`Interaction type validation failed due to ${o.errorCode}: ${o.errorMessage}`),[null,""]}return(0,ee.U2)(window),this.logger.verbose("Hash contains known properties, returning response hash"),[n,t]}const r=this.browserStorage.getTemporaryCache(g._p.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(g._p.URL_HASH)),r&&(n=Ct.n(r),n)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[n,r]):[null,""]}handleResponse(e,t){var n=this;return(0,C.A)(function*(){const r=e.state;if(!r)throw(0,O.bD)(b.c$);const o=n.browserStorage.getCachedRequest(r);if(n.logger.verbose("handleResponse called, retrieved cached request"),e.accountId){if(n.logger.verbose("Account id found in hash, calling WAM for token"),!n.nativeMessageHandler)throw(0,O.bD)(b.XC);const u=new et(n.config,n.browserStorage,n.browserCrypto,n.logger,n.eventHandler,n.navigationClient,g.sA.acquireTokenPopup,n.performanceClient,n.nativeMessageHandler,e.accountId,n.nativeStorage,o.correlationId),{userRequestState:p}=Ee.parseRequestState(n.browserCrypto,r);return u.acquireToken({...o,state:p,prompt:void 0}).finally(()=>{n.browserStorage.cleanRequestByState(r)})}const a=n.browserStorage.getCachedAuthority(r);if(!a)throw(0,O.bD)(b.Ne);const c=yield k(n.createAuthCodeClient.bind(n),f.MX.StandardInteractionClientCreateAuthCodeClient,n.logger,n.performanceClient,n.correlationId)({serverTelemetryManager:t,requestAuthority:a});return we.removeThrottle(n.browserStorage,n.config.auth.clientId,o),new Wn(c,n.browserStorage,o,n.logger,n.performanceClient).handleCodeResponse(e,r)})()}logout(e){var t=this;return(0,C.A)(function*(){t.logger.verbose("logoutRedirect called");const n=t.initializeLogoutRequest(e),r=t.initializeServerTelemetryManager(g.sA.logout);try{t.eventHandler.emitEvent(U.B.LOGOUT_START,g.X8.Redirect,e),yield t.clearCacheOnLogout(n.account);const o={apiId:g.sA.logout,timeout:t.config.system.redirectNavigationTimeout,noHistory:!1},c=(yield k(t.createAuthCodeClient.bind(t),f.MX.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0})).getLogoutUri(n);if(t.eventHandler.emitEvent(U.B.LOGOUT_SUCCESS,g.X8.Redirect,n),!e||"function"!=typeof e.onRedirectNavigate)return t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(c,o));if(!1!==e.onRedirectNavigate(c))return t.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),t.browserStorage.getInteractionInProgress()||t.browserStorage.setInteractionInProgress(!0),void(yield t.navigationClient.navigateExternal(c,o));t.browserStorage.setInteractionInProgress(!1),t.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation")}catch(o){throw o instanceof oe.lR&&(o.setCorrelationId(t.correlationId),r.cacheFailedRequest(o)),t.eventHandler.emitEvent(U.B.LOGOUT_FAILURE,g.X8.Redirect,null,o),t.eventHandler.emitEvent(U.B.LOGOUT_END,g.X8.Redirect),o}t.eventHandler.emitEvent(U.B.LOGOUT_END,g.X8.Redirect)})()}getRedirectStartPage(e){const t=e||window.location.href;return V.H.getAbsoluteUrl(t,(0,ee.Uu)())}}function gi(s,e,t,n,r){return Zt.apply(this,arguments)}function Zt(){return(Zt=(0,C.A)(function*(s,e,t,n,r){if(e.addQueueMeasurement(f.MX.SilentHandlerInitiateAuthRequest,n),!s)throw t.info("Navigate url is empty"),(0,O.bD)(b.B2);return r?k(mi,f.MX.SilentHandlerLoadFrame,t,e,n)(s,r,e,n):xe(fi,f.MX.SilentHandlerLoadFrameSync,t,e,n)(s)})).apply(this,arguments)}function pi(s,e,t,n,r,o,a){return en.apply(this,arguments)}function en(){return(en=(0,C.A)(function*(s,e,t,n,r,o,a){return n.addQueueMeasurement(f.MX.SilentHandlerMonitorIframeForHash,o),new Promise((c,d)=>{e<Ot&&r.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${Ot}ms). This may result in timeouts.`);const u=window.setTimeout(()=>{window.clearInterval(p),d((0,O.bD)(b.Uf))},e),p=window.setInterval(()=>{let S="";const w=s.contentWindow;try{S=w?w.location.href:""}catch{}if(!S||"about:blank"===S)return;let D="";w&&(D=a===l.zL.QUERY?w.location.search:w.location.hash),window.clearTimeout(u),window.clearInterval(p),c(D)},t)}).finally(()=>{xe(Ci,f.MX.RemoveHiddenIframe,r,n,o)(s)})})).apply(this,arguments)}function mi(s,e,t,n){return t.addQueueMeasurement(f.MX.SilentHandlerLoadFrame,n),new Promise((r,o)=>{const a=Vn();window.setTimeout(()=>{a?(a.src=s,r(a)):o("Unable to load iframe")},e)})}function fi(s){const e=Vn();return e.src=s,e}function Vn(){const s=document.createElement("iframe");return s.className="msalSilentIframe",s.style.visibility="hidden",s.style.position="absolute",s.style.width=s.style.height="0",s.style.border="0",s.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(s),s}function Ci(s){document.body===s.parentNode&&document.body.removeChild(s)}class Ai extends Je{constructor(e,t,n,r,o,a,c,d,u,p,S){super(e,t,n,r,o,a,d,p,S),this.apiId=c,this.nativeStorage=u}acquireToken(e){var t=this;return(0,C.A)(function*(){t.performanceClient.addQueueMeasurement(f.MX.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&t.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");const n={...e};n.prompt?n.prompt!==l._M.NONE&&n.prompt!==l._M.NO_SESSION&&(t.logger.warning(`SilentIframeClient. Replacing invalid prompt ${n.prompt} with ${l._M.NONE}`),n.prompt=l._M.NONE):n.prompt=l._M.NONE;const r=yield k(t.initializeAuthorizationRequest.bind(t),f.MX.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(n,g.X8.Silent);(0,ee.kZ)(r.authority);const o=t.initializeServerTelemetryManager(t.apiId);let a;try{return a=yield k(t.createAuthCodeClient.bind(t),f.MX.StandardInteractionClientCreateAuthCodeClient,t.logger,t.performanceClient,e.correlationId)({serverTelemetryManager:o,requestAuthority:r.authority,requestAzureCloudOptions:r.azureCloudOptions,requestExtraQueryParameters:r.extraQueryParameters,account:r.account}),yield k(t.silentTokenHelper.bind(t),f.MX.SilentIframeClientTokenHelper,t.logger,t.performanceClient,e.correlationId)(a,r)}catch(c){if(c instanceof oe.lR&&(c.setCorrelationId(t.correlationId),o.cacheFailedRequest(c)),!(a&&c instanceof oe.lR&&c.errorCode===g.Q1.INVALID_GRANT_ERROR))throw c;t.performanceClient.addFields({retryError:c.errorCode},t.correlationId);const d=yield k(t.initializeAuthorizationRequest.bind(t),f.MX.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(n,g.X8.Silent);return yield k(t.silentTokenHelper.bind(t),f.MX.SilentIframeClientTokenHelper,t.logger,t.performanceClient,t.correlationId)(a,d)}})()}logout(){return Promise.reject((0,O.bD)(b.v7))}silentTokenHelper(e,t){var n=this;return(0,C.A)(function*(){const r=t.correlationId;n.performanceClient.addQueueMeasurement(f.MX.SilentIframeClientTokenHelper,r);const o=yield k(n.initializeAuthorizationCodeRequest.bind(n),f.MX.StandardInteractionClientInitializeAuthorizationCodeRequest,n.logger,n.performanceClient,r)(t),a=yield k(e.getAuthCodeUrl.bind(e),f.MX.GetAuthCodeUrl,n.logger,n.performanceClient,r)({...t,nativeBroker:be.isNativeAvailable(n.config,n.logger,n.nativeMessageHandler,t.authenticationScheme)}),c=new Jt(e,n.browserStorage,o,n.logger,n.performanceClient),d=yield k(gi,f.MX.SilentHandlerInitiateAuthRequest,n.logger,n.performanceClient,r)(a,n.performanceClient,n.logger,r,n.config.system.navigateFrameWait),u=n.config.auth.OIDCOptions.serverResponseType,p=yield k(pi,f.MX.SilentHandlerMonitorIframeForHash,n.logger,n.performanceClient,r)(d,n.config.system.iframeHashTimeout,n.config.system.pollIntervalMilliseconds,n.performanceClient,n.logger,r,u),S=xe(jn,f.MX.DeserializeResponse,n.logger,n.performanceClient,n.correlationId)(p,u,n.logger);if(S.accountId){if(n.logger.verbose("Account id found in hash, calling WAM for token"),!n.nativeMessageHandler)throw(0,O.bD)(b.XC);const w=new et(n.config,n.browserStorage,n.browserCrypto,n.logger,n.eventHandler,n.navigationClient,n.apiId,n.performanceClient,n.nativeMessageHandler,S.accountId,n.browserStorage,r),{userRequestState:D}=Ee.parseRequestState(n.browserCrypto,t.state);return k(w.acquireToken.bind(w),f.MX.NativeInteractionClientAcquireToken,n.logger,n.performanceClient,r)({...t,state:D,prompt:t.prompt||l._M.NONE})}return k(c.handleCodeResponse.bind(c),f.MX.HandleCodeResponse,n.logger,n.performanceClient,r)(S,t)})()}}class Ti extends Je{acquireToken(e){var t=this;return(0,C.A)(function*(){t.performanceClient.addQueueMeasurement(f.MX.SilentRefreshClientAcquireToken,e.correlationId);const n=yield k(Xt,f.MX.InitializeBaseRequest,t.logger,t.performanceClient,e.correlationId)(e,t.config,t.performanceClient,t.logger),r={...e,...n};e.redirectUri&&(r.redirectUri=t.getRedirectUri(e.redirectUri));const o=t.initializeServerTelemetryManager(g.sA.acquireTokenSilent_silentFlow),a=yield t.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return k(a.acquireTokenByRefreshToken.bind(a),f.MX.RefreshTokenClientAcquireTokenByRefreshToken,t.logger,t.performanceClient,e.correlationId)(r).catch(c=>{throw c.setCorrelationId(t.correlationId),o.cacheFailedRequest(c),c})})()}logout(){return Promise.reject((0,O.bD)(b.v7))}createRefreshTokenClient(e){var t=this;return(0,C.A)(function*(){const n=yield k(t.getClientConfiguration.bind(t),f.MX.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,t.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new Qt(n,t.performanceClient)})()}}class _i{constructor(e,t,n,r){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=n,this.cryptoObj=r}loadExternalTokens(e,t,n){if(!this.isBrowserEnvironment)throw(0,O.bD)(b.tI);const r=e.correlationId||(0,ie.Oy)(),o=t.id_token?_e(t.id_token,ke):void 0,a={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},c=e.authority?new ge(ge.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,a,this.logger,e.correlationId||(0,ie.Oy)()):void 0,d=this.loadAccount(e,n.clientInfo||t.client_info||"",r,o,c),u=this.loadIdToken(t,d.homeAccountId,d.environment,d.realm,r),p=this.loadAccessToken(e,t,d.homeAccountId,d.environment,d.realm,n,r),S=this.loadRefreshToken(t,d.homeAccountId,d.environment,r);return this.generateAuthenticationResult(e,{account:d,idToken:u,accessToken:p,refreshToken:S},o,c)}loadAccount(e,t,n,r,o){if(this.logger.verbose("TokenCache - loading account"),e.account){const u=ce.createFromAccountInfo(e.account);return this.storage.setAccount(u,n),u}if(!o||!t&&!r)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),(0,O.bD)(b.s9);const a=ce.generateHomeAccountId(t,o.authorityType,this.logger,this.cryptoObj,r),c=r?.tid,d=Yt(this.storage,o,a,ke,n,r,t,o.hostnameAndPort,c,void 0,void 0,this.logger);return this.storage.setAccount(d,n),d}loadIdToken(e,t,n,r,o){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");const a=ct(t,n,e.id_token,this.config.auth.clientId,r);return this.storage.setIdTokenCredential(a,o),a}loadAccessToken(e,t,n,r,o,a,c){if(!t.access_token)return this.logger.verbose("TokenCache - no access token found in response"),null;if(!t.expires_in)return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;if(!(t.scope||e.scopes&&e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null;this.logger.verbose("TokenCache - loading access token");const d=t.scope?re.fromString(t.scope):new re(e.scopes),u=a.expiresOn||t.expires_in+(new Date).getTime()/1e3,p=a.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+(new Date).getTime()/1e3,S=lt(n,r,t.access_token,this.config.auth.clientId,o,d.printScopes(),u,p,ke);return this.storage.setAccessTokenCredential(S,c),S}loadRefreshToken(e,t,n,r){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");const o=an(t,n,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return this.storage.setRefreshTokenCredential(o,r),o}generateAuthenticationResult(e,t,n,r){let d,o="",a=[],c=null;t?.accessToken&&(o=t.accessToken.secret,a=re.fromString(t.accessToken.target).asArray(),c=new Date(1e3*Number(t.accessToken.expiresOn)),d=new Date(1e3*Number(t.accessToken.extendedExpiresOn)));const u=t.account;return{authority:r?r.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:a,account:u.getAccountInfo(),idToken:t.idToken?.secret||"",idTokenClaims:n||{},accessToken:o,fromCache:!0,expiresOn:c,correlationId:e.correlationId||"",requestId:"",extExpiresOn:d,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:u.cloudGraphHostName||"",msGraphHost:u.msGraphHost||"",fromNativeBroker:!1}}}class yi extends Fn{constructor(e){super(e),this.includeRedirectUri=!1}}class Ii extends Je{constructor(e,t,n,r,o,a,c,d,u,p){super(e,t,n,r,o,a,d,u,p),this.apiId=c}acquireToken(e){var t=this;return(0,C.A)(function*(){if(!e.code)throw(0,O.bD)(b.R3);const n=yield k(t.initializeAuthorizationRequest.bind(t),f.MX.StandardInteractionClientInitializeAuthorizationRequest,t.logger,t.performanceClient,e.correlationId)(e,g.X8.Silent),r=t.initializeServerTelemetryManager(t.apiId);try{const o={...n,code:e.code},a=yield k(t.getClientConfiguration.bind(t),f.MX.StandardInteractionClientGetClientConfiguration,t.logger,t.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:n.authority,requestAzureCloudOptions:n.azureCloudOptions,requestExtraQueryParameters:n.extraQueryParameters,account:n.account}),c=new yi(a);t.logger.verbose("Auth code client created");const d=new Jt(c,t.browserStorage,o,t.logger,t.performanceClient);return yield k(d.handleCodeResponseFromServer.bind(d),f.MX.HandleCodeResponseFromServer,t.logger,t.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},n,!1)}catch(o){throw o instanceof oe.lR&&(o.setCorrelationId(t.correlationId),r.cacheFailedRequest(o)),o}})()}logout(){return Promise.reject((0,O.bD)(b.v7))}}function Oe(s){const e=s?.idTokenClaims;return e?.tfp||e?.acr?"B2C":e?.tid?"9188040d-6c67-4c5b-b112-36a304b66dad"===e?.tid?"MSA":"AAD":void 0}function At(s,e){try{(0,ee.Q3)(s)}catch(t){throw e.end({success:!1},t),t}}class Tt{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new Nr(this.logger,this.performanceClient):Ue,this.eventHandler=new ro(this.logger),this.browserStorage=this.isBrowserEnvironment?new Bt(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,function xr(s){const e=s.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw(0,te.aD)(ne.a_)}return{canonicalAuthority:s.authority?wn(s.authority):void 0,knownAuthorities:s.knownAuthorities,cloudDiscoveryMetadata:t}}(this.config.auth),this.performanceClient):((s,e)=>new Bt(this.config.auth.clientId,{cacheLocation:g.Al.MemoryStorage,temporaryCacheLocation:g.Al.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},Ue,this.logger))(),this.nativeInternalStorage=new Bt(this.config.auth.clientId,{cacheLocation:g.Al.MemoryStorage,temporaryCacheLocation:g.Al.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1},this.browserCrypto,this.logger,void 0,this.performanceClient),this.tokenCache=new _i(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this),this.listeningToStorageEvents=!1,this.handleAccountCacheChange=this.handleAccountCacheChange.bind(this)}static createController(e,t){return(0,C.A)(function*(){const n=new Tt(e);return yield n.initialize(t),n})()}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}initialize(e){var t=this;return(0,C.A)(function*(){if(t.logger.trace("initialize called"),t.initialized)return void t.logger.info("initialize has already been called, exiting early.");if(!t.isBrowserEnvironment)return t.logger.info("in non-browser environment, exiting early."),t.initialized=!0,void t.eventHandler.emitEvent(U.B.INITIALIZE_END);const n=e?.correlationId||t.getRequestCorrelationId(),r=t.config.system.allowNativeBroker,o=t.performanceClient.startMeasurement(f.MX.InitializeClientApplication,n);if(t.eventHandler.emitEvent(U.B.INITIALIZE_START),r)try{t.nativeExtensionProvider=yield be.createProvider(t.logger,t.config.system.nativeBrokerHandshakeTimeout,t.performanceClient)}catch(a){t.logger.verbose(a)}t.config.cache.claimsBasedCachingEnabled||(t.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),yield k(t.browserStorage.clearTokensAndKeysWithClaims.bind(t.browserStorage),f.MX.ClearTokensAndKeysWithClaims,t.logger,t.performanceClient,n)(t.performanceClient,n)),t.initialized=!0,t.eventHandler.emitEvent(U.B.INITIALIZE_END),o.end({allowNativeBroker:r,success:!0})})()}handleRedirectPromise(e){var t=this;return(0,C.A)(function*(){if(t.logger.verbose("handleRedirectPromise called"),(0,ee.uh)(t.initialized),t.isBrowserEnvironment){const n=e||"";let r=t.redirectResponse.get(n);return typeof r>"u"?(r=t.handleRedirectPromiseInternal(e),t.redirectResponse.set(n,r),t.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):t.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return t.logger.verbose("handleRedirectPromise returns null, not browser environment"),null})()}handleRedirectPromiseInternal(e){var t=this;return(0,C.A)(function*(){const n=t.getAllAccounts(),r=t.browserStorage.getCachedNativeRequest(),o=r&&be.isNativeAvailable(t.config,t.logger,t.nativeExtensionProvider)&&t.nativeExtensionProvider&&!e,a=o?r?.correlationId:t.browserStorage.getTemporaryCache(g._p.CORRELATION_ID,!0)||"",c=t.performanceClient.startMeasurement(f.MX.AcquireTokenRedirect,a);let d;if(t.eventHandler.emitEvent(U.B.HANDLE_REDIRECT_START,g.X8.Redirect),o&&t.nativeExtensionProvider){t.logger.trace("handleRedirectPromise - acquiring token from native platform");const u=new et(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,g.sA.handleRedirectPromise,t.performanceClient,t.nativeExtensionProvider,r.accountId,t.nativeInternalStorage,r.correlationId);d=k(u.handleRedirectPromise.bind(u),f.MX.HandleNativeRedirectPromiseMeasurement,t.logger,t.performanceClient,c.event.correlationId)(t.performanceClient,c.event.correlationId)}else{t.logger.trace("handleRedirectPromise - acquiring token from web flow");const u=t.createRedirectClient(a);d=k(u.handleRedirectPromise.bind(u),f.MX.HandleRedirectPromiseMeasurement,t.logger,t.performanceClient,c.event.correlationId)(e,c)}return d.then(u=>(u?(n.length<t.getAllAccounts().length?(t.eventHandler.emitEvent(U.B.LOGIN_SUCCESS,g.X8.Redirect,u),t.logger.verbose("handleRedirectResponse returned result, login success")):(t.eventHandler.emitEvent(U.B.ACQUIRE_TOKEN_SUCCESS,g.X8.Redirect,u),t.logger.verbose("handleRedirectResponse returned result, acquire token success")),c.end({success:!0,accountType:Oe(u.account)})):c.event.errorCode?c.end({success:!1}):c.discard(),t.eventHandler.emitEvent(U.B.HANDLE_REDIRECT_END,g.X8.Redirect),u)).catch(u=>{const p=u;throw t.eventHandler.emitEvent(n.length>0?U.B.ACQUIRE_TOKEN_FAILURE:U.B.LOGIN_FAILURE,g.X8.Redirect,null,p),t.eventHandler.emitEvent(U.B.HANDLE_REDIRECT_END,g.X8.Redirect),c.end({success:!1},p),u})})()}acquireTokenRedirect(e){var t=this;return(0,C.A)(function*(){const n=t.getRequestCorrelationId(e);t.logger.verbose("acquireTokenRedirect called",n);const r=t.performanceClient.startMeasurement(f.MX.AcquireTokenPreRedirect,n);r.add({accountType:Oe(e.account),scenarioId:e.scenarioId});const o=e.onRedirectNavigate;if(o)e.onRedirectNavigate=c=>{const d="function"==typeof o?o(c):void 0;return!1!==d?r.end({success:!0}):r.discard(),d};else{const c=t.config.auth.onRedirectNavigate;t.config.auth.onRedirectNavigate=d=>{const u="function"==typeof c?c(d):void 0;return!1!==u?r.end({success:!0}):r.discard(),u}}const a=t.getAllAccounts().length>0;try{let c;return(0,ee.Af)(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),t.eventHandler.emitEvent(a?U.B.ACQUIRE_TOKEN_START:U.B.LOGIN_START,g.X8.Redirect,e),c=t.nativeExtensionProvider&&t.canUseNative(e)?new et(t.config,t.browserStorage,t.browserCrypto,t.logger,t.eventHandler,t.navigationClient,g.sA.acquireTokenRedirect,t.performanceClient,t.nativeExtensionProvider,t.getNativeAccountId(e),t.nativeInternalStorage,n).acquireTokenRedirect(e,r).catch(u=>{if(u instanceof Me&&Ze(u))return t.nativeExtensionProvider=void 0,t.createRedirectClient(n).acquireToken(e);if(u instanceof Ie)return t.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),t.createRedirectClient(n).acquireToken(e);throw t.browserStorage.setInteractionInProgress(!1),u}):t.createRedirectClient(n).acquireToken(e),yield c}catch(c){throw r.end({success:!1},c),t.eventHandler.emitEvent(a?U.B.ACQUIRE_TOKEN_FAILURE:U.B.LOGIN_FAILURE,g.X8.Redirect,null,c),c}})()}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(f.MX.AcquireTokenPopup,t);n.add({scenarioId:e.scenarioId,accountType:Oe(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),At(this.initialized,n),this.browserStorage.setInteractionInProgress(!0)}catch(a){return Promise.reject(a)}const r=this.getAllAccounts();let o;return this.eventHandler.emitEvent(r.length>0?U.B.ACQUIRE_TOKEN_START:U.B.LOGIN_START,g.X8.Popup,e),o=this.canUseNative(e)?this.acquireTokenNative({...e,correlationId:t},g.sA.acquireTokenPopup).then(a=>(this.browserStorage.setInteractionInProgress(!1),n.end({success:!0,isNativeBroker:!0,accountType:Oe(a.account)}),a)).catch(a=>{if(a instanceof Me&&Ze(a))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e);if(a instanceof Ie)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e);throw this.browserStorage.setInteractionInProgress(!1),a}):this.createPopupClient(t).acquireToken(e),o.then(a=>(r.length<this.getAllAccounts().length?this.eventHandler.emitEvent(U.B.LOGIN_SUCCESS,g.X8.Popup,a):this.eventHandler.emitEvent(U.B.ACQUIRE_TOKEN_SUCCESS,g.X8.Popup,a),n.end({success:!0,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:Oe(a.account)}),a)).catch(a=>(this.eventHandler.emitEvent(r.length>0?U.B.ACQUIRE_TOKEN_FAILURE:U.B.LOGIN_FAILURE,g.X8.Popup,null,a),n.end({success:!1},a),Promise.reject(a)))}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}ssoSilent(e){var t=this;return(0,C.A)(function*(){const n=t.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:n};let o;return t.ssoSilentMeasurement=t.performanceClient.startMeasurement(f.MX.SsoSilent,n),t.ssoSilentMeasurement?.add({scenarioId:e.scenarioId,accountType:Oe(e.account)}),At(t.initialized,t.ssoSilentMeasurement),t.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement),t.logger.verbose("ssoSilent called",n),t.eventHandler.emitEvent(U.B.SSO_SILENT_START,g.X8.Silent,r),o=t.canUseNative(r)?t.acquireTokenNative(r,g.sA.ssoSilent).catch(a=>{if(a instanceof Me&&Ze(a))return t.nativeExtensionProvider=void 0,t.createSilentIframeClient(r.correlationId).acquireToken(r);throw a}):t.createSilentIframeClient(r.correlationId).acquireToken(r),o.then(a=>(t.eventHandler.emitEvent(U.B.SSO_SILENT_SUCCESS,g.X8.Silent,a),t.ssoSilentMeasurement?.end({success:!0,isNativeBroker:a.fromNativeBroker,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:Oe(a.account)}),a)).catch(a=>{throw t.eventHandler.emitEvent(U.B.SSO_SILENT_FAILURE,g.X8.Silent,null,a),t.ssoSilentMeasurement?.end({success:!1},a),a}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenByCode(e){var t=this;return(0,C.A)(function*(){const n=t.getRequestCorrelationId(e);t.logger.trace("acquireTokenByCode called",n);const r=t.performanceClient.startMeasurement(f.MX.AcquireTokenByCode,n);At(t.initialized,r),t.eventHandler.emitEvent(U.B.ACQUIRE_TOKEN_BY_CODE_START,g.X8.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw(0,O.bD)(b.$c);if(e.code){const o=e.code;let a=t.hybridAuthCodeResponses.get(o);return a?(t.logger.verbose("Existing acquireTokenByCode request found",n),r.discard()):(t.logger.verbose("Initiating new acquireTokenByCode request",n),a=t.acquireTokenByCodeAsync({...e,correlationId:n}).then(c=>(t.eventHandler.emitEvent(U.B.ACQUIRE_TOKEN_BY_CODE_SUCCESS,g.X8.Silent,c),t.hybridAuthCodeResponses.delete(o),r.end({success:!0,isNativeBroker:c.fromNativeBroker,accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length,accountType:Oe(c.account)}),c)).catch(c=>{throw t.hybridAuthCodeResponses.delete(o),t.eventHandler.emitEvent(U.B.ACQUIRE_TOKEN_BY_CODE_FAILURE,g.X8.Silent,null,c),r.end({success:!1},c),c}),t.hybridAuthCodeResponses.set(o,a)),yield a}if(e.nativeAccountId){if(t.canUseNative(e,e.nativeAccountId)){const o=yield t.acquireTokenNative({...e,correlationId:n},g.sA.acquireTokenByCode,e.nativeAccountId).catch(a=>{throw a instanceof Me&&Ze(a)&&(t.nativeExtensionProvider=void 0),a});return r.end({accountType:Oe(o.account),success:!0}),o}throw(0,O.bD)(b.gU)}throw(0,O.bD)(b.xp)}catch(o){throw t.eventHandler.emitEvent(U.B.ACQUIRE_TOKEN_BY_CODE_FAILURE,g.X8.Silent,null,o),r.end({success:!1},o),o}})()}acquireTokenByCodeAsync(e){var t=this;return(0,C.A)(function*(){return t.logger.trace("acquireTokenByCodeAsync called",e.correlationId),t.acquireTokenByCodeAsyncMeasurement=t.performanceClient.startMeasurement(f.MX.AcquireTokenByCodeAsync,e.correlationId),t.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement),yield t.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(o=>(t.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromNativeBroker}),o)).catch(o=>{throw t.acquireTokenByCodeAsyncMeasurement?.end({success:!1},o),o}).finally(()=>{document.removeEventListener("visibilitychange",t.trackPageVisibilityWithMeasurement)})})()}acquireTokenFromCache(e,t){var n=this;return(0,C.A)(function*(){switch(n.performanceClient.addQueueMeasurement(f.MX.AcquireTokenFromCache,e.correlationId),t){case g.nN.Default:case g.nN.AccessToken:case g.nN.AccessTokenAndRefreshToken:const r=n.createSilentCacheClient(e.correlationId);return k(r.acquireToken.bind(r),f.MX.SilentCacheClientAcquireToken,n.logger,n.performanceClient,e.correlationId)(e);default:throw(0,v.SB)(E.wb)}})()}acquireTokenByRefreshToken(e,t){var n=this;return(0,C.A)(function*(){switch(n.performanceClient.addQueueMeasurement(f.MX.AcquireTokenByRefreshToken,e.correlationId),t){case g.nN.Default:case g.nN.AccessTokenAndRefreshToken:case g.nN.RefreshToken:case g.nN.RefreshTokenAndNetwork:const r=n.createSilentRefreshClient(e.correlationId);return k(r.acquireToken.bind(r),f.MX.SilentRefreshClientAcquireToken,n.logger,n.performanceClient,e.correlationId)(e);default:throw(0,v.SB)(E.wb)}})()}acquireTokenBySilentIframe(e){var t=this;return(0,C.A)(function*(){t.performanceClient.addQueueMeasurement(f.MX.AcquireTokenBySilentIframe,e.correlationId);const n=t.createSilentIframeClient(e.correlationId);return k(n.acquireToken.bind(n),f.MX.SilentIframeClientAcquireToken,t.logger,t.performanceClient,e.correlationId)(e)})()}logout(e){var t=this;return(0,C.A)(function*(){const n=t.getRequestCorrelationId(e);return t.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",n),t.logoutRedirect({correlationId:n,...e})})()}logoutRedirect(e){var t=this;return(0,C.A)(function*(){const n=t.getRequestCorrelationId(e);return(0,ee.Af)(t.initialized,t.config),t.browserStorage.setInteractionInProgress(!0),t.createRedirectClient(n).logout(e)})()}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return(0,ee.Q3)(this.initialized),this.browserStorage.setInteractionInProgress(!0),this.createPopupClient(t).logout(e)}catch(t){return Promise.reject(t)}}clearCache(e){var t=this;return(0,C.A)(function*(){if(!t.isBrowserEnvironment)return void t.logger.info("in non-browser environment, returning early.");const n=t.getRequestCorrelationId(e);return t.createSilentCacheClient(n).logout(e)})()}getAllAccounts(e){const t=this.getRequestCorrelationId();return function Vr(s,e,t,n,r){return s.verbose("getAllAccounts called"),t?e.getAllAccounts(n,r):[]}(this.logger,this.browserStorage,this.isBrowserEnvironment,t,e)}getAccount(e){const t=this.getRequestCorrelationId();return function Qr(s,e,t,n){if(e.trace("getAccount called"),0===Object.keys(s).length)return e.warning("getAccount: No accountFilter provided"),null;const r=t.getAccountInfoFilteredBy(s,n);return r?(e.verbose("getAccount: Account matching provided filter found, returning"),r):(e.verbose("getAccount: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByUsername(e){const t=this.getRequestCorrelationId();return function Jr(s,e,t,n){if(e.trace("getAccountByUsername called"),!s)return e.warning("getAccountByUsername: No username provided"),null;const r=t.getAccountInfoFilteredBy({username:s},n);return r?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${s}`),r):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByHomeId(e){const t=this.getRequestCorrelationId();return function Zr(s,e,t,n){if(e.trace("getAccountByHomeId called"),!s)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;const r=t.getAccountInfoFilteredBy({homeAccountId:s},n);return r?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${s}`),r):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}getAccountByLocalId(e){const t=this.getRequestCorrelationId();return function eo(s,e,t,n){if(e.trace("getAccountByLocalId called"),!s)return e.warning("getAccountByLocalId: No localAccountId provided"),null;const r=t.getAccountInfoFilteredBy({localAccountId:s},n);return r?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${s}`),r):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}(e,this.logger,this.browserStorage,t)}setActiveAccount(e){const t=this.getRequestCorrelationId();!function to(s,e,t){e.setActiveAccount(s,t)}(e,this.browserStorage,t)}getActiveAccount(){const e=this.getRequestCorrelationId();return function no(s,e){return s.getActiveAccount(e)}(this.browserStorage,e)}hydrateCache(e,t){var n=this;return(0,C.A)(function*(){n.logger.verbose("hydrateCache called");const r=ce.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return n.browserStorage.setAccount(r,e.correlationId),e.fromNativeBroker?(n.logger.verbose("Response was from native broker, storing in-memory"),n.nativeInternalStorage.hydrateCache(e,t)):n.browserStorage.hydrateCache(e,t)})()}acquireTokenNative(e,t,n){var r=this;return(0,C.A)(function*(){if(r.logger.trace("acquireTokenNative called"),!r.nativeExtensionProvider)throw(0,O.bD)(b.XC);return new et(r.config,r.browserStorage,r.browserCrypto,r.logger,r.eventHandler,r.navigationClient,t,r.performanceClient,r.nativeExtensionProvider,n||r.getNativeAccountId(e),r.nativeInternalStorage,e.correlationId).acquireToken(e)})()}canUseNative(e,t){if(this.logger.trace("canUseNative called"),!be.isNativeAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUseNative: isNativeAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case l._M.NONE:case l._M.CONSENT:case l._M.LOGIN:this.logger.trace("canUseNative: prompt is compatible with native flow");break;default:return this.logger.trace(`canUseNative: prompt = ${e.prompt} is not compatible with native flow, returning false`),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("canUseNative: nativeAccountId is not available, returning false"),1))}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new di(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new hi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new Ai(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,g.sA.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new Xn(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new Ti(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new Ii(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,g.sA.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return(0,ee.EZ)(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?this.logger.verbose("Account storage listener already registered."):(this.logger.verbose("Adding account storage listener."),this.listeningToStorageEvents=!0,window.addEventListener("storage",this.handleAccountCacheChange)))}disableAccountStorageEvents(){typeof window>"u"||(this.listeningToStorageEvents?(this.logger.verbose("Removing account storage listener."),window.removeEventListener("storage",this.handleAccountCacheChange),this.listeningToStorageEvents=!1):this.logger.verbose("No account storage listener registered."))}handleAccountCacheChange(e){try{e.key?.includes(l.Gd.ACTIVE_ACCOUNT_FILTERS)&&this.eventHandler.emitEvent(U.B.ACTIVE_ACCOUNT_CHANGED);const t=e.newValue||e.oldValue;if(!t)return;const n=JSON.parse(t);if("object"!=typeof n||!ce.isAccountEntity(n))return;const o=qe.toObject(new ce,n).getAccountInfo();!e.oldValue&&e.newValue?(this.logger.info("Account was added to cache in a different window"),this.eventHandler.emitEvent(U.B.ACCOUNT_ADDED,void 0,o)):!e.newValue&&e.oldValue&&(this.logger.info("Account was removed from cache in a different window"),this.eventHandler.emitEvent(U.B.ACCOUNT_REMOVED,void 0,o))}catch{return}}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?(0,ie.Oy)():l.YM.EMPTY_STRING}loginRedirect(e){var t=this;return(0,C.A)(function*(){const n=t.getRequestCorrelationId(e);return t.logger.verbose("loginRedirect called",n),t.acquireTokenRedirect({correlationId:n,...e||g.uq})})()}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup({correlationId:t,...e||g.uq})}acquireTokenSilent(e){var t=this;return(0,C.A)(function*(){const n=t.getRequestCorrelationId(e),r=t.performanceClient.startMeasurement(f.MX.AcquireTokenSilent,n);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),At(t.initialized,r),t.logger.verbose("acquireTokenSilent called",n);const o=e.account||t.getActiveAccount();if(!o)throw(0,O.bD)(b.rR);r.add({accountType:Oe(o)});const c=JSON.stringify({clientId:t.config.auth.clientId,authority:e.authority||l.YM.EMPTY_STRING,scopes:e.scopes,homeAccountIdentifier:o.homeAccountId,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,shrOptions:e.shrOptions}),d=t.activeSilentTokenRequests.get(c);if(typeof d>"u"){t.logger.verbose("acquireTokenSilent called for the first time, storing active request",n);const u=k(t.acquireTokenSilentAsync.bind(t),f.MX.AcquireTokenSilentAsync,t.logger,t.performanceClient,n)({...e,correlationId:n},o).then(p=>(t.activeSilentTokenRequests.delete(c),r.end({success:!0,fromCache:p.fromCache,isNativeBroker:p.fromNativeBroker,cacheLookupPolicy:e.cacheLookupPolicy,accessTokenSize:p.accessToken.length,idTokenSize:p.idToken.length}),p)).catch(p=>{throw t.activeSilentTokenRequests.delete(c),r.end({success:!1},p),p});return t.activeSilentTokenRequests.set(c,u),{...yield u,state:e.state}}return t.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",n),r.discard(),{...yield d,state:e.state}})()}acquireTokenSilentAsync(e,t){var n=this;return(0,C.A)(function*(){const r=()=>n.trackPageVisibility(e.correlationId);n.performanceClient.addQueueMeasurement(f.MX.AcquireTokenSilentAsync,e.correlationId),n.eventHandler.emitEvent(U.B.ACQUIRE_TOKEN_START,g.X8.Silent,e),e.correlationId&&n.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const o=yield k(Qo,f.MX.InitializeSilentRequest,n.logger,n.performanceClient,e.correlationId)(e,t,n.config,n.performanceClient,n.logger),a=e.cacheLookupPolicy||g.nN.Default;return n.acquireTokenSilentNoIframe(o,a).catch(function(){var d=(0,C.A)(function*(u){if(function Ei(s,e){const r=!(s instanceof Ie&&s.subError!==We)&&(s.errorCode===g.Q1.INVALID_GRANT_ERROR||s.errorCode===E.wb)||s.errorCode===je||s.errorCode===Lt,o=g.JE.includes(e);return r&&o}(u,a)){if(n.activeIframeRequest){if(a!==g.nN.Skip){const[S,w]=n.activeIframeRequest;n.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${w}`,o.correlationId);const D=n.performanceClient.startMeasurement(f.MX.AwaitConcurrentIframe,o.correlationId);D.add({awaitIframeCorrelationId:w});const Y=yield S;if(D.end({success:Y}),Y)return n.logger.verbose(`Parallel iframe request with correlationId: ${w} succeeded. Retrying cache and/or RT redemption`,o.correlationId),n.acquireTokenSilentNoIframe(o,a);throw n.logger.info(`Iframe request with correlationId: ${w} failed. Interaction is required.`),u}return n.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",o.correlationId),k(n.acquireTokenBySilentIframe.bind(n),f.MX.AcquireTokenBySilentIframe,n.logger,n.performanceClient,o.correlationId)(o)}{let S;return n.activeIframeRequest=[new Promise(w=>{S=w}),o.correlationId],n.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",o.correlationId),k(n.acquireTokenBySilentIframe.bind(n),f.MX.AcquireTokenBySilentIframe,n.logger,n.performanceClient,o.correlationId)(o).then(w=>(S(!0),w)).catch(w=>{throw S(!1),w}).finally(()=>{n.activeIframeRequest=void 0})}}throw u});return function(u){return d.apply(this,arguments)}}()).then(d=>(n.eventHandler.emitEvent(U.B.ACQUIRE_TOKEN_SUCCESS,g.X8.Silent,d),e.correlationId&&n.performanceClient.addFields({fromCache:d.fromCache,isNativeBroker:d.fromNativeBroker},e.correlationId),d)).catch(d=>{throw n.eventHandler.emitEvent(U.B.ACQUIRE_TOKEN_FAILURE,g.X8.Silent,null,d),d}).finally(()=>{document.removeEventListener("visibilitychange",r)})})()}acquireTokenSilentNoIframe(e,t){var n=this;return(0,C.A)(function*(){return be.isNativeAvailable(n.config,n.logger,n.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(n.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),n.acquireTokenNative(e,g.sA.acquireTokenSilent_silentFlow).catch(function(){var r=(0,C.A)(function*(o){throw o instanceof Me&&Ze(o)?(n.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),n.nativeExtensionProvider=void 0,(0,v.SB)(E.wb)):o});return function(o){return r.apply(this,arguments)}}())):(n.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),k(n.acquireTokenFromCache.bind(n),f.MX.AcquireTokenFromCache,n.logger,n.performanceClient,e.correlationId)(e,t).catch(r=>{if(t===g.nN.AccessToken)throw r;return n.eventHandler.emitEvent(U.B.ACQUIRE_TOKEN_NETWORK_START,g.X8.Silent,e),k(n.acquireTokenByRefreshToken.bind(n),f.MX.AcquireTokenByRefreshToken,n.logger,n.performanceClient,e.correlationId)(e,t)}))})()}}function tn(){return(tn=(0,C.A)(function*(s,e){const t=new En(s);return yield t.initialize(),Tt.createController(t,e)})).apply(this,arguments)}class it{static createPublicClientApplication(e){return(0,C.A)(function*(){const t=yield function vi(s,e){return tn.apply(this,arguments)}(e);return new it(e,t)})()}constructor(e,t){this.controller=t||new Tt(new En(e))}initialize(e){var t=this;return(0,C.A)(function*(){return t.controller.initialize(e)})()}acquireTokenPopup(e){var t=this;return(0,C.A)(function*(){return t.controller.acquireTokenPopup(e)})()}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}hydrateCache(e,t){var n=this;return(0,C.A)(function*(){return n.controller.hydrateCache(e,t)})()}clearCache(e){return this.controller.clearCache(e)}}const wi="dev"!==j.c.env.entorn?[{provide:B.MSAL_INSTANCE,useFactory:function Ri(){return new it(j.c.oidc)}},{provide:B.MSAL_GUARD_CONFIG,useFactory:function ki(){return{interactionType:g.X8.Redirect,authRequest:{scopes:["openid","profile"].concat(j.c.scopes.map(s=>`${j.c.env.LMD_AUTH_SCOPE_URL}/${s}`))}}}},B.MsalService,B.MsalGuard,B.MsalBroadcastService]:[];let Mi=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:s,bootstrap:[X.NgGencatProgressSpinnerComponent,q,Ae,z]})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[{provide:X.NgGencatLangSelectorService,useClass:pe},...wi],imports:[m.BrowserModule,Pe,X.NgGencatModule,Se.HttpClientModule,_.TranslateModule.forRoot({defaultLanguage:"ca_ES",loader:{deps:[Se.HttpClient,i.PLATFORM_ID],provide:_.TranslateLoader,useFactory:(t,n)=>(0,h.isPlatformBrowser)(n)?new Te.TranslateHttpLoader(t,`${(0,h.isPlatformBrowser)(n)?j.c.env.HOST_URL:""}/assets/i18n/`,".json"):new K},isolate:!0})]})}}return s})();m.platformBrowser().bootstrapModule(Mi).catch(s=>console.error(s))},8049:($,N,A)=>{A.d(N,{P:()=>y});var m=A(9015),h=A(1267);let y=(()=>{class _{constructor(){this.headerSubject=new m.BehaviorSubject(null)}get headerTitleChanges(){return this.headerSubject.asObservable()}changeTitle(I){this.headerSubject.next(I)}static{this.\u0275fac=function(R){return new(R||_)}}static{this.\u0275prov=h.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},7823:($,N,A)=>{A.d(N,{d:()=>W});var m=A(467),i=A(1781),T=A(1267),_=A(9015),I=A(6499),P=A(3212),L=A(5312),q=A(2490);let W=(()=>{class H{constructor(){this.platformId=(0,T.inject)(T.PLATFORM_ID),this.cookieService=(0,T.inject)(q.O),this.http=(0,T.inject)(I.HttpClient),this.userChanges=new _.BehaviorSubject(null),this.logout$=new T.EventEmitter}get headerChanges(){return(0,i.isPlatformBrowser)(this.platformId)?(0,_.fromEvent)(document,"APC_HEADER_INFO").pipe((0,_.map)(z=>({title:z.detail?.data.title,description:z.detail?.data.description,iconUrl:z.detail?.data.iconUrl,subTitle:z.detail?.data.subTitle}))):new _.Observable}get breadcrumbChanges(){return(0,i.isPlatformBrowser)(this.platformId)?(0,_.fromEvent)(document,"APC_HEADER_BREADCRUMB").pipe((0,_.map)(z=>z.detail?.data)):new _.Observable}get showSpinnerChanged(){return(0,i.isPlatformBrowser)(this.platformId)?(0,_.fromEvent)(document,"APC_SHOW_SPINNER").pipe((0,_.map)(z=>z.detail?.data.show)):new _.Observable}logoutValid(z,X){var j=this;return(0,m.A)(function*(){if((0,i.isPlatformBrowser)(j.platformId)){yield z.instance.initialize(),z.instance.setActiveAccount(z?.instance?.getAllAccounts()[0]);let Q=z?.instance?.getAllAccounts()[0]?.idTokenClaims?.idp_access_token;X.msalSubject$.pipe((0,_.filter)(se=>se.eventType===P.B.LOGOUT_SUCCESS)).subscribe(()=>{Q?(j.cookieService.delete(L.c.env.ONBOARDING_COOKIE),console.log("Logout valid"),(0,_.lastValueFrom)(j.http.post(L.c.env.VALID_URL_LOGOUT+Q,null)).then()):console.log("no idp")}),yield z.instance.logoutRedirect()}})()}static{this.\u0275fac=function(X){return new(X||H)}}static{this.\u0275prov=T.\u0275\u0275defineInjectable({token:H,factory:H.\u0275fac,providedIn:"root"})}}return H})()},5312:($,N,A)=>{A.d(N,{c:()=>T});var m=A(7554),i=A(8173);const h=()=>{const y=typeof window<"u"?window:{env:{}};return{LMD_URL:y.env.LMD_URL,entorn:y.env.entorn,EMD_URL:y.env.EMD_URL,MOPINION_DEPLOY_KEY:y.env.MOPINION_DEPLOY_KEY,HOST_URL:y.env.HOST_URL,HOST_AUTH_CLIENT_ID:y.env.HOST_AUTH_CLIENT_ID,HOST_AUTH_AUTHORITY:y.env.HOST_AUTH_AUTHORITY,HOST_AUTH_KNOWN_AUTHORITIES:y.env.HOST_AUTH_KNOWN_AUTHORITIES,HOST_AUTH_SCOPE_URL:y.env.HOST_AUTH_SCOPE_URL,EMD_AUTH_SCOPE_URL:y.env.EMD_AUTH_SCOPE_URL,LMD_AUTH_SCOPE_URL:y.env.LMD_AUTH_SCOPE_URL,GTAG_ID:y.env.GTAG_ID,VALID_URL_LOGOUT:y.env.VALID_URL_LOGOUT||"",CONTACTE_URL:y.env.CONTACTE_URL||"",COMPANY_CHANNEL_URL:y.env.COMPANY_CHANNEL_URL||"",ONBOARDING_COOKIE:y.env.ONBOARDING_COOKIE||"",ONBOARDING_URL:y.env.ONBOARDING_URL||"",ONBOARDING_ACTIVATED:y.env.ONBOARDING_ACTIVATED||"",COOKIE_DOMAIN:y.env.COOKIE_DOMAIN||void 0,APIM_URL:y.env.APIM_URL||"",TERMS_CLIENT_ID:y.env.TERMS_CLIENT_ID||"",TERMS_CLIENT_SECRET:y.env.TERMS_CLIENT_SECRET||""}},T={production:!0,env:h(),oidc:{auth:{clientId:h().HOST_AUTH_CLIENT_ID,authority:`${h().HOST_AUTH_AUTHORITY}/B2C_1A_SIGNUP_SIGNIN`,redirectUri:`${h().HOST_URL}/login`,postLogoutRedirectUri:`${h().HOST_URL}`,knownAuthorities:[h().HOST_AUTH_KNOWN_AUTHORITIES]},cache:{cacheLocation:m.Al.LocalStorage},system:{allowNativeBroker:!1,loggerOptions:{loggerCallback:(y,_)=>{console.log(_)},logLevel:i.$.Error,piiLoggingEnabled:!1}}},scopes:["records:write","default"],scopesEmd:["default","doc_types:read","documents:delete","documents:write","documents:read"]}},1510:($,N,A)=>{A.d(N,{Oy:()=>se,RI:()=>B,RW:()=>ae,TZ:()=>pe,UY:()=>j,W6:()=>Pe,YZ:()=>Se,_S:()=>Ne,sI:()=>z});var m=A(467),i=A(6810),h=A(4561),T=A(7554),y=A(6195),_=A(6588);const I="SHA-256",P=new Uint8Array([1,0,1]),L="0123456789abcdef",q=new Uint32Array(1),W="crypto_subtle_undefined",H={name:"RSASSA-PKCS1-v1_5",hash:I,modulusLength:2048,publicExponent:P};function ae(x){if(!window)throw(0,i.bD)(_.tI);if(!window.crypto)throw(0,i.bD)(_.rc);if(!x&&!window.crypto.subtle)throw(0,i.bD)(_.rc,W)}function z(x,J,K){return X.apply(this,arguments)}function X(){return(X=(0,m.A)(function*(x,J,K){J?.addQueueMeasurement(h.MX.Sha256Digest,K);const Z=(new TextEncoder).encode(x);return window.crypto.subtle.digest(I,Z)})).apply(this,arguments)}function j(x){return window.crypto.getRandomValues(x)}function Q(){return window.crypto.getRandomValues(q),q[0]}function se(){const x=Date.now(),J=1024*Q()+(1023&Q()),K=new Uint8Array(16),Re=Math.trunc(J/2**30),Z=J&2**30-1,l=Q();K[0]=x/2**40,K[1]=x/2**32,K[2]=x/2**24,K[3]=x/65536,K[4]=x/256,K[5]=x,K[6]=112|Re>>>8,K[7]=Re,K[8]=128|Z>>>24,K[9]=Z>>>16,K[10]=Z>>>8,K[11]=Z,K[12]=l>>>24,K[13]=l>>>16,K[14]=l>>>8,K[15]=l;let de="";for(let he=0;he<K.length;he++)de+=L.charAt(K[he]>>>4),de+=L.charAt(15&K[he]),(3===he||5===he||7===he||9===he)&&(de+="-");return de}function pe(x,J){return le.apply(this,arguments)}function le(){return(le=(0,m.A)(function*(x,J){return window.crypto.subtle.generateKey(H,x,J)})).apply(this,arguments)}function B(x){return G.apply(this,arguments)}function G(){return(G=(0,m.A)(function*(x){return window.crypto.subtle.exportKey(T.jb,x)})).apply(this,arguments)}function Pe(x,J,K){return C.apply(this,arguments)}function C(){return(C=(0,m.A)(function*(x,J,K){return window.crypto.subtle.importKey(T.jb,x,H,J,K)})).apply(this,arguments)}function Ne(x,J){return Ae.apply(this,arguments)}function Ae(){return(Ae=(0,m.A)(function*(x,J){return window.crypto.subtle.sign(H,x,J)})).apply(this,arguments)}function Se(x){return Te.apply(this,arguments)}function Te(){return(Te=(0,m.A)(function*(x){const J=yield z(x),K=new Uint8Array(J);return(0,y.dB)(K)})).apply(this,arguments)}},6195:($,N,A)=>{function m(y){return encodeURIComponent(h(y).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function i(y){return T(y).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function h(y){return T((new TextEncoder).encode(y))}function T(y){const _=Array.from(y,M=>String.fromCodePoint(M)).join("");return btoa(_)}A.d(N,{KA:()=>h,dB:()=>i,u4:()=>m})},6810:($,N,A)=>{A.d(N,{bD:()=>M,jT:()=>_});var m=A(3461),i=A(6588);const h="For more visit: aka.ms/msaljs/browser-errors",T={[i.p5]:"The PKCE code challenge and verifier could not be generated.",[i.rc]:"The crypto object or function is not available.",[i.B2]:"Navigation URI is empty. Please check stack trace for more info.",[i.wv]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${h}`,[i.c$]:"Hash does not contain state. Please verify that the request originated from msal.",[i.Lm]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${h}`,[i.fA]:"Unable to parse state. Please verify that the request originated from msal.",[i.oe]:"Hash contains state but the interaction type does not match the caller.",[i.b]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${h}`,[i.hs]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[i.MP]:"window.open returned null or undefined window object.",[i.fN]:"User cancelled the flow.",[i.OM]:`Token acquisition in popup failed due to timeout.  ${h}`,[i.Uf]:`Token acquisition in iframe failed due to timeout.  ${h}`,[i.OT]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[i.tZ]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${h}`,[i.aH]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[i.lg]:"The iframe being monitored was closed prematurely.",[i.v7]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[i.rR]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[i.hZ]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[i.y6]:"No token request found in cache.",[i.ot]:"The cached token request could not be parsed.",[i.Ne]:"No cached authority found.",[i.LW]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[i.Mm]:"Invalid cache type",[i.tI]:"Login and token requests are not supported in non-browser environments.",[i.rn]:"Database is not open!",[i.l7]:"No network connectivity. Check your internet connection.",[i.zv]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[i.Zw]:"Network request failed. Please check the network trace to determine root cause.",[i.db]:"Failed to parse network response. Check network trace.",[i.s9]:"Error loading token to cache.",[i.e0]:"Cryptographic Key or Keypair not found in browser storage.",[i.R3]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[i.xp]:"An authorization code or nativeAccountId must be provided to this flow.",[i.$c]:"Request cannot contain both spa code and native account id.",[i.MG]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[i.gU]:`Unable to acquire token from native platform.  ${h}`,[i.y3]:"Timed out while attempting to establish connection to browser extension",[i.cq]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[i.XC]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${h}`,[i.IR]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${h}`,[i.nF]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[i._t]:"Invalid base64 encoded string.",[i.bT]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[i.Tw]:"Failed to build request headers object.",[i.wI]:"Failed to parse response headers"};class _ extends m.lR{constructor(R,P){super(R,T[R],P),Object.setPrototypeOf(this,_.prototype),this.name="BrowserAuthError"}}function M(I,R){return new _(I,R)}},6588:($,N,A)=>{A.d(N,{$c:()=>de,B2:()=>h,IR:()=>Be,LW:()=>Pe,Lm:()=>_,MG:()=>he,MP:()=>L,Mm:()=>C,Ne:()=>G,OM:()=>W,OT:()=>ae,R3:()=>Z,Tw:()=>Ce,Uf:()=>H,XC:()=>Ge,Zw:()=>x,_t:()=>yt,aH:()=>X,b:()=>R,bT:()=>st,c$:()=>y,cq:()=>Ue,db:()=>J,e0:()=>Re,fA:()=>M,fN:()=>q,gU:()=>v,hZ:()=>pe,hs:()=>P,l7:()=>Se,lg:()=>j,nF:()=>_e,oe:()=>I,ot:()=>B,p5:()=>m,rR:()=>se,rc:()=>i,rn:()=>Ae,s9:()=>K,tI:()=>Ne,tZ:()=>z,v7:()=>Q,wI:()=>nt,wv:()=>T,xp:()=>l,y3:()=>E,y6:()=>le,zv:()=>Te});const m="pkce_not_created",i="crypto_nonexistent",h="empty_navigate_uri",T="hash_empty_error",y="no_state_in_hash",_="hash_does_not_contain_known_properties",M="unable_to_parse_state",I="state_interaction_type_mismatch",R="interaction_in_progress",P="popup_window_error",L="empty_window_error",q="user_cancelled",W="monitor_popup_timeout",H="monitor_window_timeout",ae="redirect_in_iframe",z="block_iframe_reload",X="block_nested_popups",j="iframe_closed_prematurely",Q="silent_logout_unsupported",se="no_account_error",pe="silent_prompt_value_error",le="no_token_request_cache_error",B="unable_to_parse_token_request_cache_error",G="no_cached_authority_error",Pe="auth_request_not_set_error",C="invalid_cache_type",Ne="non_browser_environment",Ae="database_not_open",Se="no_network_connectivity",Te="post_request_failed",x="get_request_failed",J="failed_to_parse_response",K="unable_to_load_token",Re="crypto_key_not_found",Z="auth_code_required",l="auth_code_or_nativeAccountId_required",de="spa_code_and_nativeAccountId_present",he="database_unavailable",v="unable_to_acquire_token_from_native_platform",E="native_handshake_timeout",Ue="native_extension_not_installed",Ge="native_connection_not_established",Be="uninitialized_public_client_application",_e="native_prompt_not_supported",yt="invalid_base64_string",st="invalid_pop_token_request",Ce="failed_to_build_headers",nt="failed_to_parse_headers"},4064:($,N,A)=>{A.d(N,{XX:()=>y,jz:()=>_});var m=A(3461),i=A(3578);const h={[i.xz]:"Given storage configuration option was not supported.",[i.dg]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[i.jE]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."};class y extends m.lR{constructor(I,R){super(I,R),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,y.prototype)}}function _(M){return new y(M,h[M])}},3578:($,N,A)=>{A.d(N,{dg:()=>i,jE:()=>h,xz:()=>m});const m="storage_not_supported",i="stubbed_public_client_application_called",h="in_mem_redirect_unavailable"},3212:($,N,A)=>{A.d(N,{B:()=>m});const m={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"}},9511:($,N,A)=>{A.d(N,{c:()=>m});class m{navigateInternal(h,T){return m.defaultNavigateWindow(h,T)}navigateExternal(h,T){return m.defaultNavigateWindow(h,T)}static defaultNavigateWindow(h,T){return T.noHistory?window.location.replace(h):window.location.assign(h),new Promise(y=>{setTimeout(()=>{y(!0)},T.timeout)})}}},7554:($,N,A)=>{A.d(N,{$u:()=>z,Al:()=>y,CC:()=>_,Ct:()=>T,G8:()=>X,H3:()=>R,JD:()=>h,JE:()=>se,L$:()=>pe,P3:()=>le,Q1:()=>i,T$:()=>q,WJ:()=>j,X8:()=>L,_p:()=>M,dh:()=>I,f7:()=>ae,jb:()=>H,nN:()=>Q,sA:()=>P,uq:()=>W});var m=A(7635);const i={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},h={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},T={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},y={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},_={GET:"GET",POST:"POST"},M={AUTHORITY:"authority",ACQUIRE_TOKEN_ACCOUNT:"acquireToken.account",SESSION_STATE:"session.state",REQUEST_STATE:"request.state",NONCE_IDTOKEN:"nonce.id_token",ORIGIN_URI:"request.origin",RENEW_STATUS:"token.renew.status",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",SCOPES:"scopes",INTERACTION_STATUS_KEY:"interaction.status",CCS_CREDENTIAL:"ccs.credential",CORRELATION_ID:"request.correlationId",NATIVE_REQUEST:"request.native",REDIRECT_CONTEXT:"request.redirect.context"},I={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys",VERSION:"msal.version"},R={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},P={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962};var L=function(G){return G.Redirect="redirect",G.Popup="popup",G.Silent="silent",G.None="none",G}(L||{});const q={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},W={scopes:m.aZ},H="jwk",ae={React:"@azure/msal-react",Angular:"@azure/msal-angular"},z="msal.db",X=1,j=`${z}.keys`,Q={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},se=[Q.Default,Q.Skip,Q.RefreshTokenAndNetwork],pe="msal.browser.log.level",le="msal.browser.log.pii"},1474:($,N,A)=>{A.d(N,{Af:()=>se,EZ:()=>X,GZ:()=>P,Q3:()=>Q,U2:()=>I,Uu:()=>q,VX:()=>W,gj:()=>le,kZ:()=>pe,nQ:()=>R,uh:()=>j});var m=A(1564),i=A(6810),h=A(7554),T=A(1510),y=A(4064),_=A(6588),M=A(3578);function I(B){B.location.hash="","function"==typeof B.history.replaceState&&B.history.replaceState(null,"",`${B.location.origin}${B.location.pathname}${B.location.search}`)}function R(B){const G=B.split("#");G.shift(),window.location.hash=G.length>0?G.join("#"):""}function P(){return window.parent!==window}function q(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function W(){const G=new m.H(window.location.href).getUrlComponents();return`${G.Protocol}//${G.HostNameAndPort}/`}function X(){if(typeof window>"u")throw(0,i.bD)(_.tI)}function j(B){if(!B)throw(0,i.bD)(_.IR)}function Q(B){X(),function H(){if(m.H.hashContainsKnownProperties(window.location.hash)&&P())throw(0,i.bD)(_.tZ)}(),function z(){if(function L(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&"string"==typeof window.name&&0===window.name.indexOf(`${h.Q1.POPUP_NAME_PREFIX}.`)}())throw(0,i.bD)(_.aH)}(),j(B)}function se(B,G){if(Q(B),function ae(B){if(P()&&!B)throw(0,i.bD)(_.OT)}(G.system.allowRedirectInIframe),G.cache.cacheLocation===h.Al.MemoryStorage&&!G.cache.storeAuthStateInCookie)throw(0,y.jz)(M.jE)}function pe(B){const G=document.createElement("link");G.rel="preconnect",G.href=new URL(B).origin,G.crossOrigin="anonymous",document.head.appendChild(G),window.setTimeout(()=>{try{document.head.removeChild(G)}catch{}},1e4)}function le(){return(0,T.Oy)()}},3461:($,N,A)=>{A.d(N,{lR:()=>y,pz:()=>_});var m=A(7635),i=A(6213);const h={[i.W]:"Unexpected error in authentication.",[i.z]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."};class y extends Error{constructor(I,R,P){super(R?`${I}: ${R}`:I),Object.setPrototypeOf(this,y.prototype),this.errorCode=I||m.YM.EMPTY_STRING,this.errorMessage=R||m.YM.EMPTY_STRING,this.subError=P||m.YM.EMPTY_STRING,this.name="AuthError"}setCorrelationId(I){this.correlationId=I}}function _(M,I){return new y(M,I?`${h[M]} ${I}`:h[M])}},6213:($,N,A)=>{A.d(N,{W:()=>m,z:()=>i});const m="unexpected_error",i="post_request_failed"},3986:($,N,A)=>{A.d(N,{SB:()=>_,eB:()=>y});var m=A(3461),i=A(7172);const h={[i.lP]:"The client info could not be parsed/decoded correctly",[i.fY]:"The client info was empty",[i.gR]:"Token cannot be parsed",[i.Bh]:"The token is null or empty",[i.s1]:"Endpoints cannot be resolved",[i.x6]:"Network request failed",[i.Ej]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[i.hJ]:"The hash parameters could not be deserialized",[i.f$]:"State was not the expected format",[i.Cl]:"State mismatch error",[i.tQ]:"State not found",[i.aQ]:"Nonce mismatch error",[i.n3]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[i.Yh]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[i.s9]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[i.gg]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[i.oV]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[i.$P]:"Token request cannot be made without authorization code or refresh token.",[i.f5]:"Cannot remove null or empty scope from ScopeSet",[i.Wf]:"Cannot append ScopeSet",[i.UA]:"Empty input ScopeSet cannot be processed",[i.u4]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[i.dL]:"Device code is expired.",[i.ax]:"Device code stopped polling for unknown reasons.",[i.C2]:"Please pass an account object, silent flow is not supported without account information",[i.n4]:"Cache record object was null or undefined.",[i.l3]:"Invalid environment when attempting to create cache entry",[i.rk]:"No account found in cache for given key.",[i.oL]:"No crypto object detected.",[i.Zj]:"Unexpected credential type.",[i.qM]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[i.Q8]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[i.wb]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[i.Fs]:"User defined timeout for device code polling reached",[i.FA]:"Cannot generate a POP jwt if the token_claims are not populated",[i.Re]:"Server response does not contain an authorization code to proceed",[i.QE]:"Could not remove the credential's binding key from storage.",[i.yX]:"The provided authority does not support logout",[i.fo]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[i.l7]:"No network connectivity. Check your internet connection.",[i.fn]:"User cancelled the flow.",[i.ik]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[i.R9]:"This method has not been implemented",[i.CN]:"The nested app auth bridge is disabled"};class y extends m.lR{constructor(I,R){super(I,R?`${h[I]}: ${R}`:h[I]),this.name="ClientAuthError",Object.setPrototypeOf(this,y.prototype)}}function _(M,I){return new y(M,I)}},7172:($,N,A)=>{A.d(N,{$P:()=>j,Bh:()=>T,C2:()=>Pe,CN:()=>_e,Cl:()=>P,Ej:()=>M,FA:()=>Z,Fs:()=>Re,Q8:()=>J,QE:()=>de,R9:()=>Be,Re:()=>l,UA:()=>pe,Wf:()=>se,Yh:()=>H,Zj:()=>Te,aQ:()=>q,ax:()=>G,dL:()=>B,f$:()=>R,f5:()=>Q,fY:()=>i,fn:()=>Ue,fo:()=>v,gR:()=>h,gg:()=>z,hJ:()=>I,ik:()=>Ge,l3:()=>Ne,l7:()=>E,lP:()=>m,n3:()=>W,n4:()=>C,oL:()=>Se,oV:()=>X,qM:()=>x,rk:()=>Ae,s1:()=>y,s9:()=>ae,tQ:()=>L,u4:()=>le,wb:()=>K,x6:()=>_,yX:()=>he});const m="client_info_decoding_error",i="client_info_empty_error",h="token_parsing_error",T="null_or_empty_token",y="endpoints_resolution_error",_="network_error",M="openid_config_error",I="hash_not_deserialized",R="invalid_state",P="state_mismatch",L="state_not_found",q="nonce_mismatch",W="auth_time_not_found",H="max_age_transpired",ae="multiple_matching_tokens",z="multiple_matching_accounts",X="multiple_matching_appMetadata",j="request_cannot_be_made",Q="cannot_remove_empty_scope",se="cannot_append_scopeset",pe="empty_input_scopeset",le="device_code_polling_cancelled",B="device_code_expired",G="device_code_unknown_error",Pe="no_account_in_silent_request",C="invalid_cache_record",Ne="invalid_cache_environment",Ae="no_account_found",Se="no_crypto_object",Te="unexpected_credential_type",x="invalid_assertion",J="invalid_client_credential",K="token_refresh_required",Re="user_timeout_reached",Z="token_claims_cnf_required_for_signedjwt",l="authorization_code_missing_from_server_response",de="binding_key_not_removed",he="end_session_endpoint_not_supported",v="key_id_missing",E="no_network_connectivity",Ue="user_canceled",Ge="missing_tenant_id_error",Be="method_not_implemented",_e="nested_app_auth_bridge_disabled"},7806:($,N,A)=>{A.d(N,{aD:()=>_});var m=A(3461),i=A(5424);const h={[i.gO]:"A redirect URI is required for all calls, and none has been set.",[i.hL]:"Could not parse the given claims request object.",[i.oY]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[i.$N]:"URL could not be parsed into appropriate segments.",[i.$A]:"URL was empty or null.",[i.zg]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[i.Pc]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[i.bj]:"Given claims parameter must be a stringified JSON object.",[i.Ub]:"Token request was empty and not found in cache.",[i.pi]:"The logout request was null or undefined.",[i.b0]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[i.qz]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[i.a_]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[i.uk]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[i.E0]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[i.LX]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[i.rB]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[i.ze]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[i.hk]:"Invalid authentication header provided",[i.bg]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[i.J6]:"Cannot set allowNativeBroker parameter to true when not in AAD protocol mode.",[i.K3]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."};class y extends m.lR{constructor(I){super(I,h[I]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,y.prototype)}}function _(M){return new y(M)}},5424:($,N,A)=>{A.d(N,{$A:()=>y,$N:()=>T,E0:()=>ae,J6:()=>pe,K3:()=>le,LX:()=>z,Pc:()=>M,Ub:()=>R,a_:()=>W,b0:()=>L,bg:()=>se,bj:()=>I,gO:()=>m,hL:()=>i,hk:()=>Q,oY:()=>h,pi:()=>P,qz:()=>q,rB:()=>X,uk:()=>H,ze:()=>j,zg:()=>_});const m="redirect_uri_empty",i="claims_request_parsing_error",h="authority_uri_insecure",T="url_parse_error",y="empty_url_error",_="empty_input_scopes_error",M="invalid_prompt_value",I="invalid_claims",R="token_request_empty",P="logout_request_empty",L="invalid_code_challenge_method",q="pkce_params_missing",W="invalid_cloud_discovery_metadata",H="invalid_authority_metadata",ae="untrusted_authority",z="missing_ssh_jwk",X="missing_ssh_kid",j="missing_nonce_authentication_header",Q="invalid_authentication_header",se="cannot_set_OIDCOptions",pe="cannot_allow_native_broker",le="authority_mismatch"},8173:($,N,A)=>{A.d(N,{$:()=>i,V:()=>h});var m=A(7635),i=function(T){return T[T.Error=0]="Error",T[T.Warning=1]="Warning",T[T.Info=2]="Info",T[T.Verbose=3]="Verbose",T[T.Trace=4]="Trace",T}(i||{});class h{constructor(y,_,M){this.level=i.Info;const R=y||h.createDefaultLoggerOptions();this.localCallback=R.loggerCallback||(()=>{}),this.piiLoggingEnabled=R.piiLoggingEnabled||!1,this.level="number"==typeof R.logLevel?R.logLevel:i.Info,this.correlationId=R.correlationId||m.YM.EMPTY_STRING,this.packageName=_||m.YM.EMPTY_STRING,this.packageVersion=M||m.YM.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:i.Info}}clone(y,_,M){return new h({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:M||this.correlationId},y,_)}logMessage(y,_){if(_.logLevel>this.level||!this.piiLoggingEnabled&&_.containsPii)return;const R=`[${(new Date).toUTCString()}] : [${_.correlationId||this.correlationId||""}] : ${this.packageName}@${this.packageVersion} : ${i[_.logLevel]} - ${y}`;this.executeCallback(_.logLevel,R,_.containsPii||!1)}executeCallback(y,_,M){this.localCallback&&this.localCallback(y,_,M)}error(y,_){this.logMessage(y,{logLevel:i.Error,containsPii:!1,correlationId:_||m.YM.EMPTY_STRING})}errorPii(y,_){this.logMessage(y,{logLevel:i.Error,containsPii:!0,correlationId:_||m.YM.EMPTY_STRING})}warning(y,_){this.logMessage(y,{logLevel:i.Warning,containsPii:!1,correlationId:_||m.YM.EMPTY_STRING})}warningPii(y,_){this.logMessage(y,{logLevel:i.Warning,containsPii:!0,correlationId:_||m.YM.EMPTY_STRING})}info(y,_){this.logMessage(y,{logLevel:i.Info,containsPii:!1,correlationId:_||m.YM.EMPTY_STRING})}infoPii(y,_){this.logMessage(y,{logLevel:i.Info,containsPii:!0,correlationId:_||m.YM.EMPTY_STRING})}verbose(y,_){this.logMessage(y,{logLevel:i.Verbose,containsPii:!1,correlationId:_||m.YM.EMPTY_STRING})}verbosePii(y,_){this.logMessage(y,{logLevel:i.Verbose,containsPii:!0,correlationId:_||m.YM.EMPTY_STRING})}trace(y,_){this.logMessage(y,{logLevel:i.Trace,containsPii:!1,correlationId:_||m.YM.EMPTY_STRING})}tracePii(y,_){this.logMessage(y,{logLevel:i.Trace,containsPii:!0,correlationId:_||m.YM.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}},4561:($,N,A)=>{A.d(N,{MX:()=>m,hU:()=>h});const m={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",StandardInteractionClientInitializeAuthorizationCodeRequest:"standardInteractionClientInitializeAuthorizationCodeRequest",GetAuthCodeUrl:"getAuthCodeUrl",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",AuthClientCreateQueryString:"authClientCreateQueryString",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues"},h={NotStarted:0,InProgress:1,Completed:2}},1564:($,N,A)=>{A.d(N,{H:()=>_});var m=A(7806),i=A(2030),h=A(7635),T=A(2718),y=A(5424);class _{get urlString(){return this._urlString}constructor(I){if(this._urlString=I,!this._urlString)throw(0,m.aD)(y.$A);I.includes("#")||(this._urlString=_.canonicalizeUri(I))}static canonicalizeUri(I){if(I){let R=I.toLowerCase();return i.$.endsWith(R,"?")?R=R.slice(0,-1):i.$.endsWith(R,"?/")&&(R=R.slice(0,-2)),i.$.endsWith(R,"/")||(R+="/"),R}return I}validateAsUri(){let I;try{I=this.getUrlComponents()}catch{throw(0,m.aD)(y.$N)}if(!I.HostNameAndPort||!I.PathSegments)throw(0,m.aD)(y.$N);if(!I.Protocol||"https:"!==I.Protocol.toLowerCase())throw(0,m.aD)(y.oY)}static appendQueryString(I,R){return R?I.indexOf("?")<0?`${I}?${R}`:`${I}&${R}`:I}static removeHashFromUrl(I){return _.canonicalizeUri(I.split("#")[0])}replaceTenantPath(I){const R=this.getUrlComponents(),P=R.PathSegments;return I&&0!==P.length&&(P[0]===h.v2.COMMON||P[0]===h.v2.ORGANIZATIONS)&&(P[0]=I),_.constructAuthorityUriFromObject(R)}getUrlComponents(){const I=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),R=this.urlString.match(I);if(!R)throw(0,m.aD)(y.$N);const P={Protocol:R[1],HostNameAndPort:R[4],AbsolutePath:R[5],QueryString:R[7]};let L=P.AbsolutePath.split("/");return L=L.filter(q=>q&&q.length>0),P.PathSegments=L,P.QueryString&&P.QueryString.endsWith("/")&&(P.QueryString=P.QueryString.substring(0,P.QueryString.length-1)),P}static getDomainFromUrl(I){const R=RegExp("^([^:/?#]+://)?([^/?#]*)"),P=I.match(R);if(!P)throw(0,m.aD)(y.$N);return P[2]}static getAbsoluteUrl(I,R){if(I[0]===h.YM.FORWARD_SLASH){const L=new _(R).getUrlComponents();return L.Protocol+"//"+L.HostNameAndPort+I}return I}static constructAuthorityUriFromObject(I){return new _(I.Protocol+"//"+I.HostNameAndPort+"/"+I.PathSegments.join("/"))}static hashContainsKnownProperties(I){return!!(0,T.n)(I)}}},7635:($,N,A)=>{A.d(N,{$x:()=>W,E_:()=>le,F0:()=>Re,Fq:()=>I,GU:()=>j,Gd:()=>_,I:()=>C,IO:()=>G,JR:()=>Q,Kk:()=>Ae,LR:()=>ae,Lz:()=>J,OK:()=>y,Qd:()=>H,Rv:()=>x,Tq:()=>Ne,Xw:()=>Pe,YM:()=>m,_2:()=>Te,_A:()=>T,_M:()=>R,aG:()=>z,aZ:()=>h,gT:()=>B,hB:()=>se,iF:()=>P,jZ:()=>Se,p:()=>q,t3:()=>i,u0:()=>pe,v2:()=>M,zL:()=>L});const m={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_RESPONSE_TYPE:"code",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",FRAGMENT_RESPONSE_MODE:"fragment",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],TOKEN_RESPONSE_TYPE:"token",ID_TOKEN_RESPONSE_TYPE:"id_token",SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},i={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},h=[m.OPENID_SCOPE,m.PROFILE_SCOPE,m.OFFLINE_ACCESS_SCOPE],T=[...h,m.EMAIL_SCOPE],y={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},_={ID_TOKEN:"idtoken",CLIENT_INFO:"client.info",ADAL_ID_TOKEN:"adal.idtoken",ERROR:"error",ERROR_DESC:"error.description",ACTIVE_ACCOUNT:"active-account",ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},M={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},I={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},R={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},P={PLAIN:"plain",S256:"S256"},L={QUERY:"query",FRAGMENT:"fragment"},q={...L,FORM_POST:"form_post"},W={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},H={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},ae={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},z={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},j="appmetadata",Q="client_info",se="1",pe={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:86400},le={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},B={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},G={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Pe={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},C={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},Ne={username:"username",password:"password"},Ae={httpSuccess:200,httpBadRequest:400},Se={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},Te={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},x={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},J={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},Re=300},2030:($,N,A)=>{A.d(N,{$:()=>m});class m{static isEmptyObj(h){if(h)try{const T=JSON.parse(h);return 0===Object.keys(T).length}catch{}return!0}static startsWith(h,T){return 0===h.indexOf(T)}static endsWith(h,T){return h.length>=T.length&&h.lastIndexOf(T)===h.length-T.length}static queryStringToObject(h){const T={},y=h.split("&"),_=M=>decodeURIComponent(M.replace(/\+/g," "));return y.forEach(M=>{if(M.trim()){const[I,R]=M.split(/=(.+)/g,2);I&&R&&(T[_(I)]=_(R))}}),T}static trimArrayEntries(h){return h.map(T=>T.trim())}static removeEmptyStringsFromArray(h){return h.filter(T=>!!T)}static jsonParseHelper(h){try{return JSON.parse(h)}catch{return null}}static matchPattern(h,T){return new RegExp(h.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(T)}}},2718:($,N,A)=>{A.d(N,{S:()=>h,n:()=>T});var m=A(3986),i=A(7172);function h(y){return y.startsWith("#/")?y.substring(2):y.startsWith("#")||y.startsWith("?")?y.substring(1):y}function T(y){if(!y||y.indexOf("=")<0)return null;try{const _=h(y),M=Object.fromEntries(new URLSearchParams(_));if(M.code||M.error||M.error_description||M.state)return M}catch{throw(0,m.SB)(i.hJ)}return null}},2490:($,N,A)=>{A.d(N,{O:()=>h});var m=A(1267),i=A(1781);let h=(()=>{class T{constructor(_,M){this.document=_,this.platformId=M,this.documentIsAccessible=(0,i.isPlatformBrowser)(this.platformId)}static getCookieRegExp(_){const M=_.replace(/([\[\]{}()|=;+?,.*^$])/gi,"\\$1");return new RegExp("(?:^"+M+"|;\\s*"+M+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(_){try{return decodeURIComponent(_)}catch{return _}}check(_){return!!this.documentIsAccessible&&(_=encodeURIComponent(_),T.getCookieRegExp(_).test(this.document.cookie))}get(_){if(this.documentIsAccessible&&this.check(_)){_=encodeURIComponent(_);const I=T.getCookieRegExp(_).exec(this.document.cookie);return I[1]?T.safeDecodeURIComponent(I[1]):""}return""}getAll(){if(!this.documentIsAccessible)return{};const _={},M=this.document;return M.cookie&&""!==M.cookie&&M.cookie.split(";").forEach(I=>{const[R,P]=I.split("=");_[T.safeDecodeURIComponent(R.replace(/^ /,""))]=T.safeDecodeURIComponent(P)}),_}set(_,M,I,R,P,L,q){if(!this.documentIsAccessible)return;if("number"==typeof I||I instanceof Date||R||P||L||q)return void this.set(_,M,{expires:I,path:R,domain:P,secure:L,sameSite:q||"Lax"});let W=encodeURIComponent(_)+"="+encodeURIComponent(M)+";";const H=I||{};H.expires&&(W+="number"==typeof H.expires?"expires="+new Date((new Date).getTime()+1e3*H.expires*60*60*24).toUTCString()+";":"expires="+H.expires.toUTCString()+";"),H.path&&(W+="path="+H.path+";"),H.domain&&(W+="domain="+H.domain+";"),!1===H.secure&&"None"===H.sameSite&&(H.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${_} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),H.secure&&(W+="secure;"),H.sameSite||(H.sameSite="Lax"),W+="sameSite="+H.sameSite+";",this.document.cookie=W}delete(_,M,I,R,P="Lax"){this.documentIsAccessible&&this.set(_,"",{expires:new Date("Thu, 01 Jan 1970 00:00:01 GMT"),path:M,domain:I,secure:R,sameSite:P})}deleteAll(_,M,I,R="Lax"){if(!this.documentIsAccessible)return;const P=this.getAll();for(const L in P)P.hasOwnProperty(L)&&this.delete(L,_,M,I,R)}static{this.\u0275fac=function(M){return new(M||T)(m.\u0275\u0275inject(i.DOCUMENT),m.\u0275\u0275inject(m.PLATFORM_ID))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"root"})}}return T})()},467:($,N,A)=>{function m(h,T,y,_,M,I,R){try{var P=h[I](R),L=P.value}catch(q){return void y(q)}P.done?T(L):Promise.resolve(L).then(_,M)}function i(h){return function(){var T=this,y=arguments;return new Promise(function(_,M){var I=h.apply(T,y);function R(L){m(I,_,M,R,P,"next",L)}function P(L){m(I,_,M,R,P,"throw",L)}R(void 0)})}}A.d(N,{A:()=>i})}}]);%W !      i^i^HjL   R    O^partitionKey=%28https%2Cgencat.cat%29,:https://areaprivada.ovt.gencat.cat/157.js strongly-framed 1 security-info FnhllAKWRHGAlo+ESXykKAAAAAAAAAAAwAAAAAAAAEaphjojH6pBabDSgSnsfLHeAAAAAgAAAAAAAAAAAAAAAAAAAAEAOQFmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAAdNMIIHSTCCBbGgAwIBAgIQWjEv4zomAm7bzhiqvXrqqjANBgkqhkiG9w0BAQwFADBgMQswCQYDVQQGEwJHQjEYMBYGA1UEChMPU2VjdGlnbyBMaW1pdGVkMTcwNQYDVQQDEy5TZWN0aWdvIFB1YmxpYyBTZXJ2ZXIgQXV0aGVudGljYXRpb24gQ0EgT1YgUjM2MB4XDTI1MDYwMjAwMDAwMFoXDTI2MDYwMjIzNTk1OVowaTELMAkGA1UEBhMCRVMxEjAQBgNVBAgTCUJhcmNlbG9uYTEhMB8GA1UEChMYR2VuZXJhbGl0YXQgZGUgQ2F0YWx1bnlhMSMwIQYDVQQDExphcmVhcHJpdmFkYS5vdnQuZ2VuY2F0LmNhdDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJzxTAqSRhNoEABVX9CMZWxoK8mZE94tt9+3NypqUimWjgD2HHEqlH5lp69OqjL1SwH0XtuqFFy4GukhIU5ZromHOnqbMKuJ+spsj0+JFUzAjQIWbl7IojlagibaZhn2BSSyiuth6tVFxii7z6MuT2L++g1Lv2xRC1BVuhUEzHKt6O+7DbMWPln0TG5QrLHLWgpSGx8oHCm+PopFHGXoOuH59ogYueO8S8SBvKeZm04qjeuPY/VrxJs6i17bxemybdNL4gFAu97u9dwdwQEzrPUnNk7YZ9pOl8m9xRMCuwfKzHKpgSYPsvQboT7QVbwNRI3YnUgMkg8cdD0nGOydXCkCAwEAAaOCA3QwggNwMB8GA1UdIwQYMBaAFONmdLtwaI0sXU4OpkqPmzcinIKSMB0GA1UdDgQWBBQMlHUlGnpODn/xO2jzY5sCL2uZQzAOBgNVHQ8BAf8EBAMCBaAwDAYDVR0TAQH/BAIwADAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwSgYDVR0gBEMwQTA1BgwrBgEEAbIxAQIBAwQwJTAjBggrBgEFBQcCARYXaHR0cHM6Ly9zZWN0aWdvLmNvbS9DUFMwCAYGZ4EMAQICMFQGA1UdHwRNMEswSaBHoEWGQ2h0dHA6Ly9jcmwuc2VjdGlnby5jb20vU2VjdGlnb1B1YmxpY1NlcnZlckF1dGhlbnRpY2F0aW9uQ0FPVlIzNi5jcmwwgYQGCCsGAQUFBwEBBHgwdjBPBggrBgEFBQcwAoZDaHR0cDovL2NydC5zZWN0aWdvLmNvbS9TZWN0aWdvUHVibGljU2VydmVyQXV0aGVudGljYXRpb25DQU9WUjM2LmNydDAjBggrBgEFBQcwAYYXaHR0cDovL29jc3Auc2VjdGlnby5jb20wRQYDVR0RBD4wPIIaYXJlYXByaXZhZGEub3Z0LmdlbmNhdC5jYXSCHnd3dy5hcmVhcHJpdmFkYS5vdnQuZ2VuY2F0LmNhdDCCAX8GCisGAQQB1nkCBAIEggFvBIIBawFpAHYAlpdkv1VYl633Q4doNwhCd+nwOtX2pPM2bkakPw/KqcYAAAGXMHVkVgAABAMARzBFAiEA1DylgD547csA8wGa7M8vIg8Q0/r+t1fHzJ8sW3wF1FkCIBi8DeA4JmGmjuMR75gTmhiPpCqTK9S6bhew/FCf3IMkAHYAGYbUxyiqb/66A294Kk0BkarOLXIxD67OXXBBLSVMx9QAAAGXMHVj8AAABAMARzBFAiEApDhJuEdV4s4SUixkltqEIIncYeDWrlV3arxfI7bCfWICIDQ844ChMjRn9OjGY2RN2dzCCerNTdzA6nMdncs0ntN6AHcADleUvPOuqT4zGyyZB7P3kN+bwj1xMiXdIaklrGHFTiEAAAGXMHVj8AAABAMASDBGAiEA1Qrd1jnEelRpaP3F2y4XQKVocCwJt+mzIsdqN3VUNsQCIQDLTsSqq6BCGPtiRRlDqPp0zwdEUvh7DLDmUNV016EF/DANBgkqhkiG9w0BAQwFAAOCAYEACWP+MpTZelAmctkvV/B+hpGwzSdSpfmpTqoK9ZjKpj+MzwqwtDP1+H0jOlOEozBt0iJH4JOPZPUTjwyKzw+QPh5rOCMkwYLPRNKzic9785aq1ZEpHNVs6ZGmYbkMG2r1nmgrbgRo5/CgylIiKGWXVR7Fx0jwuzmctPeKLLtxF/LtE7i7qj6K2Hf4ecDTUKpzHGvbzCb0xlkx7Sw+TI7vK7P2XZhnH13CeY507b0266yE5p3CBfMABTrXG9lL9iIw1z1KryLJt1FNOWfTVlK3D+cUjmeo6PTrcPzRAqRzSQ90cuAy9UsTgbGl7PVRAy2z1I1bLbKKeLsCtqJh1BkWCp8h+sCDpiZlVk6ti/s+C9KbiJ/36Jj0Y8T1zgtUvz5TquIA9Mnlc5iZNjOIoG9zWl228IvT+namLtbIdodDw0jRKZVnr70xdO2cge8BtdtC/3cVLssx1BrHxgD1y1vS9XH1iv+JIcU3GGjpPS5nceqptsxJ3kGd8m97/nRp5UVGEwEABAAAAAAAAQEAAAUAAAAGeDI1NTE5AAAADlJTQS1QU1MtU0hBMjU2AANmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAAdNMIIHSTCCBbGgAwIBAgIQWjEv4zomAm7bzhiqvXrqqjANBgkqhkiG9w0BAQwFADBgMQswCQYDVQQGEwJHQjEYMBYGA1UEChMPU2VjdGlnbyBMaW1pdGVkMTcwNQYDVQQDEy5TZWN0aWdvIFB1YmxpYyBTZXJ2ZXIgQXV0aGVudGljYXRpb24gQ0EgT1YgUjM2MB4XDTI1MDYwMjAwMDAwMFoXDTI2MDYwMjIzNTk1OVowaTELMAkGA1UEBhMCRVMxEjAQBgNVBAgTCUJhcmNlbG9uYTEhMB8GA1UEChMYR2VuZXJhbGl0YXQgZGUgQ2F0YWx1bnlhMSMwIQYDVQQDExphcmVhcHJpdmFkYS5vdnQuZ2VuY2F0LmNhdDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJzxTAqSRhNoEABVX9CMZWxoK8mZE94tt9+3NypqUimWjgD2HHEqlH5lp69OqjL1SwH0XtuqFFy4GukhIU5ZromHOnqbMKuJ+spsj0+JFUzAjQIWbl7IojlagibaZhn2BSSyiuth6tVFxii7z6MuT2L++g1Lv2xRC1BVuhUEzHKt6O+7DbMWPln0TG5QrLHLWgpSGx8oHCm+PopFHGXoOuH59ogYueO8S8SBvKeZm04qjeuPY/VrxJs6i17bxemybdNL4gFAu97u9dwdwQEzrPUnNk7YZ9pOl8m9xRMCuwfKzHKpgSYPsvQboT7QVbwNRI3YnUgMkg8cdD0nGOydXCkCAwEAAaOCA3QwggNwMB8GA1UdIwQYMBaAFONmdLtwaI0sXU4OpkqPmzcinIKSMB0GA1UdDgQWBBQMlHUlGnpODn/xO2jzY5sCL2uZQzAOBgNVHQ8BAf8EBAMCBaAwDAYDVR0TAQH/BAIwADAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwSgYDVR0gBEMwQTA1BgwrBgEEAbIxAQIBAwQwJTAjBggrBgEFBQcCARYXaHR0cHM6Ly9zZWN0aWdvLmNvbS9DUFMwCAYGZ4EMAQICMFQGA1UdHwRNMEswSaBHoEWGQ2h0dHA6Ly9jcmwuc2VjdGlnby5jb20vU2VjdGlnb1B1YmxpY1NlcnZlckF1dGhlbnRpY2F0aW9uQ0FPVlIzNi5jcmwwgYQGCCsGAQUFBwEBBHgwdjBPBggrBgEFBQcwAoZDaHR0cDovL2NydC5zZWN0aWdvLmNvbS9TZWN0aWdvUHVibGljU2VydmVyQXV0aGVudGljYXRpb25DQU9WUjM2LmNydDAjBggrBgEFBQcwAYYXaHR0cDovL29jc3Auc2VjdGlnby5jb20wRQYDVR0RBD4wPIIaYXJlYXByaXZhZGEub3Z0LmdlbmNhdC5jYXSCHnd3dy5hcmVhcHJpdmFkYS5vdnQuZ2VuY2F0LmNhdDCCAX8GCisGAQQB1nkCBAIEggFvBIIBawFpAHYAlpdkv1VYl633Q4doNwhCd+nwOtX2pPM2bkakPw/KqcYAAAGXMHVkVgAABAMARzBFAiEA1DylgD547csA8wGa7M8vIg8Q0/r+t1fHzJ8sW3wF1FkCIBi8DeA4JmGmjuMR75gTmhiPpCqTK9S6bhew/FCf3IMkAHYAGYbUxyiqb/66A294Kk0BkarOLXIxD67OXXBBLSVMx9QAAAGXMHVj8AAABAMARzBFAiEApDhJuEdV4s4SUixkltqEIIncYeDWrlV3arxfI7bCfWICIDQ844ChMjRn9OjGY2RN2dzCCerNTdzA6nMdncs0ntN6AHcADleUvPOuqT4zGyyZB7P3kN+bwj1xMiXdIaklrGHFTiEAAAGXMHVj8AAABAMASDBGAiEA1Qrd1jnEelRpaP3F2y4XQKVocCwJt+mzIsdqN3VUNsQCIQDLTsSqq6BCGPtiRRlDqPp0zwdEUvh7DLDmUNV016EF/DANBgkqhkiG9w0BAQwFAAOCAYEACWP+MpTZelAmctkvV/B+hpGwzSdSpfmpTqoK9ZjKpj+MzwqwtDP1+H0jOlOEozBt0iJH4JOPZPUTjwyKzw+QPh5rOCMkwYLPRNKzic9785aq1ZEpHNVs6ZGmYbkMG2r1nmgrbgRo5/CgylIiKGWXVR7Fx0jwuzmctPeKLLtxF/LtE7i7qj6K2Hf4ecDTUKpzHGvbzCb0xlkx7Sw+TI7vK7P2XZhnH13CeY507b0266yE5p3CBfMABTrXG9lL9iIw1z1KryLJt1FNOWfTVlK3D+cUjmeo6PTrcPzRAqRzSQ90cuAy9UsTgbGl7PVRAy2z1I1bLbKKeLsCtqJh1BkWCp8h+sCDpiZlVk6ti/s+C9KbiJ/36Jj0Y8T1zgtUvz5TquIA9Mnlc5iZNjOIoG9zWl228IvT+namLtbIdodDw0jRKZVnr70xdO2cge8BtdtC/3cVLssx1BrHxgD1y1vS9XH1iv+JIcU3GGjpPS5nceqptsxJ3kGd8m97/nRp5UVGZgoyJpFcT/u7IImFpjLfBb3Dl5pUIkzVhYlpa26W6oMAAAAAAAAGUDCCBkwwggQ0oAMCAQICECwaPHbpQ93d/xkbMYkK7XEwDQYJKoZIhvcNAQEMBQAwXzELMAkGA1UEBhMCR0IxGDAWBgNVBAoTD1NlY3RpZ28gTGltaXRlZDE2MDQGA1UEAxMtU2VjdGlnbyBQdWJsaWMgU2VydmVyIEF1dGhlbnRpY2F0aW9uIFJvb3QgUjQ2MB4XDTIxMDMyMjAwMDAwMFoXDTM2MDMyMTIzNTk1OVowYDELMAkGA1UEBhMCR0IxGDAWBgNVBAoTD1NlY3RpZ28gTGltaXRlZDE3MDUGA1UEAxMuU2VjdGlnbyBQdWJsaWMgU2VydmVyIEF1dGhlbnRpY2F0aW9uIENBIE9WIFIzNjCCAaIwDQYJKoZIhvcNAQEBBQADggGPADCCAYoCggGBAKZDLSd0dOo6NH3HiNDOdgeyvk8jHhnL9gUOQFXN45WLe+k7xyLv5zXttlv0SV1/a1lA/9hhOhhecdFeG7GOytyHifBO/isxv0xm6Mknw7vhedo6kAW2OtqH4WIzHogGyyNNvhasB3jPLiK1LXF/G9kQsRd+fEwdDR1XHAF2XBWIGZ3WQnl8Y7nGu6SSdtCy1J17YF3IwBNb2OFr20XltFuppHmcjRnZqU3BbOWPrMsui7ROWaHI4vSfTZTZ0XqMdkVlchF6QNQoWeIKjfmaVUiENBwaK1RWwSsoXWchF4GYDUjbQUcMasCMyXjyYWHeGVITtb5Pv7j958A5NKfeav4+52lzQkrxEp6xz8qWgVkStOupynz0T4vZvZCDoTHWH0vIIhUU3HYC9uGHIpY+3nACvU64dFW48KLieFh/sW7eO7uvGRQg/2nOeSNAzR5AqWj67o+nvUZq+yuOsGQwGF7hAKge7Rhv43eiQAPh9juOAlffDUbFNtd39ZEnCGZ7TQIDAQABo4IBgTCCAX0wHwYDVR0jBBgwFoAUVnNYZJX5khqwEioEYnmhQBWIIUkwHQYDVR0OBBYEFONmdLtwaI0sXU4OpkqPmzcinIKSMA4GA1UdDwEB/wQEAwIBhjASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAbBgNVHSAEFDASMAYGBFUdIAAwCAYGZ4EMAQICMFQGA1UdHwRNMEswSaBHoEWGQ2h0dHA6Ly9jcmwuc2VjdGlnby5jb20vU2VjdGlnb1B1YmxpY1NlcnZlckF1dGhlbnRpY2F0aW9uUm9vdFI0Ni5jcmwwgYQGCCsGAQUFBwEBBHgwdjBPBggrBgEFBQcwAoZDaHR0cDovL2NydC5zZWN0aWdvLmNvbS9TZWN0aWdvUHVibGljU2VydmVyQXV0aGVudGljYXRpb25Sb290UjQ2LnA3YzAjBggrBgEFBQcwAYYXaHR0cDovL29jc3Auc2VjdGlnby5jb20wDQYJKoZIhvcNAQEMBQADggIBAAWV1gx1gt3Lm2/3tSNZM4vJTxYiv2VKB9Pbn5lTq3OTm2B/1ypFlHsUj6kZMChSq+6/Drhvqe1TQfK4n1+rqKaigILL2bWbKu4gBcNOE6OrzXMXgbdRLrId3EOG/J20ETECwoYBAKsIbl6fT+PE+EBAUpLGGr+/mhYzckrC2JT8zalTN0TcLwXb6er4A7RsHMZSkGVbrjVSGqGMpbPLMIcQ3khyqUXcUWrky2fqZfsBr8tKZ6yxCRks/ZjhJn26HXv16KUdjRqmhyemyI8sT7ulLckBiNuhJ+1ABKMwAqx89Ojcdo0wGPROjXgel7qGxMCytNuWUZr4JXFERtQa1duLRhx04MQnvDN6BpaVEjEykNnZIJY2VWLfoCnRbVhC2TLkXYvl917K0fCxc/mi1Ig0X0KoZsN0cYyMlSr77vVD2GNZ7L8WJhZ1EnjPtqtc/4j1K8vsQ2PTAuviIZXik9PeFSnRVaey1x+NvsL1Pte5UaJUNpitjf5wS1QcGiIYm0F8OFWCsAfOgXOnkuoqrHPeChIA/1OFbI5oH4Svl6eDTPlWM002t0Hld6fMTjNHMKtafKGRQPjgXM9xWFqQyHuY9DVipcPYV7E8j2Px3mVFefWpLJEjkkUpg33vMCQz1+fLgff+5bndBt8dKcUAHH3z9GsimrzcA08OFHyd+HBMZgoyJpFcT/u7IImFpjLfBb3Dl5pUIkzVhYlpa26W6oMAAAAAAAAFjjCCBYowggNyoAMCAQICEHWN/YuufAcA+qklp+HHrRQwDQYJKoZIhvcNAQEMBQAwXzELMAkGA1UEBhMCR0IxGDAWBgNVBAoTD1NlY3RpZ28gTGltaXRlZDE2MDQGA1UEAxMtU2VjdGlnbyBQdWJsaWMgU2VydmVyIEF1dGhlbnRpY2F0aW9uIFJvb3QgUjQ2MB4XDTIxMDMyMjAwMDAwMFoXDTQ2MDMyMTIzNTk1OVowXzELMAkGA1UEBhMCR0IxGDAWBgNVBAoTD1NlY3RpZ28gTGltaXRlZDE2MDQGA1UEAxMtU2VjdGlnbyBQdWJsaWMgU2VydmVyIEF1dGhlbnRpY2F0aW9uIFJvb3QgUjQ2MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAk77VNlJ12AEjoBxHQknuY7a3If3EldVIKyZ8FFMQ2nn9K7ctpNQs+uoy3UnCub0PSD17WphUr55dMXRPB/xQId2kz2hPGxJjbSWZTCqZ80gwYfqBfB6nCErcPiscHxhMcao1jK34bug7StnllALWiYQTqm3ITzPMUJY3kjPcX4jnn1TZSPCYQ9Zm/Z8XOEPFAVEL1+MjDxRdWxTnS77d9MjaAzfR1jmhIVEwg7Bt1zBOlluR8HAkq79FgWRDDb0hOi886Z4NyyC1QifM2m+b7mQwkDnNk2WBITG1I1AzNyLjOO34MTDMRf5i+dFdMnlCh99qzFYZQE3Oqrv5tXZJlPEn+JGlg+UGs2MOgNzgElWApjtmtDmHLcjw0NEU6eQNTQ72XVdyxTscR1ad4tX7gWGMzE2AkDRbt9cUddzYBEifwMEoiLTpHMqnsfFWt3tJTFnlIBWohAIp+jiUaZpJBo/NH3kUFxIMg3reH7GX7vmXeCikyESS6X0mBaZYcpt5E9gRX67FOGI0aLKGMI74kGGeMmz1BzbNokxu7Io27fLmmRVEcMN8vJw5wLTha/eDJSNX2RKA5UnwdQ/vjescm1QotCE8/HwK/+97a3X/ix2gGQWr+vgrgULoOLq7+6r9PeDzyt9Ol5cp7fMYVumllqy9w5CYsuD5otSmR0N8bc8CAwEAAaNCMEAwHQYDVR0OBBYEFFZzWGSV+ZIasBIqBGJ5oUAViCFJMA4GA1UdDwEB/wQEAwIBhjAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBDAUAA4ICAQAvXJk8/AZejJQucOrSMjGNtPBR1bwK82SfB17VwXNoZHqiuQ7o+V2FLag3Raoo9JYFUGCpSX6f4pk2KRNER2qdVSA82JvxAzK62kChc+qDobdEpg6ZAZvkvH++E5R+yqYedoA2PYQGizMmZW3Kfp7+H4xYOHsag7EPvBcRu+YGzGP6gfKBTNoLEGuh+tUopc8GQBb/e30YXjkSpFOefjJCEKYhkakcThd8hLyfjNHo3+ZRuTZHP5C5x7wC3FscTw5IwSWDnAo/nrEDMxIaJ6z3Imwk0QFB+FgD/iVoIh+aWjx8bJ51SPOB8WZnbkyCwO66Vw4Y7y6a9xLYoGvpBaWh6Wj4vEw/Eh5F6FLAo78SJ3m5zDE8w/Y6IhYDoMmPZqRbok3WgSUG6XakAAo+y801m+DhOMtgU4YoQkEcRFfoqK2rReMlELzbPmVB+xumlw/ruXR5+R68HVcNR6/DL5+HRqfrJloPVmO1YmBuAPvjJxEi5/6ZjzT1uejDkXK92MMeuS7ykURR0FfNDDTVSCG/2xPxZiVDUtJwIjbNn8QcdSCtY3JjBg8OJ87Sag28tTka6dF2etFc5OdJSS1VN2jwGjqYPlQXh1TppidQiXsgLz//v6GLSkeY/yt7ST7DKUZgGEKrMym6wCm5E4nTiIo5QTvJ/abtH/RgY9/SLVUBiwAAAAEAAAAAAAEAAAAAV3Rsc2ZsYWdzMHgwMDAwMDAwMDphcmVhcHJpdmFkYS5vdnQuZ2VuY2F0LmNhdDo0NDNecGFydGl0aW9uS2V5PSUyOGh0dHBzJTJDZ2VuY2F0LmNhdCUyOQAA request-method GET response-head HTTP/1.1 200 OK
x-powered-by: Express
accept-ranges: bytes
cache-control: public, max-age=31536000
last-modified: Tue, 09 Sep 2025 07:44:31 GMT
etag: W/"45ffc-1992d6ef718"
content-type: application/javascript; charset=UTF-8
content-length: 286716
date: Thu, 06 Nov 2025 08:39:42 GMT
 original-response-headers x-powered-by: Express
accept-ranges: bytes
cache-control: public, max-age=31536000
last-modified: Tue, 09 Sep 2025 07:44:31 GMT
etag: W/"45ffc-1992d6ef718"
content-type: application/javascript; charset=UTF-8
content-length: 286716
date: Thu, 06 Nov 2025 08:39:42 GMT
keep-alive: timeout=5
 ctid 2 uncompressed-len 0 net-response-time-onstart 202 net-response-time-onstop 1331  _